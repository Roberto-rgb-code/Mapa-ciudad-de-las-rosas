<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa - Guadalajara Ciudad de las Rosas</title>
    <!-- Base URL para que assets carguen bien en GitHub Pages y en local -->
    <base id="baseUrl" href="">
    <script>
        (function() {
            var base = document.getElementById('baseUrl');
            if (base) {
                var path = location.pathname;
                if (!path.endsWith('/')) path = path.replace(/[^/]+$/, '') || '/';
                base.href = location.protocol + '//' + location.host + path;
            }
        })();
    </script>
    <!-- Google Fonts - Fuente estilo mapa ilustrado condensada -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;500;600;700&family=Archivo+Narrow:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        /* ===== MENÚ LATERAL IZQUIERDO - LISTA DE PUNTOS ===== */
        .sidebar-puntos {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: calc(100vh - 120px);
            background: #fff;
            box-shadow: 4px 0 20px rgba(0,0,0,0.12);
            z-index: 500;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-puntos-header {
            flex-shrink: 0;
            line-height: 0;
        }

        .sidebar-puntos-header img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
            max-height: 220px;
        }

        .sidebar-translate-wrap {
            flex-shrink: 0;
            padding: 10px 16px;
            border-bottom: 1px solid #f0e6ec;
            background: #fdf9fc;
        }
        .sidebar-translate-btn {
            width: 100%;
            padding: 10px 14px;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.05em;
            color: #5d4037;
            background: linear-gradient(135deg, #fff 0%, #fdf5f9 100%);
            border: 2px solid #f79ed6;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 6px rgba(247, 158, 214, 0.25);
        }
        .sidebar-translate-btn:hover {
            background: linear-gradient(135deg, #fdf5f9 0%, #f79ed6 20%);
            color: #fff;
            box-shadow: 0 4px 12px rgba(247, 158, 214, 0.4);
        }

        .sidebar-puntos-list {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            list-style: none;
            padding: 12px 0 24px 0;
            margin: 0;
        }

        .sidebar-puntos-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0e6ec;
            transition: background 0.2s;
            font-size: 13px;
        }

        .sidebar-puntos-item:hover {
            background: #fdf5f9;
        }

        .sidebar-puntos-item .num {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #f79ed6 0%, #e91e63 100%);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 11px;
        }

        .sidebar-puntos-item .name {
            flex: 1;
            color: #333;
            line-height: 1.3;
        }

        .sidebar-puntos-sep {
            list-style: none;
            padding: 12px 16px 8px;
            margin-top: 8px;
            border-top: 1px solid #f0e6ec;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #880e4f;
            background: #fdf9fc;
            pointer-events: none;
        }

        /* Overlay y botón menú: ocultos en desktop */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 550;
        }
        .sidebar-overlay.active {
            display: block;
        }
        .sidebar-btn-open {
            display: none;
            position: fixed;
            left: 12px;
            top: 15px;
            z-index: 601;
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 8px;
            background: #fff;
            color: #5d4037;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.2);
            transition: background 0.2s, box-shadow 0.2s;
        }
        .sidebar-btn-open:hover {
            background: #fdf5f9;
            box-shadow: 0 4px 16px rgba(247, 158, 214, 0.35);
        }
        .sidebar-btn-close {
            display: none;
            position: absolute;
            top: 8px;
            right: 8px;
            z-index: 10;
            width: 40px;
            height: 40px;
            min-width: 40px;
            min-height: 40px;
            border: none;
            border-radius: 50%;
            background: #fff;
            color: #5d4037;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .sidebar-btn-close:hover {
            background: #f5f5f5;
        }
        .sidebar-puntos-header {
            position: relative;
        }

        #map {
            width: calc(100% - 280px);
            height: calc(100vh - 120px);
            position: absolute;
            top: 0;
            left: 280px;
        }

        /* ===== FRANJA LOGOS ANUNCIANTES (solo logos, redirigen al punto en el mapa) ===== */
        .anunciantes-strip {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 120px;
            background: #f5f0eb;
            z-index: 400;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            scrollbar-width: thin;
            padding: 0 12px;
        }
        .anunciantes-strip .anuncio-panel {
            flex: 0 0 100px;
            width: 100px;
            height: 100px;
            min-width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            color: inherit;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .anunciantes-strip .anuncio-panel:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        @media (max-width: 768px) {
            .anunciantes-strip {
                height: 110px;
                padding-bottom: env(safe-area-inset-bottom, 0);
            }
            .anunciantes-strip .anuncio-panel {
                flex: 0 0 88px;
                width: 88px;
                height: 88px;
                min-width: 88px;
            }
        }
        @media (max-width: 480px) {
            .anunciantes-strip {
                height: 100px;
            }
            .anunciantes-strip .anuncio-panel {
                flex: 0 0 76px;
                width: 76px;
                height: 76px;
                min-width: 76px;
            }
            #map {
                height: calc(100vh - 100px);
            }
            .sidebar-puntos {
                height: calc(100vh - 100px);
            }
            .legend {
                bottom: 110px;
            }
        }
        .anunciantes-strip .anuncio-content {
            display: none;
        }
        .anunciantes-strip .anuncio-img-wrap {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px;
            box-sizing: border-box;
            background: transparent;
        }
        .anunciantes-strip .anuncio-img-wrap img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .info-window {
            max-width: 380px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 0;
            overflow: visible;
            border-radius: 12px;
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tooltip sin scroll: contenido compacto para que todo quepa */
        .gm-style-iw-d {
            max-height: 90vh !important;
            overflow: visible !important;
        }

        .gm-style-iw-c {
            border-radius: 12px !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2) !important;
            padding: 0 !important;
            overflow: hidden !important;
        }
        /* Solo ocultar la X por defecto de Google; la franja blanca se oculta en domready por JS */
        .gm-style-iw-c .gm-ui-hover-effect {
            display: none !important;
        }

        /* ===== PANEL DE RUTAS ===== */
        .route-panel {
            position: fixed;
            bottom: 20px;
            left: 300px;
            width: 360px;
            max-height: calc(100vh - 120px);
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            flex-direction: column;
            overflow: hidden;
            animation: slideInUp 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .route-panel.active {
            display: flex;
        }

        .route-panel-header {
            background: linear-gradient(135deg, #f79ed6 0%, #f9c4e2 100%);
            color: #8B1538;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .route-panel-header svg {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            fill: #8B1538;
        }

        .route-panel-header-info {
            flex: 1;
            min-width: 0;
        }

        .route-panel-title {
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .route-panel-subtitle {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 2px;
        }

        .route-panel-close {
            background: rgba(139, 21, 56, 0.15);
            border: none;
            color: #8B1538;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .route-panel-close:hover {
            background: rgba(139, 21, 56, 0.25);
        }

        .route-summary {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }

        .route-stat {
            flex: 1;
            text-align: center;
        }

        .route-stat-value {
            font-size: 22px;
            font-weight: 700;
            color: #8B1538;
        }

        .route-stat-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 2px;
        }

        .route-modes {
            display: flex;
            padding: 12px 16px;
            gap: 8px;
            border-bottom: 1px solid #eee;
        }

        .route-mode-btn {
            flex: 1;
            padding: 10px 8px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .route-mode-btn:hover {
            border-color: #f79ed6;
            background: #fce4ec;
        }

        .route-mode-btn.active {
            border-color: #f79ed6;
            background: linear-gradient(135deg, #f79ed6 0%, #f9c4e2 100%);
            color: #8B1538;
        }

        .route-mode-btn svg {
            width: 22px;
            height: 22px;
        }

        .route-mode-btn span {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .route-steps {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
            max-height: 250px;
        }

        .route-step {
            display: flex;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .route-step:hover {
            background: #f8f9fa;
        }

        .route-step:last-child {
            border-bottom: none;
        }

        .route-step-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #e8f0fe;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .route-step-icon svg {
            width: 16px;
            height: 16px;
            fill: #1a73e8;
        }

        .route-step-content {
            flex: 1;
            min-width: 0;
        }

        .route-step-instruction {
            font-size: 13px;
            color: #333;
            line-height: 1.4;
        }

        .route-step-distance {
            font-size: 11px;
            color: #888;
            margin-top: 4px;
        }

        .route-panel-footer {
            padding: 12px 16px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }

        /* Botón de ruta en InfoWindow */
        .info-window .route-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #f79ed6 0%, #f9c4e2 100%);
            color: #8B1538;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            text-decoration: none;
        }

        .info-window .route-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(247, 158, 214, 0.5);
            color: #8B1538;
            background: linear-gradient(135deg, #f48fb1 0%, #f79ed6 100%);
        }

        .info-window .route-btn svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        .info-window .route-btn.disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .info-window .route-btn.disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* Botón de Street View en InfoWindow */
        .info-window .streetview-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: white;
            color: #8B1538;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: 2px solid #f79ed6;
            transition: all 0.2s;
            text-decoration: none;
        }

        .info-window .streetview-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(247, 158, 214, 0.4);
            background: #fce4ec;
            border-color: #C2185B;
        }

        .info-window .streetview-btn svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        /* Modal de Street View */
        .streetview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .streetview-modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .streetview-modal-content {
            background: white;
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .streetview-modal-header {
            background: linear-gradient(135deg, #f79ed6 0%, #f9c4e2 100%);
            color: #8B1538;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .streetview-modal-header svg {
            width: 24px;
            height: 24px;
            fill: #8B1538;
        }

        .streetview-modal-header-info {
            flex: 1;
        }

        .streetview-modal-title {
            font-size: 16px;
            font-weight: 600;
        }

        .streetview-modal-subtitle {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 2px;
        }

        .streetview-modal-close {
            background: rgba(139, 21, 56, 0.15);
            border: none;
            color: #8B1538;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .streetview-modal-close:hover {
            background: rgba(139, 21, 56, 0.25);
        }

        .streetview-modal-body {
            padding: 0;
            background: #222;
            position: relative;
        }

        .streetview-modal-body iframe {
            width: 100%;
            height: 500px;
            border: none;
            display: block;
        }

        .streetview-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        .streetview-loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.2);
            border-top-color: #f79ed6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }

        .streetview-loading-text {
            font-size: 14px;
            opacity: 0.9;
        }

        .streetview-modal-footer {
            padding: 12px 20px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .streetview-tip {
            font-size: 12px;
            color: #666;
        }

        .aerial-error-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(249, 168, 37, 0.4);
        }

        /* Responsive modal Street View */
        @media (max-width: 768px) {
            .streetview-modal {
                padding: 10px;
            }

            .streetview-modal-content {
                max-height: 85vh;
            }

            .streetview-modal-header {
                padding: 14px 16px;
            }

            .streetview-modal-title {
                font-size: 14px;
            }

            .streetview-modal-body iframe {
                height: 300px;
            }

            .streetview-modal-footer {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }
        }

        /* Loading state para el panel de rutas */
        .route-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            gap: 16px;
        }

        .route-loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f0f0f0;
            border-top-color: #8B1538;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .route-loading-text {
            font-size: 14px;
            color: #666;
        }

        /* Error state */
        .route-error {
            padding: 24px;
            text-align: center;
        }

        .route-error-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px;
            color: #e53935;
        }

        .route-error-message {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
        }

        .route-error-btn {
            padding: 10px 20px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        .route-error-btn:hover {
            background: #eee;
        }

        /* Badge de búsqueda con ruta */
        .search-result-item .route-indicator {
            margin-left: auto;
            color: #1a73e8;
            font-size: 10px;
            display: flex;
            align-items: center;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .search-result-item:hover .route-indicator {
            opacity: 1;
        }

        /* Responsive - Mobile */
        @media (max-width: 768px) {
            .route-panel {
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                max-height: 60vh;
                border-radius: 20px 20px 0 0;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.25);
                transition: max-height 0.3s ease;
            }

            /* Estado minimizado en móvil - por defecto */
            .route-panel.minimized {
                max-height: none;
            }

            .route-panel.minimized .route-modes,
            .route-panel.minimized .route-steps {
                display: none;
            }

            .route-panel.minimized .route-summary {
                border-bottom: none;
            }

            .route-panel-header {
                padding: 12px 16px;
                border-radius: 20px 20px 0 0;
                position: relative;
                cursor: pointer;
            }

            /* Handle visual para arrastrar/expandir */
            .route-panel-header::before {
                content: '';
                position: absolute;
                top: 6px;
                left: 50%;
                transform: translateX(-50%);
                width: 36px;
                height: 4px;
                background: rgba(255,255,255,0.4);
                border-radius: 2px;
            }

            .route-panel-title {
                font-size: 13px;
                padding-top: 4px;
            }

            .route-panel-subtitle {
                font-size: 11px;
            }

            /* Botón expandir/colapsar */
            .route-expand-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                width: 100%;
                padding: 10px;
                background: #f0f0f0;
                border: none;
                cursor: pointer;
                font-size: 12px;
                font-weight: 600;
                color: #666;
                transition: background 0.2s;
            }

            .route-expand-btn:hover {
                background: #e8e8e8;
            }

            .route-expand-btn svg {
                width: 16px;
                height: 16px;
                transition: transform 0.3s;
            }

            .route-panel:not(.minimized) .route-expand-btn svg {
                transform: rotate(180deg);
            }

            .route-summary {
                padding: 10px 16px;
                gap: 12px;
            }

            .route-stat-value {
                font-size: 20px;
            }

            .route-stat-label {
                font-size: 10px;
            }

            .route-modes {
                padding: 8px 12px;
                gap: 6px;
            }

            .route-mode-btn {
                padding: 8px 4px;
                border-radius: 8px;
            }

            .route-mode-btn svg {
                width: 20px;
                height: 20px;
            }

            .route-mode-btn span {
                font-size: 9px;
            }

            .route-steps {
                max-height: 150px;
                padding: 4px 0;
            }

            .route-step {
                padding: 10px 16px;
                gap: 10px;
            }

            .route-step-icon {
                width: 24px;
                height: 24px;
            }

            .route-step-icon svg {
                width: 14px;
                height: 14px;
            }

            .route-step-instruction {
                font-size: 12px;
            }

            .route-step-distance {
                font-size: 10px;
            }

            .route-panel-footer {
                padding: 10px 16px 16px;
            }

            /* Loading más compacto en mobile */
            .route-loading {
                padding: 24px;
            }

            .route-loading-spinner {
                width: 32px;
                height: 32px;
            }

            .route-loading-text {
                font-size: 13px;
            }

            /* Error más compacto */
            .route-error {
                padding: 16px;
            }

            .route-error-icon {
                width: 40px;
                height: 40px;
            }

            /* Logo más pequeño en mobile cuando hay ruta */
            .route-panel.active ~ .map-logo,
            body:has(.route-panel.active) .map-logo {
                transform: scale(0.8);
                transform-origin: top left;
            }
        }

        /* Ocultar botón expandir en desktop */
        .route-expand-btn {
            display: none;
        }

        /* Extra small screens */
        @media (max-width: 380px) {
            .route-panel {
                max-height: 50vh;
            }

            .route-stat-value {
                font-size: 18px;
            }

            .route-steps {
                max-height: 100px;
            }

            .route-mode-btn span {
                font-size: 8px;
            }
        }

        .info-window-header {
            position: relative;
            background: linear-gradient(135deg, #f79ed6 0%, #f9c4e2 100%);
            padding: 10px 36px 10px 12px;
            color: #8B1538;
        }
        .info-window-close-btn {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 50%;
            background: rgba(139, 21, 56, 0.25);
            color: #fff;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: background 0.2s;
        }
        .info-window-close-btn:hover {
            background: rgba(139, 21, 56, 0.5);
        }

        .info-window-header.historical {
            background: linear-gradient(135deg, #f79ed6 0%, #f9c4e2 100%);
        }

        .info-window-header.business {
            background: linear-gradient(135deg, #f79ed6 0%, #f9c4e2 100%);
        }

        .info-window-image {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            object-fit: cover;
            background: rgba(255,255,255,0.95);
            padding: 6px;
            float: right;
            margin-left: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .info-window h3 {
            color: #8B1538;
            margin: 0 0 4px 0;
            font-size: 15px;
            font-weight: 600;
            line-height: 1.25;
        }

        .info-window .category {
            display: inline-block;
            background: rgba(139, 21, 56, 0.15);
            color: #8B1538;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-window-body {
            padding: 10px 12px;
            background: #fff;
        }

        .info-window p {
            color: #444;
            font-size: 12px;
            line-height: 1.45;
            margin: 0 0 8px 0;
            max-height: 12em;
            overflow-y: auto;
        }

        .info-window .address {
            color: #555;
            font-size: 12px;
            margin-top: 8px;
            padding: 8px 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #8B1538;
        }

        .info-window .address.historical {
            border-left-color: #C2185B;
        }

        .info-window .address.business {
            border-left-color: #C2185B;
        }

        .info-window-footer {
            padding: 8px 12px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        /* ===== GALERÍA DE IMÁGENES (compacta para no scroll en tooltip) ===== */
        .gallery-container {
            margin: 8px 0;
            border-radius: 10px;
            overflow: hidden;
            background: #f5f5f5;
        }

        .gallery-main {
            position: relative;
            width: 100%;
            height: 140px;
            overflow: hidden;
            background: #000;
        }

        .gallery-main img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }

        .gallery-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            z-index: 10;
        }

        .gallery-nav:hover {
            background: #fff;
            transform: translateY(-50%) scale(1.1);
        }

        .gallery-nav.prev { left: 8px; }
        .gallery-nav.next { right: 8px; }

        .gallery-nav svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .gallery-counter {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .gallery-thumbnails {
            display: flex;
            gap: 4px;
            padding: 8px;
            overflow-x: auto;
            scrollbar-width: thin;
        }

        .gallery-thumbnails::-webkit-scrollbar {
            height: 4px;
        }

        .gallery-thumbnails::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 2px;
        }

        .gallery-thumb {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            opacity: 0.6;
        }

        .gallery-thumb:hover {
            opacity: 1;
        }

        .gallery-thumb.active {
            border-color: #8B1538;
            opacity: 1;
        }

        .gallery-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-fullscreen-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 32px;
            height: 32px;
            background: rgba(0,0,0,0.6);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .gallery-fullscreen-btn:hover {
            background: rgba(0,0,0,0.8);
        }

        .gallery-fullscreen-btn svg {
            width: 18px;
            height: 18px;
            fill: #fff;
        }

        /* Lightbox para pantalla completa */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-close:hover {
            background: rgba(255,255,255,0.2);
        }

        .lightbox-close svg {
            width: 24px;
            height: 24px;
            fill: #fff;
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-nav:hover {
            background: rgba(255,255,255,0.2);
        }

        .lightbox-nav.prev { left: 20px; }
        .lightbox-nav.next { right: 20px; }

        .lightbox-nav svg {
            width: 28px;
            height: 28px;
            fill: #fff;
        }

        .lightbox-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 14px;
            background: rgba(0,0,0,0.5);
            padding: 8px 16px;
            border-radius: 20px;
        }

        .info-window .contact-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #555;
            font-size: 12px;
            background: white;
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            transition: all 0.2s;
            text-decoration: none;
            cursor: pointer;
        }

        .info-window .contact-item:hover {
            background: #8B1538;
            color: white;
            border-color: #8B1538;
        }

        .info-window a.contact-item:hover svg {
            fill: white;
        }

        .info-window .contact-item svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        .info-window strong {
            color: #8B1538;
        }

        .geolocation-button {
            position: absolute;
            bottom: 140px;
            right: 20px;
            z-index: 1000;
            background: white;
            color: #333;
            border: none;
            padding: 0;
            border-radius: 2px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .geolocation-button:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }

        .geolocation-button:active {
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .geolocation-message {
            position: absolute;
            bottom: 190px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 14px;
            border-radius: 4px;
            font-size: 12px;
            color: #333;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            max-width: 250px;
            display: none;
        }

        .geolocation-message.error {
            background: rgba(244, 67, 54, 0.95);
            color: white;
        }

        .geolocation-message.success {
            background: rgba(76, 175, 80, 0.95);
            color: white;
        }

        .geolocation-instructions {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.98);
            padding: 16px;
            border-radius: 8px;
            font-size: 13px;
            color: #333;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-width: 320px;
            display: none;
        }

        .geolocation-instructions h4 {
            margin: 0 0 10px 0;
            color: #8B1538;
            font-size: 15px;
        }

        .geolocation-instructions ol {
            margin: 0;
            padding-left: 20px;
        }

        .geolocation-instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .geolocation-instructions .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 24px;
            height: 24px;
            line-height: 1;
        }

        .geolocation-instructions .close-btn:hover {
            color: #333;
        }

        .layers-button {
            position: absolute;
            top: 120px;
            right: 20px;
            z-index: 1000;
            background: white;
            color: #333;
            border: none;
            padding: 8px;
            border-radius: 2px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .layers-button:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }

        .layers-button:active {
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .layers-menu {
            position: absolute;
            top: 170px;
            right: 20px;
            z-index: 1001;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            min-width: 200px;
            display: none;
            overflow: hidden;
        }

        .layers-menu.active {
            display: block;
        }

        .layers-menu-header {
            padding: 12px 16px;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            font-size: 14px;
            color: #333;
        }

        .layers-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background-color 0.2s;
            border-bottom: 1px solid #f5f5f5;
        }

        .layers-menu-item:last-child {
            border-bottom: none;
        }

        .layers-menu-item:hover {
            background-color: #f5f5f5;
        }

        .layers-menu-item.active {
            background-color: #e3f2fd;
        }

        .layers-menu-item-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .layers-menu-item-label {
            flex: 1;
            font-size: 14px;
            color: #333;
        }

        .layers-menu-item-check {
            width: 20px;
            height: 20px;
            color: #1976d2;
            display: none;
        }

        .layers-menu-item.active .layers-menu-item-check {
            display: block;
        }

        .map-type-button {
            position: absolute;
            top: 70px;
            right: 20px;
            z-index: 1000;
            background: white;
            color: #333;
            border: none;
            padding: 8px;
            border-radius: 2px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-type-button:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }

        .map-type-button:active {
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .map-type-menu {
            position: absolute;
            top: 120px;
            right: 20px;
            z-index: 1001;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            min-width: 200px;
            display: none;
            overflow: hidden;
        }

        .map-type-menu.active {
            display: block;
        }

        .map-type-menu-header {
            padding: 12px 16px;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            font-size: 14px;
            color: #333;
        }

        .map-type-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background-color 0.2s;
            border-bottom: 1px solid #f5f5f5;
        }

        .map-type-menu-item:last-child {
            border-bottom: none;
        }

        .map-type-menu-item:hover {
            background-color: #f5f5f5;
        }

        .map-type-menu-item.active {
            background-color: #e3f2fd;
        }

        .map-type-menu-item-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-type-menu-item-label {
            flex: 1;
            font-size: 14px;
            color: #333;
        }

        .map-type-menu-item-check {
            width: 20px;
            height: 20px;
            color: #1976d2;
            display: none;
        }

        .map-type-menu-item.active .map-type-menu-item-check {
            display: block;
        }

        /* ===== ELEMENTOS CARTOGRÁFICOS PROFESIONALES ===== */

        /* Barra de búsqueda (sobre el mapa, a la derecha del menú) */
        .search-container {
            position: absolute;
            top: 15px;
            left: 295px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            overflow: hidden;
            width: 320px;
            transition: box-shadow 0.3s, width 0.3s;
        }

        .search-box:focus-within {
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            width: 380px;
        }

        .search-box input {
            flex: 1;
            border: none;
            padding: 12px 16px;
            font-size: 14px;
            outline: none;
            background: transparent;
        }

        .search-box input::placeholder {
            color: #999;
        }

        .search-box button {
            background: none;
            border: none;
            padding: 12px 16px;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s, background 0.2s;
        }

        .search-box button:hover {
            color: #8B1538;
            background: #f5f5f5;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            margin-top: 4px;
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .search-result-icon.historical {
            background: #e3f2fd;
            color: #1565C0;
        }

        .search-result-icon.business {
            background: #fff3e0;
            color: #E65100;
        }

        .search-result-text {
            flex: 1;
        }

        .search-result-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .search-result-category {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
        }

        /* Botón de ruta en resultados de búsqueda */
        .search-route-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s;
        }

        .search-result-item:hover .search-route-btn {
            opacity: 1;
            transform: scale(1);
        }

        .search-route-btn:hover {
            background: linear-gradient(135deg, #1557b0 0%, #1a73e8 100%);
            transform: scale(1.1) !important;
        }

        .search-route-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Logo del mapa - más vertical y pequeño, sobre el mapa */
        .map-logo {
            position: absolute;
            top: 70px;
            left: 295px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 6px 8px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(136, 14, 79, 0.2);
            border: 2px solid #f79ed6;
            transition: all 0.3s ease;
        }

        .map-logo:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(136, 14, 79, 0.3);
        }

        .map-logo img {
            max-width: 72px;
            width: auto;
            height: auto;
            max-height: 52px;
            display: block;
        }

        /* Título del mapa - centro superior */
        .map-title {
            display: none; /* Ocultamos el título central, usamos el logo */
        }

        /* Indicador de Norte - alineado con panel de controles */
        .north-indicator {
            position: absolute;
            top: 15px;
            right: 10px;
            z-index: 1000;
            background: white;
            border-radius: 4px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .north-indicator svg {
            width: 24px;
            height: 24px;
        }

        /* Leyenda - estilo Ciudad de las Rosas */
        .legend {
            position: absolute;
            bottom: 140px;
            left: 295px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(136, 14, 79, 0.15);
            padding: 12px 16px;
            min-width: 180px;
            border: 2px solid #f79ed6;
        }

        .legend-header {
            font-size: 12px;
            font-weight: 600;
            color: #880e4f;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f79ed6;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 0;
            font-size: 12px;
            color: #555;
        }

        .legend-symbol {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .legend-symbol.historical {
            background: #e3f2fd;
            border: 2px solid #1565C0;
        }

        .legend-symbol.business {
            background: #fdf2f5;
            border: 2px solid #8B1538;
        }

        .legend-symbol.user {
            background: #e3f2fd;
            border: 2px solid #4285F4;
        }

        .legend-symbol svg {
            width: 12px;
            height: 12px;
        }

        /* Escala personalizada */
        .scale-bar {
            position: absolute;
            bottom: 30px;
            right: 15px;
            z-index: 1000;
            background: rgba(255,255,255,0.95);
            border-radius: 6px;
            padding: 8px 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            font-size: 11px;
            color: #555;
        }

        .scale-bar-line {
            display: flex;
            align-items: flex-end;
            margin-top: 4px;
        }

        .scale-bar-segment {
            height: 4px;
            border-left: 2px solid #333;
            border-right: 2px solid #333;
            border-bottom: 2px solid #333;
        }

        .scale-bar-segment:first-child {
            background: #333;
        }

        .scale-bar-segment:last-child {
            background: transparent;
        }

        /* ===== PANEL DE CONTROLES LATERAL DERECHO ===== */
        .controls-panel {
            position: absolute;
            top: 70px;
            right: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: calc(100vh - 90px);
            overflow-y: auto;
            overflow-x: visible;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: all 0.2s;
            color: #666;
            border-radius: 4px;
        }

        .control-btn:hover {
            background: #f5f5f5;
            box-shadow: 0 4px 8px rgba(0,0,0,0.25);
        }

        .control-btn:active {
            background: #eee;
        }

        .control-btn.active {
            background: #e3f2fd;
            color: #1976d2;
        }

        .control-btn svg {
            width: 22px;
            height: 22px;
        }

        .control-btn-translate {
            width: auto;
            min-width: 40px;
            padding: 0 8px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.02em;
            color: #5d4037;
        }

        /* Grupo de zoom */
        .zoom-group {
            display: flex;
            flex-direction: column;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .zoom-group .control-btn {
            border-radius: 0;
            box-shadow: none;
        }

        .zoom-group .control-btn:first-child {
            border-radius: 4px 4px 0 0;
        }

        .zoom-group .control-btn:last-child {
            border-radius: 0 0 4px 4px;
        }

        .zoom-group .control-btn + .control-btn {
            border-top: 1px solid #e0e0e0;
        }

        /* Separador visual */
        .control-separator {
            height: 1px;
            background: #e0e0e0;
            margin: 4px 0;
        }

        /* Ajustar posiciones de menús */
        .layers-button, .map-type-button, .geolocation-button {
            position: static;
            box-shadow: none;
        }

        .layers-menu {
            position: absolute;
            top: 200px;
            right: 60px;
        }

        .map-type-menu {
            position: absolute;
            top: 150px;
            right: 60px;
        }

        /* ===== ETIQUETAS DE ZONAS ESTILO MAPA ILUSTRADO ===== */
        .zone-label {
            position: absolute;
            font-family: 'Bebas Neue', 'Oswald', 'Arial Narrow', sans-serif;
            font-weight: 400;
            text-transform: uppercase;
            color: #b71c6c;
            pointer-events: none;
            white-space: nowrap;
            letter-spacing: 1.5px;
            z-index: 100;
        }

        /* Zona grande - como ZONA CENTRO, ZONA CHAPULTEPEC */
        .zone-label.zona-grande {
            font-size: 16px;
            font-family: 'Bebas Neue', sans-serif;
            color: #ad1457;
            letter-spacing: 3px;
        }

        /* Barrio/Colonia normal */
        .zone-label.barrio {
            font-size: 13px;
            font-family: 'Bebas Neue', sans-serif;
            color: #c2185b;
            letter-spacing: 2px;
        }

        /* Barrio pequeño - lugares menores */
        .zone-label.barrio-small {
            font-size: 10px;
            font-family: 'Oswald', sans-serif;
            font-weight: 500;
            color: #d81b60;
            letter-spacing: 1px;
        }

        /* Glorietas y plazas */
        .zone-label.glorieta {
            font-size: 9px;
            font-family: 'Oswald', sans-serif;
            font-weight: 500;
            color: #ad1457;
            letter-spacing: 1px;
        }

        /* Avenidas */
        .zone-label.avenida {
            font-size: 8px;
            font-family: 'Archivo Narrow', 'Oswald', sans-serif;
            font-weight: 600;
            color: #7b1fa2;
            letter-spacing: 0.5px;
        }

        .zone-label-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0px;
            line-height: 1;
        }

        .zone-label-prefix {
            font-size: 7px;
            font-family: 'Oswald', sans-serif;
            font-weight: 400;
            color: #c2185b;
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        .zone-label-name {
            font-size: 14px;
            font-family: 'Bebas Neue', sans-serif;
            color: #ad1457;
            letter-spacing: 2px;
        }

        /* ===== DISEÑO RESPONSIVO ===== */

        /* Tablet 769px-960px */
        @media (min-width: 769px) and (max-width: 960px) {
            .north-indicator {
                right: 10px;
            }
            .controls-panel {
                right: 10px;
            }
            .layers-menu,
            .map-type-menu {
                right: 50px;
            }
        }

        /* Tablets y móviles: sidebar izquierdo como drawer, mapa a ancho completo */
        @media (max-width: 768px) {
            .sidebar-btn-open {
                display: flex;
            }
            .sidebar-btn-close {
                display: flex;
            }
            .sidebar-puntos {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                width: 280px;
                max-width: 85vw;
                box-shadow: 4px 0 24px rgba(0,0,0,0.2);
                z-index: 600;
            }
            .sidebar-puntos.open {
                transform: translateX(0);
            }
            .sidebar-puntos-header {
                padding-top: 8px;
            }
            .sidebar-puntos-header img {
                max-height: 120px;
            }
            /* Ocultar logo y búsqueda sobre el mapa cuando el menú izquierdo está abierto (evitar solapamiento) */
            body:has(.sidebar-puntos.open) .map-logo,
            body:has(.sidebar-puntos.open) .search-container {
                opacity: 0;
                visibility: hidden;
                pointer-events: none;
            }
            #map {
                left: 0;
                width: 100%;
                height: calc(100vh - 110px);
            }
            .sidebar-puntos {
                height: calc(100vh - 110px);
            }
            .map-title {
                display: none;
            }
            .map-logo {
                top: 70px;
                left: 112px;
                padding: 5px 6px;
                transition: opacity 0.2s, visibility 0.2s;
            }
            .map-logo img {
                max-width: 58px;
                max-height: 42px;
            }
            .search-container {
                left: 112px;
                right: 50px;
                transition: opacity 0.2s, visibility 0.2s;
            }
            .search-box {
                width: 200px;
                max-width: calc(100vw - 80px);
            }
            .search-box:focus-within {
                width: 280px;
                max-width: calc(100vw - 80px);
            }
            .legend {
                max-width: 160px;
                padding: 10px 12px;
                bottom: 120px;
                left: 12px;
            }
            body:has(.sidebar-puntos.open) .legend {
                opacity: 0;
                visibility: hidden;
                pointer-events: none;
            }
            .legend-item span {
                font-size: 11px;
            }
        }

        /* Móviles pequeños */
        @media (max-width: 480px) {
            .sidebar-puntos {
                width: 260px;
                max-width: 88vw;
            }
            .sidebar-translate-btn {
                font-size: 12px;
                padding: 10px 12px;
            }
            .search-container {
                left: 112px;
                right: 50px;
            }
            .map-logo {
                left: 112px;
            }
            .map-logo img {
                max-width: 52px;
                max-height: 38px;
            }
            .search-box {
                width: 100%;
            }
            .search-box:focus-within {
                width: 100%;
            }
            .search-box input {
                padding: 10px 12px;
                font-size: 13px;
            }
            .legend {
                bottom: 180px;
                left: 12px;
                max-width: 140px;
                padding: 8px 10px;
            }

            .legend-header {
                font-size: 10px;
                margin-bottom: 6px;
                padding-bottom: 6px;
            }

            .legend-item {
                padding: 4px 0;
            }

            .legend-symbol {
                width: 16px;
                height: 16px;
            }

            .legend-item span {
                font-size: 10px;
            }

            .controls-panel {
                right: 10px;
                top: 60px;
                gap: 6px;
            }

            .control-btn {
                width: 36px;
                height: 36px;
            }

            .control-btn svg {
                width: 18px;
                height: 18px;
            }

            .north-indicator {
                right: 10px;
                width: 36px;
                height: 36px;
            }

            .north-indicator svg {
                width: 20px;
                height: 20px;
            }

            .layers-menu,
            .map-type-menu {
                right: 50px;
                min-width: 180px;
            }
        }

        /* Ocultar elementos cuando el panel de rutas está activo en móvil */
        @media (max-width: 768px) {
            .route-panel.active ~ .legend,
            body:has(.route-panel.active) .legend {
                display: none;
            }

            .route-panel.active ~ .map-logo,
            body:has(.route-panel.active) .map-logo {
                opacity: 0.6;
                transform: scale(0.85);
                transform-origin: top left;
                transition: all 0.3s ease;
            }

            /* InfoWindow en móvil: scroll para ver todo (Dirección, Cómo llegar, etc.) */
            .gm-style-iw-d {
                max-height: 75vh !important;
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
            }
            .gm-style-iw-c {
                max-width: 280px !important;
                max-height: 75vh !important;
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
            }

            .info-window {
                max-width: 260px;
            }

            .info-window-header {
                padding: 12px;
            }

            .info-window h3 {
                font-size: 14px;
            }

            .info-window p {
                font-size: 12px;
                max-height: 10em;
                overflow-y: auto;
            }

            .info-window-body {
                padding: 12px;
            }

            .info-window .address {
                padding: 10px;
                font-size: 12px;
            }

            .info-window-footer {
                padding: 10px 12px;
            }

            .info-window .contact-item {
                padding: 5px 8px;
                font-size: 11px;
            }

            .info-window .route-btn {
                padding: 10px 12px;
                font-size: 11px;
            }
        }

        /* Responsivo cuando la página está embebida en iframe (ej. WordPress) */
        html.embedded,
        html.embedded body {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        html.embedded body {
            min-height: 100%;
        }
        /* Tooltip más compacto cuando está embebido: que quepa todo sin scroll (Cómo llegar, Street View) */
        html.embedded .gm-style-iw-d {
            max-height: none !important;
            overflow: visible !important;
        }
        html.embedded .info-window-header {
            padding: 8px 10px;
        }
        html.embedded .info-window h3 {
            font-size: 14px;
            margin-bottom: 2px;
        }
        html.embedded .info-window-body {
            padding: 8px 10px;
        }
        html.embedded .info-window p {
            margin-bottom: 6px;
            max-height: 8em;
            overflow-y: auto;
        }
        html.embedded .gallery-container {
            margin: 6px 0;
        }
        html.embedded .gallery-main {
            height: 100px;
        }
        html.embedded .gallery-thumb {
            width: 34px;
            height: 34px;
        }
        html.embedded .gallery-thumbnails {
            padding: 6px;
        }
        html.embedded .info-window .address {
            margin-top: 6px;
            padding: 6px 8px;
            font-size: 11px;
        }
        html.embedded .info-window-footer {
            padding: 6px 10px;
        }
        html.embedded .info-window-actions {
            margin-top: 6px !important;
        }
    </style>
</head>
<body>
    <script>
        (function(){ if (window.self !== window.top) document.documentElement.classList.add('embedded'); })();
    </script>
    <!-- Overlay para cerrar sidebar en móvil (solo visible en pantallas pequeñas) -->
    <div class="sidebar-overlay" id="sidebarOverlay" aria-hidden="true"></div>

    <!-- Botón abrir menú lateral izquierdo (solo visible en móvil) -->
    <button type="button" class="sidebar-btn-open" id="sidebarBtnOpen" title="Abrir lista de lugares" aria-label="Abrir lista de lugares">
        <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
    </button>
    <!-- Menú lateral: lista de puntos con cabecera -->
    <aside class="sidebar-puntos" id="sidebarPuntos">
        <div class="sidebar-puntos-header">
            <button type="button" class="sidebar-btn-close" id="sidebarBtnClose" title="Cerrar" aria-label="Cerrar menú">
                <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
            <img id="imgSidebarIzq" src="assets/Captura%20de%20pantalla%202026-02-04%20101053.png" alt="Guadalajara Ciudad de las Rosas">
        </div>
        <div class="sidebar-translate-wrap">
            <button type="button" class="sidebar-translate-btn js-btn-translate" title="Traducir al inglés" aria-label="Traducir al inglés">
                <span class="js-btn-translate-text">English</span>
            </button>
        </div>
        <ul class="sidebar-puntos-list" id="sidebarPuntosList"></ul>
    </aside>

    <!-- Franja de logos: solo logos de negocios, cada uno redirige a su punto en el mapa -->
    <section class="anunciantes-strip" id="anunciantesStrip" aria-label="Comercios destacados">
        <a class="anuncio-panel" href="#" data-marker-index="14" title="GUARDIÁN CAFÉ-GALERÍA">
            <div class="anuncio-content">
                <span class="anuncio-num">1</span>
                <span class="anuncio-titulo">GUARDIÁN CAFÉ-GALERÍA</span>
                <span class="anuncio-direccion">Av. Alcalde 207, Col. Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/CAFE GUARDIAN_page-0001.jpg" alt="GUARDIÁN Café Galería">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="15" title="TORTAS AHOGADAS Las Famosas">
            <div class="anuncio-content">
                <span class="anuncio-num">2</span>
                <span class="anuncio-titulo">TORTAS AHOGADAS Las Famosas</span>
                <span class="anuncio-direccion">Paseo Degollado 128, Centro Histórico</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/anuncio TORTAS enero 2026_page-0001.jpg" alt="Tortas Ahogadas">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="16" title="HOTEL ALÓ">
            <div class="anuncio-content">
                <span class="anuncio-num">3</span>
                <span class="anuncio-titulo">HOTEL ALÓ</span>
                <span class="anuncio-direccion">Paseo Degollado 54, Zona Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/fotos-anunciantes/hotel-alo/Captura de Pantalla 2026-02-03 a la(s) 21.07.18.png" alt="Hotel Aló">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="17" title="HOTEL OLÁ">
            <div class="anuncio-content">
                <span class="anuncio-num">4</span>
                <span class="anuncio-titulo">HOTEL OLÁ</span>
                <span class="anuncio-direccion">Av. Chapultepec Norte 20A, Americana</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/fotos-anunciantes/hotel-ola/Captura de Pantalla 2026-02-03 a la(s) 21.08.51.png" alt="Hotel Holá">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="18" title="RESTAURANT LOS PACEÑOS">
            <div class="anuncio-content">
                <span class="anuncio-num">5</span>
                <span class="anuncio-titulo">RESTAURANT LOS PACEÑOS</span>
                <span class="anuncio-direccion">Morelos 126, Centro Histórico</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/fotos-anunciantes/pacenos/Captura de Pantalla 2026-02-03 a la(s) 20.46.53.png" alt="Los Paceños">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="19" title="TARASKA HELADOS Y PALETAS">
            <div class="anuncio-content">
                <span class="anuncio-num">6</span>
                <span class="anuncio-titulo">TARASKA HELADOS Y PALETAS</span>
                <span class="anuncio-direccion">Paletería y nevería, Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/TARASKAS - Las mejores AGUAS FRESCAS (2)_page-0001.jpg" alt="Taraska">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="23" title="RAGAZZA FASHION">
            <div class="anuncio-content">
                <span class="anuncio-num">7</span>
                <span class="anuncio-titulo">RAGAZZA FASHION</span>
                <span class="anuncio-direccion">Av. Juárez 210, Col. Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.16.38.png" alt="Ragazza Fashion">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="11" title="Ex Convento de Santa Teresa">
            <div class="anuncio-content">
                <span class="anuncio-num">8</span>
                <span class="anuncio-titulo">Ex Convento de Santa Teresa</span>
                <span class="anuncio-direccion">Eventos con historia, Donato Guerra 25</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/galeria-ex-convento/1.png" alt="Ex Convento Santa Teresa">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="10" title="RESTAURANTE CASA DOLORES">
            <div class="anuncio-content">
                <span class="anuncio-num">9</span>
                <span class="anuncio-titulo">RESTAURANTE CASA DOLORES</span>
                <span class="anuncio-direccion">Paseo Alcalde 22, Col. Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/DOL-9.5x10cm 01.jpg" alt="Casa Dolores">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="12" title="Casa Anguiano">
            <div class="anuncio-content">
                <span class="anuncio-num">10</span>
                <span class="anuncio-titulo">Casa Anguiano</span>
                <span class="anuncio-direccion">Av. Fray Antonio Alcalde 113, Col. Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/Casa Anguiano - Modulo PDF_page-0001.jpg" alt="Casa Anguiano">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="13" title="EL PILÓN DE LOS ARRIEROS">
            <div class="anuncio-content">
                <span class="anuncio-num">11</span>
                <span class="anuncio-titulo">EL PILÓN DE LOS ARRIEROS</span>
                <span class="anuncio-direccion">Galeana 388, Plaza de las 9 esquinas</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/ANUNCIO PILON DE LOS ARRIEROS_page-0001.jpg" alt="Pilón de los Arrieros">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="22" title="HOTEL ONE GUADALAJARA CENTRO">
            <div class="anuncio-content">
                <span class="anuncio-num">12</span>
                <span class="anuncio-titulo">HOTEL ONE GUADALAJARA CENTRO</span>
                <span class="anuncio-direccion">Av. 16 de Septiembre 16, Centro Histórico</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/Hotel ONE.jpg" alt="Hotel ONE">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="30" title="EL MESÓN">
            <div class="anuncio-content">
                <span class="anuncio-num">13</span>
                <span class="anuncio-titulo">EL MESÓN</span>
                <span class="anuncio-direccion">Pino Suárez 92, Col. Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/ANUNCIO EL MESON (1)_page-0001.jpg" alt="El Mesón">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="32" title="CARNITAS URUAPAN">
            <div class="anuncio-content">
                <span class="anuncio-num">14</span>
                <span class="anuncio-titulo">CARNITAS URUAPAN</span>
                <span class="anuncio-direccion">Colón 368, Plaza de las 9 Esquinas</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/ANUNCIO CARNITAS URUAPAN_page-0001.jpg" alt="Carnitas Uruapan">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="33" title="FARMACIA Y BOTICA TOLEDO">
            <div class="anuncio-content">
                <span class="anuncio-num">15</span>
                <span class="anuncio-titulo">FARMACIA Y BOTICA TOLEDO</span>
                <span class="anuncio-direccion">Herrera y Cairo 422, Col. Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/ANUNCIO TOLEDO.jpeg" alt="Botica Toledo">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="35" title="MERCADO DE LAS FLORES">
            <div class="anuncio-content">
                <span class="anuncio-num">16</span>
                <span class="anuncio-titulo">MERCADO DE LAS FLORES</span>
                <span class="anuncio-direccion">Mezquitán 901, Col. Mezquitán</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/mercado de las flores_page-0001.jpg" alt="Mercado de las Flores">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="36" title="CALANDRIAS ELÉCTRICAS">
            <div class="anuncio-content">
                <span class="anuncio-num">17</span>
                <span class="anuncio-titulo">CALANDRIAS ELÉCTRICAS</span>
                <span class="anuncio-direccion">Av. Hidalgo, cerca de Catedral</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/calandrias_page-0001.jpg" alt="Calandrias">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="37" title="ARTÍCULOS RELIGIOSOS LA GLORIA">
            <div class="anuncio-content">
                <span class="anuncio-num">18</span>
                <span class="anuncio-titulo">ARTÍCULOS RELIGIOSOS LA GLORIA</span>
                <span class="anuncio-direccion">Pedro Loza 189, Col. Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/ANUNCIO LA GLORIA.jpeg" alt="La Gloria">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="38" title="CASA CARRANZA">
            <div class="anuncio-content">
                <span class="anuncio-num">19</span>
                <span class="anuncio-titulo">CASA CARRANZA</span>
                <span class="anuncio-direccion">Venustiano Carranza 242, Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/CASA CARRANZA.jpg" alt="Casa Carranza">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="39" title="GUASANGA RESTAURANT">
            <div class="anuncio-content">
                <span class="anuncio-num">20</span>
                <span class="anuncio-titulo">GUASANGA RESTAURANT</span>
                <span class="anuncio-direccion">Morelos 417, Centro Histórico</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/Guasanga mapa Guadalajara ciudad de las rosas_page-0001.jpg" alt="Guasanga">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="40" title="LOS FAMOSOS EQUIPALES">
            <div class="anuncio-content">
                <span class="anuncio-num">21</span>
                <span class="anuncio-titulo">LOS FAMOSOS EQUIPALES</span>
                <span class="anuncio-direccion">Juan Álvarez 704, Col. Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/ANUNCIO LOS EQUIPALES_page-0001.jpg" alt="Los Equipales">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="41" title="MARIACHI MÉXICO EN LA PIEL">
            <div class="anuncio-content">
                <span class="anuncio-num">22</span>
                <span class="anuncio-titulo">MARIACHI MÉXICO EN LA PIEL</span>
                <span class="anuncio-direccion">Eventos en Zona Metropolitana GDL</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/mariachi02_page-0001.jpg" alt="Mariachi">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="43" title="MIMOSA PROMOCIONALES">
            <div class="anuncio-content">
                <span class="anuncio-num">23</span>
                <span class="anuncio-titulo">MIMOSA PROMOCIONALES</span>
                <span class="anuncio-direccion">Enrique Díaz de León 13, Villaseñor</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/MIMOSA_page-0001.jpg" alt="Mimosa">
            </div>
        </a>
        <a class="anuncio-panel" href="#" data-marker-index="44" title="TAKASAMI">
            <div class="anuncio-content">
                <span class="anuncio-num">24</span>
                <span class="anuncio-titulo">TAKASAMI</span>
                <span class="anuncio-direccion">Matamoros 12, Tlaquepaque Centro</span>
            </div>
            <div class="anuncio-img-wrap">
                <img src="assets/Anuncios/takasami_page-0001.jpg" alt="Takasami">
            </div>
        </a>
    </section>

    <script>
        (function() {
            var path = location.pathname;
            if (!path.endsWith('/')) path = path.replace(/[^/]+$/, '') || '/';
            var base = location.origin + path;
            var imgIzq = document.getElementById('imgSidebarIzq');
            var imgDer = document.getElementById('imgSidebarDer');
            if (imgIzq) imgIzq.src = base + 'assets/Captura%20de%20pantalla%202026-02-04%20101053.png';
            if (imgDer) imgDer.src = base + 'assets/Captura%20de%20pantalla%202026-02-04%20101953.png';
        })();
    </script>

    <script>
        (function() {
            var strip = document.getElementById('anunciantesStrip');
            if (!strip) return;
            var panels = strip.querySelectorAll('.anuncio-panel');
            var n = panels.length;
            if (n === 0) return;
            for (var i = 0; i < n; i++) strip.appendChild(panels[i].cloneNode(true));
            var firstSetWidth = 0;
            var step = 2;
            var intervalMs = 20;
            function run() {
                if (window._stripPaused || firstSetWidth <= 0) return;
                strip.scrollLeft += step;
                if (strip.scrollLeft >= firstSetWidth - 1) strip.scrollLeft = 0;
            }
            strip.addEventListener('touchstart', function() { window._stripPaused = true; });
            strip.addEventListener('touchend', function() { setTimeout(function() { window._stripPaused = false; }, 3000); });
            strip.addEventListener('mouseenter', function() { window._stripPaused = true; });
            strip.addEventListener('mouseleave', function() { window._stripPaused = false; });
            function startCarousel() {
                var first = strip.querySelector('.anuncio-panel');
                if (first) {
                    var gap = 8;
                    firstSetWidth = n * first.offsetWidth + (n - 1) * gap;
                }
                setInterval(run, intervalMs);
            }
            if (document.readyState === 'loading') {
                window.addEventListener('load', startCarousel);
            } else {
                startCarousel();
            }
        })();
    </script>

    <script>
        (function() {
            var currentLang = 'es';
            var T = {
                es: {
                    searchPlaceholder: 'Buscar lugares...',
                    searchTitle: 'Buscar',
                    zoomIn: 'Acercar',
                    zoomOut: 'Alejar',
                    mapType: 'Tipo de mapa',
                    layers: 'Capas del mapa',
                    streetView: 'Vista de calle',
                    myLocation: 'Mi ubicación',
                    translateBtn: 'Traducir al inglés',
                    translateBtnLabel: 'English',
                    legend: 'LEYENDA',
                    legendHistoric: 'Edificio Histórico',
                    legendBusiness: 'Empresa / Comercio',
                    legendLocation: 'Tu ubicación',
                    tooltipLabels: {
                        direccion: 'Dirección',
                        verRuta: 'Cómo llegar',
                        streetView: 'Street View',
                        verStreetView: 'Ver Street View',
                        whatsapp: 'WhatsApp',
                        web: 'Web',
                        instagram: 'Instagram',
                        facebook: 'Facebook'
                    },
                },
                en: {
                    searchPlaceholder: 'Search places...',
                    searchTitle: 'Search',
                    zoomIn: 'Zoom in',
                    zoomOut: 'Zoom out',
                    mapType: 'Map type',
                    layers: 'Map layers',
                    streetView: 'Street View',
                    myLocation: 'My location',
                    translateBtn: 'Translate to Spanish',
                    translateBtnLabel: 'ES',
                    legend: 'LEGEND',
                    legendHistoric: 'Historic Building',
                    legendBusiness: 'Business / Commerce',
                    legendLocation: 'Your location',
                    tooltipLabels: {
                        direccion: 'Address',
                        verRuta: 'Get directions',
                        streetView: 'Street View',
                        verStreetView: 'View Street View',
                        whatsapp: 'WhatsApp',
                        web: 'Web',
                        instagram: 'Instagram',
                        facebook: 'Facebook'
                    },
                    sidebarLeftNames: {
                        'Santuario de Nuestra Señora de Guadalupe': 'Shrine of Our Lady of Guadalupe',
                        'Catedral de Guadalajara': 'Guadalajara Cathedral',
                        'Rotonda de los Jaliscienses Ilustres': 'Rotonda of Illustrious Jaliscienses',
                        'Mercado San Juan de Dios': 'San Juan de Dios Market',
                        'Palacio de Gobierno': 'Government Palace',
                        'Teatro Degollado': 'Degollado Theatre',
                        'Museo Regional de Guadalajara': 'Regional Museum of Guadalajara',
                        'Hospicio Cabañas': 'Hospicio Cabañas',
                        'Glorieta Minerva': 'Minerva Roundabout',
                        'Glorieta de la Minerva': 'Minerva Roundabout',
                        'Arcos de Guadalajara': 'Guadalajara Arches',
                        'Los Arcos de Guadalajara': 'Guadalajara Arches',
                        'Museo Regional': 'Regional Museum of Guadalajara',
                        'Museo Cabañas': 'Cabañas Museum',
                        'Mercado de San Juan de Dios': 'San Juan de Dios Market',
                        'Restaurante Casa Dolores': 'Casa Dolores Restaurant',
                        'Ex Convento de Santa Teresa': 'Ex Convent of Santa Teresa',
                        'Casa Anguiano': 'Casa Anguiano',
                        'El Pilón de los Arrieros': 'El Pilón de los Arrieros',
                        'GUARDIÁN Café Galería': 'GUARDIAN Café Gallery',
                        'GUARDIÁN CAFÉ-GALERÍA': 'GUARDIAN Café-Gallery',
                        'TORTAS AHOGAS Las Famosas': 'Las Famosas Drowned Tortas',
                        'TORTAS AHOGADAS Las Famosas': 'Las Famosas Drowned Tortas',
                        'HOTEL Aló': 'Aló Hotel',
                        'HOTEL ALÓ': 'Aló Hotel',
                        'HOTEL Holá': 'Holá Hotel',
                        'HOTEL Olá': 'OLÁ Hotel',
                        'HOTEL OLÁ': 'OLÁ Hotel',
                        'RESTAURANT Los Paceños': 'Los Paceños Restaurant',
                        'RESTAURANT LOS PACEÑOS': 'Los Paceños Restaurant',
                        'TARASKA Helados y Paletas': 'TARASKA Ice Cream and Popsicles',
                        'TARASKA HELADOS Y PALETAS': 'TARASKA Ice Cream and Popsicles',
                        'EX-CONVENTO DE SANTA TERESA': 'Ex Convent of Santa Teresa',
                        'EX CONVENTO DE SANTA TERESA': 'Ex Convent of Santa Teresa',
                        'HOTEL ONE Guadalajara Centro': 'ONE Hotel Guadalajara Downtown',
                        'HOTEL ONE GUADALAJARA CENTRO': 'ONE Hotel Guadalajara Downtown',
                        'RAGAZZA Fashion': 'RAGAZZA Fashion',
                        'RAGAZZA FASHION': 'RAGAZZA Fashion',
                        'CASA Dolores Restaurant': 'Casa Dolores Restaurant',
                        'RESTAURANT Casa Dolores': 'Casa Dolores Restaurant',
                        'RESTAURANTE CASA DOLORES': 'Casa Dolores Restaurant',
                        'ALMA JALISCO Restaurant': 'ALMA JALISCO Restaurant',
                        'ALMA JALISCO RESTAURANT': 'ALMA JALISCO Restaurant',
                        'CONOCE JALISCO Tours': 'CONOCE JALISCO Tours',
                        'CONOCE JALISCO TOURS': 'CONOCE JALISCO Tours',
                        'CASA ANGUIANO Artículos Religiosos': 'Casa Anguiano Religious Articles',
                        'CASA ANGUIANO': 'Casa Anguiano',
                        'EL MESÓN Restaurant Bar': 'El Mesón Restaurant Bar',
                        'EL MESÓN': 'El Mesón Restaurant Bar',
                        'BIRRIERÍA El Pilón de los Arrieros': 'El Pilón de los Arrieros Birria',
                        'BIRRIERIA El Pilón de los Arrieros': 'El Pilón de los Arrieros Birria',
                        'EL PILÓN DE LOS ARRIEROS': 'El Pilón de los Arrieros',
                        'RESTAURANT BAR El Mesón': 'El Mesón Restaurant Bar',
                        'CARNITAS Uruapan': 'Carnitas Uruapan',
                        'CARNITAS URUAPAN': 'Carnitas Uruapan',
                        'BOTICA Toledo': 'Toledo Pharmacy (Botica)',
                        'FARMACIA Toledo': 'Toledo Pharmacy',
                        'FARMACIA Y BOTICA TOLEDO': 'Toledo Pharmacy and Botica',
                        'MERCADO de las Flores': 'Flower Market',
                        'MERCADO DE LAS FLORES': 'Flower Market',
                        'CALANDRIA Eléctricas': 'CALANDRIA Electric Streetcars',
                        'CALANDRIAS ELÉCTRICAS': 'CALANDRIA Electric Streetcars',
                        'CALANDRIAS eléctricas': 'CALANDRIA Electric Streetcars',
                        'LA GLORIA Artículos Religiosos': 'La Gloria Religious Articles',
                        'ARTÍCULOS RELIGIOSOS LA GLORIA': 'La Gloria Religious Articles',
                        'CASA CARRANZA Hotel Airbnb': 'Casa Carranza Hotel Airbnb',
                        'CASA CARRANZA': 'Casa Carranza Boutique Hotel',
                        'RESTAURANT Guasanga': 'Guasanga Restaurant',
                        'GUASANGA RESTAURANT': 'Guasanga Restaurant',
                        'LOS FAMOSOS Equipales - Cantina': 'Los Famosos Equipales - Cantina',
                        'LOS FAMOSOS EQUIPALES': 'Los Famosos Equipales Cantina',
                        'CANTINA Los Famosos Equipales': 'Los Famosos Equipales Cantina',
                        'MARIACHI México en la Piel': 'MARIACHI México en la Piel',
                        'MARIACHI MÉXICO EN LA PIEL': 'MARIACHI México en la Piel',
                        'ACADEMIA Nuevo Jalisco': 'Nuevo Jalisco Academy',
                        'ACADEMIA NUEVO JALISCO': 'Nuevo Jalisco Academy',
                        'MIMOSA Artículos Promocionales': 'MIMOSA Promotional Items',
                        'MIMOSA Artículos Religiosos': 'MIMOSA Religious Articles',
                        'MIMOSA PROMOCIONALES': 'MIMOSA Promotional Items',
                        'TAKASAMI Clothing': 'TAKASAMI Clothing',
                        'TAKASAMI': 'TAKASAMI'
                    },
                    places: {
                        'Santuario de Nuestra Señora de Guadalupe': { nombre: 'Shrine of Our Lady of Guadalupe', categoria: 'HISTORIC BUILDING', direccion: 'Barrio del Santuario, Guadalajara, Jal.', descripcion: 'The first stone was laid on January 7, 1777 and after four years of construction, the church was inaugurated in 1781. The building was promoted and paid for by the Spanish philanthropist and then bishop of the diocese, Antonio Alcalde y Barriga, who had the idea of building a church in the northern part of Guadalajara, which was then practically uninhabited. Bishop Alcalde himself paid for the construction of the temple and several houses that would be rented at low cost to poor people who wanted to live in them, called "las cuadritas" in the Barrio del Santuario. The image of Our Lady of Guadalupe is in the main altar, a painting from 1779 by Don José de Alcíbar.' },
                        'Catedral de Guadalajara': { nombre: 'Guadalajara Cathedral', categoria: 'HISTORIC BUILDING', direccion: 'Av. Fray Antonio Alcalde, Zona Centro, Guadalajara, Jal.', descripcion: 'Officially the Cathedral Basilica of the Assumption of Mary, it is the seat of the Archdiocese of Guadalajara and one of the main Catholic temples in Mexico. Among the crypts, below what was the royal chapel, are those of the archbishops of Guadalajara dating from the 16th century. Notable dedications include La Virgen de las Rosas, Santiago el Mayor (patron of New Spain), La Virgen de Guadalupe, and Nuestra Señora de Zapopan, among others.' },
                        'Rotonda de los Jaliscienses Ilustres': { nombre: 'Rotonda of Illustrious Jaliscienses', categoria: 'HISTORIC BUILDING', direccion: 'Av. Fray Antonio Alcalde, Zona Centro, Guadalajara, Jal.', descripcion: 'A tribute to the people of Jalisco who have made their mark on history. The monument, built in 1952 by architect Vicente Mendiola at the initiative of then governor José de Jesús González Gallo, consists of seventeen fluted columns without base or capital supporting a stone ring engraved with the legend "Jalisco to its distinguished children"; in the center is a brazier and 98 niches for the remains of the most illustrious men and women born in Jalisco.' },
                        'Mercado San Juan de Dios': { nombre: 'San Juan de Dios Market', categoria: 'HISTORIC BUILDING', direccion: 'Calle Javier Mina, Zona Centro, Guadalajara, Jal.', descripcion: 'The largest covered market in Latin America. Designed by architect Alejandro Zohn, it opened on December 30, 1958. It is located on what was once the eastern bank of the San Juan de Dios River, near the capital of the former Nueva Galicia. The area was the entrance for supplies from Mexico City. Around 1880, Mariano Bárcena documented the market as one of Guadalajara\'s three main markets. It originally had the structure of a Mexican tianguis: wooden stands, canvas, tables and goods on the ground, all in the open air.' },
                        'Palacio de Gobierno': { nombre: 'Government Palace', categoria: 'HISTORIC BUILDING', direccion: 'Av. Corona, Zona Centro, Guadalajara, Jal.', descripcion: 'Original construction in 1650, destroyed by an earthquake and rebuilt. Seat of the Palace of the Royal Audiencia. It houses murals by José Clemente Orozco.' },
                        'Teatro Degollado': { nombre: 'Degollado Theatre', categoria: 'HISTORIC BUILDING', direccion: 'Plaza de la Liberación, Zona Centro, Guadalajara, Jal.', descripcion: 'Inaugurated in 1866, neoclassical architecture. Home to the Jalisco Philharmonic Orchestra and festivals; capacity 1,027 seats.' },
                        'Museo Regional de Guadalajara': { nombre: 'Regional Museum of Guadalajara', categoria: 'HISTORIC BUILDING', direccion: 'Calle Liceo 60, Zona Centro, Guadalajara, Jal.', descripcion: 'From military barracks (1810) to public library (1857); Regional Museum of Guadalajara since 1976.' },
                        'Hospicio Cabañas': { nombre: 'Hospicio Cabañas', categoria: 'HISTORIC BUILDING', direccion: 'Cabañas 8, Zona Centro, Guadalajara, Jal.', descripcion: 'UNESCO World Heritage Site. Designed by architect Manuel Tolsá; murals by José Clemente Orozco. Originally an orphanage founded by Bishop Juan Cruz Ruiz de Cabañas.' },
                        'Glorieta Minerva': { nombre: 'Minerva Roundabout', categoria: 'MONUMENT', direccion: 'Av. López Mateos y Av. Vallarta, Guadalajara, Jal.', descripcion: 'Iconic monument inaugurated in 1956, work of sculptor Joaquín Arias. It represents the Roman goddess Minerva; circular fountain with inscriptions.' },
                        'Glorieta de la Minerva': { nombre: 'Minerva Roundabout', categoria: 'MONUMENT', direccion: 'Av. López Mateos y Av. Vallarta, Guadalajara, Jal.', descripcion: 'Iconic monument inaugurated in 1956, work of sculptor Joaquín Arias. It represents the Roman goddess Minerva; circular fountain with inscriptions.' },
                        'Arcos de Guadalajara': { nombre: 'Guadalajara Arches', categoria: 'MONUMENT', direccion: 'Av. Vallarta, Col. Americana, Guadalajara, Jal.', descripcion: 'Located on Av. Vallarta; built between 1939 and 1942 by Aurelio Aceves to commemorate the 400th anniversary of the city.' },
                        'Los Arcos de Guadalajara': { nombre: 'Guadalajara Arches', categoria: 'MONUMENT', direccion: 'Av. Vallarta, Col. Americana, Guadalajara, Jal.', descripcion: 'Located on Av. Vallarta; built between 1939 and 1942 by Aurelio Aceves to commemorate the 400th anniversary of the city.' },
                        'Museo Regional': { nombre: 'Regional Museum of Guadalajara', categoria: 'HISTORIC BUILDING', direccion: 'Calle Liceo 60, Zona Centro, Guadalajara, Jal.', descripcion: 'From military barracks (1810) to public library (1857); Regional Museum of Guadalajara since 1976.' },
                        'Museo Cabañas': { nombre: 'Cabañas Museum', categoria: 'HISTORIC BUILDING', direccion: 'Cabañas 8, Zona Centro, Guadalajara, Jal.', descripcion: 'UNESCO World Heritage Site. Designed by architect Manuel Tolsá; murals by José Clemente Orozco. Originally an orphanage founded by Bishop Juan Cruz Ruiz de Cabañas.' },
                        'Mercado de San Juan de Dios': { nombre: 'San Juan de Dios Market', categoria: 'HISTORIC BUILDING', direccion: 'Calle Javier Mina, Zona Centro, Guadalajara, Jal.', descripcion: 'The largest covered market in Latin America. Designed by architect Alejandro Zohn, it opened on December 30, 1958.' },
                        'Restaurante Casa Dolores': { nombre: 'Casa Dolores Restaurant', categoria: 'RESTAURANT', direccion: 'Paseo Alcalde 22, Col. Centro. Guadalajara, Jal.', descripcion: 'MEXICAN FOOD - Inspired by the aroma of Mexico\'s history. We are a restaurant that celebrates the best of Mexico, transforming its traditional flavors, textures and aromas into the most exquisite Mexican cuisine dishes, the result of a careful selection of ingredients, keeping our legacy of being proudly Mexican very present.' },
                        'Ex Convento de Santa Teresa': { nombre: 'Ex Convent of Santa Teresa', categoria: 'EVENT VENUE', direccion: 'Donato Guerra 25, Zona Centro, 44100 Guadalajara, Jal.', descripcion: 'Where every corner is a beautiful historic space that will make your event stand out. A venue with 400 years of history that is part of the city\'s architectural heritage, to make your event the most memorable and exclusive experience. Founded in the 17th century by the order of the Discalced Carmelites as the first cloister in Guadalajara. "Our history is the ideal setting for your new stories."' },
                        'Casa Anguiano': { nombre: 'Casa Anguiano', categoria: 'RELIGIOUS ARTICLES', direccion: 'Av. Fray Antonio Alcalde 113, Col. Centro. Guadalajara, Jal.', descripcion: 'Founded in 1942. Leaders in the commercialization of religious articles in Mexico. Our company has a retail store in the center of beautiful Guadalajara, a few blocks from our emblematic Cathedral, as well as our own workshop where we manufacture various articles and provide services such as restoration of images and sacred metals, to name a few.' },
                        'El Pilón de los Arrieros': { nombre: 'El Pilón de los Arrieros', categoria: 'ARTISAN DINING', direccion: 'Calle Galeana 388, Plaza de las 9 esquinas, Centro Histórico. Guadalajara, Jal.', descripcion: 'Over 40 years of tradition. Lupita Figueroa owns all the recipes, serving excellent dishes with goat birria as the specialty, as well as lamb barbacoa, exquisite marinated pork shanks and cochinita pibil. Come and enjoy a feast of Mexican flavors. Artists, singers, actors and national and international radio and television personalities have dined at these tables.' },
                        'GUARDIÁN Café Galería': { nombre: 'GUARDIAN Café Gallery', categoria: 'CAFÉ GALLERY' },
                        'GUARDIÁN CAFÉ-GALERÍA': { nombre: 'GUARDIAN Café-Gallery', categoria: 'ECLECTIC GALLERY' },
                        'TORTAS AHOGAS Las Famosas': { nombre: 'Las Famosas Drowned Tortas', categoria: 'DINING' },
                        'TORTAS AHOGADAS Las Famosas': { nombre: 'Las Famosas Drowned Tortas', categoria: 'DINING' },
                        'HOTEL Aló': { nombre: 'Aló Hotel', categoria: 'HOTEL' },
                        'HOTEL ALÓ': { nombre: 'Aló Hotel', categoria: 'HOTEL' },
                        'HOTEL Holá': { nombre: 'Holá Hotel', categoria: 'HOTEL' },
                        'HOTEL OLÁ': { nombre: 'OLÁ Hotel', categoria: 'HOTEL' },
                        'RESTAURANT Los Paceños': { nombre: 'Los Paceños Restaurant', categoria: 'RESTAURANT' },
                        'RESTAURANT LOS PACEÑOS': { nombre: 'Los Paceños Restaurant', categoria: 'RESTAURANT' },
                        'TARASKA Helados y Paletas': { nombre: 'TARASKA Ice Cream and Popsicles', categoria: 'ICE CREAM' },
                        'TARASKA HELADOS Y PALETAS': { nombre: 'TARASKA Ice Cream and Popsicles', categoria: 'ICE CREAM' },
                        'EX-CONVENTO DE SANTA TERESA': { nombre: 'Ex Convent of Santa Teresa', categoria: 'EVENT VENUE' },
                        'EX CONVENTO DE SANTA TERESA': { nombre: 'Ex Convent of Santa Teresa', categoria: 'EVENT VENUE' },
                        'HOTEL ONE Guadalajara Centro': { nombre: 'ONE Hotel Guadalajara Downtown', categoria: 'HOTEL' },
                        'HOTEL ONE GUADALAJARA CENTRO': { nombre: 'ONE Hotel Guadalajara Downtown', categoria: 'HOTEL' },
                        'RAGAZZA Fashion': { nombre: 'RAGAZZA Fashion', categoria: 'FASHION' },
                        'RAGAZZA FASHION': { nombre: 'RAGAZZA Fashion', categoria: 'FASHION' },
                        'CASA Dolores Restaurant': { nombre: 'Casa Dolores Restaurant', categoria: 'RESTAURANT' },
                        'RESTAURANTE CASA DOLORES': { nombre: 'Casa Dolores Restaurant', categoria: 'RESTAURANT' },
                        'ALMA JALISCO Restaurant': { nombre: 'ALMA JALISCO Restaurant', categoria: 'RESTAURANT' },
                        'ALMA JALISCO RESTAURANT': { nombre: 'ALMA JALISCO Restaurant', categoria: 'RESTAURANT' },
                        'CONOCE JALISCO Tours': { nombre: 'CONOCE JALISCO Tours', categoria: 'TOURS' },
                        'CONOCE JALISCO TOURS': { nombre: 'CONOCE JALISCO Tours', categoria: 'TOURS' },
                        'CASA ANGUIANO Artículos Religiosos': { nombre: 'Casa Anguiano Religious Articles', categoria: 'RELIGIOUS ARTICLES' },
                        'CASA ANGUIANO': { nombre: 'Casa Anguiano', categoria: 'RELIGIOUS ARTICLES' },
                        'EL MESÓN Restaurant Bar': { nombre: 'El Mesón Restaurant Bar', categoria: 'RESTAURANT BAR' },
                        'EL MESÓN': { nombre: 'El Mesón Restaurant Bar', categoria: 'RESTAURANT BAR' },
                        'BIRRIERÍA El Pilón de los Arrieros': { nombre: 'El Pilón de los Arrieros Birria', categoria: 'DINING' },
                        'EL PILÓN DE LOS ARRIEROS': { nombre: 'El Pilón de los Arrieros', categoria: 'DINING' },
                        'CARNITAS Uruapan': { nombre: 'Carnitas Uruapan', categoria: 'DINING' },
                        'CARNITAS URUAPAN': { nombre: 'Carnitas Uruapan', categoria: 'DINING' },
                        'BOTICA Toledo': { nombre: 'Toledo Pharmacy (Botica)', categoria: 'PHARMACY' },
                        'FARMACIA Toledo': { nombre: 'Toledo Pharmacy', categoria: 'PHARMACY' },
                        'FARMACIA Y BOTICA TOLEDO': { nombre: 'Toledo Pharmacy and Botica', categoria: 'PHARMACY' },
                        'MERCADO de las Flores': { nombre: 'Flower Market', categoria: 'MARKET' },
                        'MERCADO DE LAS FLORES': { nombre: 'Flower Market', categoria: 'MARKET' },
                        'CALANDRIA Eléctricas': { nombre: 'CALANDRIA Electric Streetcars', categoria: 'TOURIST TRANSPORT' },
                        'CALANDRIAS ELÉCTRICAS': { nombre: 'CALANDRIA Electric Streetcars', categoria: 'TOURIST TRANSPORT' },
                        'LA GLORIA Artículos Religiosos': { nombre: 'La Gloria Religious Articles', categoria: 'RELIGIOUS ARTICLES' },
                        'ARTÍCULOS RELIGIOSOS LA GLORIA': { nombre: 'La Gloria Religious Articles', categoria: 'RELIGIOUS ARTICLES' },
                        'CASA CARRANZA Hotel Airbnb': { nombre: 'Casa Carranza Hotel Airbnb', categoria: 'HOTEL' },
                        'CASA CARRANZA': { nombre: 'Casa Carranza Boutique Hotel', categoria: 'HOTEL' },
                        'RESTAURANT Guasanga': { nombre: 'Guasanga Restaurant', categoria: 'RESTAURANT' },
                        'GUASANGA RESTAURANT': { nombre: 'Guasanga Restaurant', categoria: 'RESTAURANT' },
                        'LOS FAMOSOS Equipales - Cantina': { nombre: 'Los Famosos Equipales - Cantina', categoria: 'CANTINA' },
                        'LOS FAMOSOS EQUIPALES': { nombre: 'Los Famosos Equipales Cantina', categoria: 'CANTINA' },
                        'MARIACHI México en la Piel': { nombre: 'MARIACHI México en la Piel', categoria: 'MARIACHI / EVENTS' },
                        'MARIACHI MÉXICO EN LA PIEL': { nombre: 'MARIACHI México en la Piel', categoria: 'MARIACHI / EVENTS' },
                        'ACADEMIA Nuevo Jalisco': { nombre: 'Nuevo Jalisco Academy', categoria: 'ACADEMY' },
                        'ACADEMIA NUEVO JALISCO': { nombre: 'Nuevo Jalisco Academy', categoria: 'ACADEMY' },
                        'MIMOSA Artículos Promocionales': { nombre: 'MIMOSA Promotional Items', categoria: 'PROMOTIONAL' },
                        'MIMOSA PROMOCIONALES': { nombre: 'MIMOSA Promotional Items', categoria: 'PROMOTIONAL' },
                        'TAKASAMI Clothing': { nombre: 'TAKASAMI Clothing', categoria: 'FASHION' },
                        'TAKASAMI': { nombre: 'TAKASAMI', categoria: 'FASHION' }
                    }
                }
            };

            function applyLanguage(lang) {
                var t = T[lang];
                if (!t) return;
                var searchInput = document.getElementById('searchInput');
                if (searchInput) searchInput.placeholder = t.searchPlaceholder;
                var searchBtn = document.getElementById('searchBtn');
                if (searchBtn) searchBtn.title = t.searchTitle;
                var zoomIn = document.getElementById('zoomIn');
                if (zoomIn) zoomIn.title = t.zoomIn;
                var zoomOut = document.getElementById('zoomOut');
                if (zoomOut) zoomOut.title = t.zoomOut;
                var btnMapType = document.getElementById('btnMapType');
                if (btnMapType) btnMapType.title = t.mapType;
                var btnLayers = document.getElementById('btnLayers');
                if (btnLayers) btnLayers.title = t.layers;
                var btnStreetView = document.getElementById('btnStreetView');
                if (btnStreetView) btnStreetView.title = t.streetView;
                var btnGeolocation = document.getElementById('btnGeolocation');
                if (btnGeolocation) btnGeolocation.title = t.myLocation;
                document.querySelectorAll('.js-btn-translate').forEach(function(btn) { btn.title = t.translateBtn; });
                document.querySelectorAll('.js-btn-translate-text').forEach(function(span) { span.textContent = t.translateBtnLabel; });
                var legendHeader = document.getElementById('legendHeader');
                if (legendHeader) legendHeader.textContent = t.legend;
                var legendHistoric = document.getElementById('legendHistoric');
                if (legendHistoric) legendHistoric.textContent = t.legendHistoric;
                var legendBusiness = document.getElementById('legendBusiness');
                if (legendBusiness) legendBusiness.textContent = t.legendBusiness;
                var legendLocation = document.getElementById('legendLocation');
                if (legendLocation) legendLocation.textContent = t.legendLocation;
            }

            window.currentLang = currentLang;
            window.T = T;
            function initTranslate() {
                document.querySelectorAll('.js-btn-translate').forEach(function(btn) {
                    btn.addEventListener('click', function() {
                        currentLang = currentLang === 'es' ? 'en' : 'es';
                        window.currentLang = currentLang;
                        applyLanguage(currentLang);
                        if (typeof window.onMapLanguageChange === 'function') window.onMapLanguageChange(currentLang);
                    });
                });
                applyLanguage('es');
            }
            function initSidebarMobile() {
                var sidebar = document.getElementById('sidebarPuntos');
                var overlay = document.getElementById('sidebarOverlay');
                var btnOpen = document.getElementById('sidebarBtnOpen');
                var btnClose = document.getElementById('sidebarBtnClose');
                if (!sidebar || !overlay || !btnOpen || !btnClose) return;
                function openSidebar() {
                    sidebar.classList.add('open');
                    overlay.classList.add('active');
                    overlay.setAttribute('aria-hidden', 'false');
                }
                function closeSidebar() {
                    sidebar.classList.remove('open');
                    overlay.classList.remove('active');
                    overlay.setAttribute('aria-hidden', 'true');
                }
                function closeOverlay() {
                    closeSidebar();
                }
                btnOpen.addEventListener('click', openSidebar);
                btnClose.addEventListener('click', closeSidebar);
                overlay.addEventListener('click', closeOverlay);
                window.closeSidebarPuntos = closeSidebar;
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    initTranslate();
                    initSidebarMobile();
                });
            } else {
                initTranslate();
                initSidebarMobile();
            }
        })();
    </script>

    <div id="map"></div>
    
    <!-- Logo del mapa -->
    <div class="map-logo" id="mapLogo">
        <img src="assets/logo.png" alt="Guadalajara Ciudad de las Rosas">
    </div>
    
    <!-- Título del mapa (oculto, se usa el logo) -->
    <div class="map-title">
        <span>Guadalajara - Ciudad de las Rosas</span>
    </div>

    <!-- Barra de búsqueda -->
    <div class="search-container">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Buscar lugares...">
            <button id="searchBtn" title="Buscar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="currentColor"/>
                </svg>
            </button>
        </div>
        <div class="search-results" id="searchResults"></div>
    </div>

    <!-- Indicador de Norte -->
    <div class="north-indicator" title="Norte">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L8 12h3v8h2v-8h3L12 2z" fill="#C41E3A"/>
            <path d="M12 2L8 12h3" fill="#8B1538"/>
            <text x="12" y="23" text-anchor="middle" font-size="6" font-weight="bold" fill="#333">N</text>
        </svg>
    </div>

    <!-- Panel de controles lateral derecho -->
    <div class="controls-panel">
        <!-- Grupo de zoom -->
        <div class="zoom-group">
            <button class="control-btn" id="zoomIn" title="Acercar">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            </button>
            <button class="control-btn" id="zoomOut" title="Alejar">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 13H5v-2h14v2z"/></svg>
            </button>
        </div>

        <!-- Tipo de mapa -->
        <button id="btnMapType" class="control-btn" title="Tipo de mapa">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"/></svg>
        </button>

        <!-- Capas -->
        <button id="btnLayers" class="control-btn" title="Capas del mapa">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        </button>

        <!-- Street View -->
        <button id="btnStreetView" class="control-btn" title="Street View">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.56 14.33c-.34.27-.56.7-.56 1.17V21h7c1.1 0 2-.9 2-2v-5.98c-.94-.33-1.95-.52-3-.52-2.03 0-3.93.7-5.44 1.83z"/><circle cx="18" cy="6" r="5"/><path d="M11.5 6c0-1.08.27-2.1.74-3H5c-1.1 0-2 .9-2 2v14c0 .55.23 1.05.59 1.41l9.82-9.82C12.23 9.42 11.5 7.8 11.5 6z"/></svg>
        </button>

        <!-- Geolocalización -->
        <button id="btnGeolocation" class="control-btn" title="Mi ubicación">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
        </button>

        <!-- Traducir idioma (debajo de los demás controles) -->
        <button id="btnTranslate" class="control-btn control-btn-translate js-btn-translate" title="Traducir al inglés">
            <span id="btnTranslateText" class="js-btn-translate-text">English</span>
        </button>
    </div>

    <!-- Menús desplegables -->
    <div id="layersMenu" class="layers-menu">
        <div class="layers-menu-header">Capas del mapa</div>
        <div class="layers-menu-item" data-layer="traffic">
            <div class="layers-menu-item-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 10h-3V8.86c1.72-.45 3-2 3-3.86h-3V4c0-.55-.45-1-1-1H8c-.55 0-1 .45-1 1v1H4c0 1.86 1.28 3.41 3 3.86V10H4c0 1.86 1.28 3.41 3 3.86V15H4v2h3v1.14c1.72.45 3 2 3 3.86h3V22c0 .55.45 1 1 1h8c.55 0 1-.45 1-1v-1h3c0-1.86-1.28-3.41-3-3.86V15h3v-2h-3v-1.14c-1.72-.45-3-2-3-3.86zm-8 9c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="#666"/>
                    <path d="M12 15c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z" fill="#666"/>
                </svg>
            </div>
            <div class="layers-menu-item-label">Tráfico</div>
            <svg class="layers-menu-item-check" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
            </svg>
        </div>
        <div class="layers-menu-item" data-layer="transit">
            <div class="layers-menu-item-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 16c0 .88.39 1.67 1 2.22V20a1 1 0 001 1h1a1 1 0 001-1v-1h8v1a1 1 0 001 1h1a1 1 0 001-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4s-8 .5-8 4v10zm3.5 1c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm9 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm1.5-6H6V6h12v5z" fill="#666"/>
                </svg>
            </div>
            <div class="layers-menu-item-label">Transporte público</div>
            <svg class="layers-menu-item-check" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
            </svg>
        </div>
    </div>
    <div id="mapTypeMenu" class="map-type-menu">
        <div class="map-type-menu-header">Tipo de mapa</div>
        <div class="map-type-menu-item" data-map-type="roadmap">
            <div class="map-type-menu-item-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                </svg>
            </div>
            <div class="map-type-menu-item-label">Estándar</div>
            <svg class="map-type-menu-item-check" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
            </svg>
        </div>
        <div class="map-type-menu-item" data-map-type="satellite">
            <div class="map-type-menu-item-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 19V5h14v14H5z" fill="#666"/>
                    <path d="M7 7h10v10H7z" fill="#666"/>
                </svg>
            </div>
            <div class="map-type-menu-item-label">Satélite</div>
            <svg class="map-type-menu-item-check" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
            </svg>
        </div>
        <div class="map-type-menu-item" data-map-type="terrain">
            <div class="map-type-menu-item-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z" fill="#666"/>
                </svg>
            </div>
            <div class="map-type-menu-item-label">Relieve</div>
            <svg class="map-type-menu-item-check" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
            </svg>
        </div>
    </div>
    <div id="geolocationMessage" class="geolocation-message"></div>

    <!-- Panel de rutas -->
    <div id="routePanel" class="route-panel">
        <div class="route-panel-header">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M21.71 11.29l-9-9a.996.996 0 00-1.41 0l-9 9a.996.996 0 000 1.41l9 9c.39.39 1.02.39 1.41 0l9-9a.996.996 0 000-1.41zM14 14.5V12h-4v3H8v-4c0-.55.45-1 1-1h5V7.5l3.5 3.5-3.5 3.5z"/>
            </svg>
            <div class="route-panel-header-info">
                <div class="route-panel-title" id="routeDestinationName">Destino</div>
                <div class="route-panel-subtitle">Calculando ruta...</div>
            </div>
            <button class="route-panel-close" id="routePanelClose" title="Cerrar">
                <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
        </div>

        <div id="routeContent">
            <!-- Loading state -->
            <div class="route-loading" id="routeLoading">
                <div class="route-loading-spinner"></div>
                <div class="route-loading-text">Calculando la mejor ruta...</div>
            </div>
        </div>

        <!-- Contenido de la ruta (se llena dinámicamente) -->
        <div id="routeDetails" style="display: none;">
            <div class="route-summary">
                <div class="route-stat">
                    <div class="route-stat-value" id="routeDistance">--</div>
                    <div class="route-stat-label">Distancia</div>
                </div>
                <div class="route-stat">
                    <div class="route-stat-value" id="routeDuration">--</div>
                    <div class="route-stat-label">Tiempo</div>
                </div>
            </div>

            <!-- Botón expandir/colapsar para móvil -->
            <button class="route-expand-btn" id="routeExpandBtn">
                <span id="routeExpandText">Ver indicaciones</span>
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                </svg>
            </button>

            <div class="route-modes">
                <button class="route-mode-btn active" data-mode="DRIVING" title="En auto">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                    </svg>
                    <span>Auto</span>
                </button>
                <button class="route-mode-btn" data-mode="WALKING" title="Caminando">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7"/>
                    </svg>
                    <span>A pie</span>
                </button>
                <button class="route-mode-btn" data-mode="TRANSIT" title="Transporte público">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4 16c0 .88.39 1.67 1 2.22V20c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h8v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4s-8 .5-8 4v10zm3.5 1c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm9 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm1.5-6H6V6h12v5z"/>
                    </svg>
                    <span>Bus</span>
                </button>
                <button class="route-mode-btn" data-mode="BICYCLING" title="En bicicleta">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM5 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5zm5.8-10l2.4-2.4.8.8c1.3 1.3 3 2.1 5.1 2.1V9c-1.5 0-2.7-.6-3.6-1.5l-1.9-1.9c-.5-.4-1-.6-1.6-.6s-1.1.2-1.4.6L7.8 8.4c-.4.4-.6.9-.6 1.4 0 .6.2 1.1.6 1.4L11 14v5h2v-6.2l-2.2-2.3zM19 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z"/>
                    </svg>
                    <span>Bici</span>
                </button>
            </div>

            <div class="route-steps" id="routeSteps">
                <!-- Los pasos se llenan dinámicamente -->
            </div>
        </div>

        <!-- Error state -->
        <div id="routeError" style="display: none;">
            <div class="route-error">
                <svg class="route-error-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
                <div class="route-error-message" id="routeErrorMessage">No se pudo calcular la ruta</div>
                <button class="route-error-btn" id="routeRetryBtn">Intentar de nuevo</button>
            </div>
        </div>
    </div>

    <!-- Modal de Street View -->
    <div id="streetviewModal" class="streetview-modal">
        <div class="streetview-modal-content">
            <div class="streetview-modal-header">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12.56 14.33c-.34.27-.56.7-.56 1.17V21h7c1.1 0 2-.9 2-2v-5.98c-.94-.33-1.95-.52-3-.52-2.03 0-3.93.7-5.44 1.83z"/>
                    <circle cx="18" cy="6" r="5"/>
                    <path d="M11.5 6c0-1.08.27-2.1.74-3H5c-1.1 0-2 .9-2 2v14c0 .55.23 1.05.59 1.41l9.82-9.82C12.23 9.42 11.5 7.8 11.5 6z"/>
                </svg>
                <div class="streetview-modal-header-info">
                    <div class="streetview-modal-title" id="streetviewModalTitle">Street View</div>
                    <div class="streetview-modal-subtitle">Explora la ubicación en 360°</div>
                </div>
                <button class="streetview-modal-close" id="streetviewModalClose" title="Cerrar">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="streetview-modal-body" id="streetviewModalBody">
                <!-- El iframe de Street View se inserta aquí -->
            </div>
            <div class="streetview-modal-footer">
                <span class="streetview-tip">💡 Arrastra para moverte, usa el scroll para zoom</span>
            </div>
        </div>
    </div>

    <div id="geolocationInstructions" class="geolocation-instructions">
        <button class="close-btn" onclick="document.getElementById('geolocationInstructions').style.display='none'">×</button>
        <h4>📍 Para ubicación exacta</h4>
        <ol>
            <li>Haz clic en el ícono de <strong>candado</strong> o <strong>información</strong> junto a la URL</li>
            <li>Busca <strong>"Ubicación"</strong> o <strong>"Location"</strong></li>
            <li>Cambia de <strong>"Bloquear"</strong> a <strong>"Permitir"</strong></li>
            <li>Recarga la página o haz clic en el botón de ubicación</li>
        </ol>
        <p style="margin-top: 10px; font-size: 11px; color: #666;">
            <strong>Nota:</strong> Sin permisos solo se muestra ubicación aproximada por IP (precisión ~2km)
        </p>
    </div>

    <script>
        // Si el mapa no carga en 12s (ej. API key con restricción de referrer en producción), mostrar ayuda
        window._mapLoaded = false;
        window._mapLoadTimeout = setTimeout(function() {
            if (!window._mapLoaded) {
                var el = document.getElementById('map');
                if (el && !el.querySelector('.map-error-msg')) {
                    el.innerHTML = '<div class="map-error-msg" style="padding:28px 24px;text-align:center;font-family:Segoe UI,sans-serif;color:#5d4037;max-width:420px;margin:60px auto 0;background:#fdf5f9;border-radius:12px;border:2px solid #f79ed6;box-shadow:0 4px 12px rgba(0,0,0,0.08);"><strong style="font-size:16px;">No se pudo cargar el mapa</strong><p style="margin:14px 0;font-size:14px;line-height:1.5;">En producción (GitHub Pages) suele deberse a la <strong>restricción de la API key</strong>.</p><p style="margin:10px 0;font-size:13px;">En <a href="https://console.cloud.google.com/google/maps-apis/credentials" target="_blank" rel="noopener">Google Cloud Console</a> → tu API key → Restricciones de aplicación → Referidores HTTP, agrega:</p><code style="background:#fff;padding:8px 12px;display:block;margin:12px 0;word-break:break-all;font-size:12px;border-radius:6px;">https://roberto-rgb-code.github.io/*</code><p style="margin:12px 0 0;font-size:12px;color:#888;">Guarda los cambios y recarga esta página.</p></div>';
                }
                if (typeof window.fillSidebarListFromLugares === 'function') window.fillSidebarListFromLugares();
            }
        }, 12000);

        // Coordenadas de los lugares
        const lugares = {
            historicos: [
                {
                    nombre: "Catedral de Guadalajara",
                    lat: 20.67672,
                    lng: -103.34764,
                    categoria: "EDIFICIO HISTÓRICO",
                    descripcion: "Oficialmente Catedral Basílica de la Asunción de María Santísima, es la sede de la arquidiócesis de Guadalajara y uno de los principales templos de la Iglesia católica en México. Entre las criptas, debajo de lo que fue la capilla real, se encuentra la de los arzobispos de Guadalajara que datan del siglo XVI. Destacan los dedicados a La Virgen de las Rosas, Santiago el Mayor (patrono de la Nueva España), La Virgen de Guadalupe, Nuestra Señora de Zapopan entre otros.",
                    direccion: "Av. Fray Antonio Alcalde, Zona Centro, Guadalajara, Jal.",
                    imagen: "assets/catedral-removebg-preview.png"
                },
                {
                    nombre: "Palacio de Gobierno",
                    lat: 20.6764,
                    lng: -103.3479,
                    categoria: "EDIFICIO HISTÓRICO",
                    descripcion: "Construcción original en 1650, destruido por un terremoto y reconstruido. Sede del Palacio de la Real Audiencia. Alberga murales de José Clemente Orozco.",
                    direccion: "Av. Corona, Zona Centro, Guadalajara, Jal."
                },
                {
                    nombre: "Rotonda de los Jaliscienses Ilustres",
                    lat: 20.67777,
                    lng: -103.34701,
                    categoria: "EDIFICIO HISTÓRICO",
                    descripcion: "Rinde homenaje a los jaliscienses que han trascendido a través de la historia. El monumento construido en 1952, por el arquitecto Vicente Mendiola, bajo iniciativa del entonces gobernador José de Jesús González Gallo, consta de diecisiete columnas estriadas sin base ni capitel y que sostienen un anillo de cantera que tiene grabado en uno de sus lados la leyenda \"Jalisco a sus hijos esclarecidos\"; en el centro del monumento existe un pebetero, además de 98 nichos para albergar los cuerpos de los hombres y mujeres más ilustres nacidos en Jalisco.",
                    direccion: "Av. Fray Antonio Alcalde, Zona Centro, Guadalajara, Jal.",
                    imagen: "assets/rotonda-removebg-preview.png"
                },
                {
                    nombre: "Teatro Degollado",
                    lat: 20.6769,
                    lng: -103.3467,
                    categoria: "EDIFICIO HISTÓRICO",
                    descripcion: "Inaugurado en 1866, arquitectura neoclásica. Sede de la Orquesta Filarmónica de Jalisco y de festivales; capacidad 1027 butacas.",
                    direccion: "Plaza de la Liberación, Zona Centro, Guadalajara, Jal."
                },
                {
                    nombre: "Museo Regional",
                    lat: 20.6772,
                    lng: -103.3488,
                    categoria: "EDIFICIO HISTÓRICO",
                    descripcion: "De cuartel militar (1810) a biblioteca pública (1857); desde 1976 Museo Regional de Guadalajara.",
                    direccion: "Calle Liceo 60, Zona Centro, Guadalajara, Jal."
                },
                {
                    nombre: "Museo Cabañas",
                    lat: 20.6764,
                    lng: -103.3382,
                    categoria: "EDIFICIO HISTÓRICO",
                    descripcion: "Patrimonio de la Humanidad (UNESCO). Diseño del arquitecto Manuel Tolsá; murales de José Clemente Orozco. Originalmente hospicio fundado por el obispo Juan Cruz Ruiz de Cabañas.",
                    direccion: "Cabañas 8, Zona Centro, Guadalajara, Jal."
                },
                {
                    nombre: "Mercado de San Juan de Dios",
                    lat: 20.675562,
                    lng: -103.33986,
                    categoria: "EDIFICIO HISTÓRICO",
                    descripcion: "Es el mercado techado más grande de América Latina. Obra del arquitecto Alejandro Zohn, se inauguró el 30 de diciembre de 1958. Se encuentra ubicado en lo que una vez fue la orilla oriental del río San Juan de Dios, cercano a la capital de la entonces Nueva Galicia.",
                    direccion: "Calle Javier Mina, Zona Centro, Guadalajara, Jal.",
                    imagen: "assets/mercadosanjuandedios-removebg-preview.png"
                },
                {
                    nombre: "Glorieta de la Minerva",
                    lat: 20.6700,
                    lng: -103.3800,
                    categoria: "MONUMENTO",
                    descripcion: "Monumento icónico inaugurado en 1956, obra del escultor Joaquín Arias. Representa a la diosa romana Minerva; fuente circular con inscripciones.",
                    direccion: "Av. López Mateos y Av. Vallarta, Guadalajara, Jal."
                },
                {
                    nombre: "Los Arcos de Guadalajara",
                    lat: 20.6740,
                    lng: -103.3645,
                    categoria: "MONUMENTO",
                    descripcion: "Ubicados en Av. Vallarta; construidos entre 1939 y 1942 por Aurelio Aceves para conmemorar el 400 aniversario de la ciudad.",
                    direccion: "Av. Vallarta, Col. Americana, Guadalajara, Jal."
                }
            ],
            empresas: [
                {
                    nombre: "RESTAURANT Casa Dolores",
                    lat: 20.67750,
                    lng: -103.34650,
                    categoria: "COMIDA MEXICANA",
                    descripcion: "Inspirada en el aroma de la historia de México. Restaurante que elogia lo mejor de México, trasformando sus tradicionales sabores, texturas y aromas en los más exquisitos platillos de cocina mexicana, resultado de una cuidadosa selección de ingredientes, teniendo muy presente nuestro legado que implica ser orgullosamente mexicanos.",
                    direccion: "Paseo Alcalde 22, Col. Centro. Guadalajara, Jal.",
                    horario: "Lunes – Domingo: 8:00 am – 10:00 pm",
                    telefono: "+52 33 1001 8581",
                    web: "opentable.com.mx",
                    instagram: "@casadoloresgdl",
                    galeria: [
                        "assets/galeria-casa-dolores/1.jpg",
                        "assets/galeria-casa-dolores/2.png",
                        "assets/galeria-casa-dolores/3.png",
                        "assets/galeria-casa-dolores/4.png",
                        "assets/galeria-casa-dolores/5.png",
                        "assets/galeria-casa-dolores/6.png",
                        "assets/galeria-casa-dolores/7.png",
                        "assets/galeria-casa-dolores/8.png"
                    ]
                },
                {
                    nombre: "Ex Convento de Santa Teresa",
                    lat: 20.67800,
                    lng: -103.34800,
                    categoria: "SALÓN DE EVENTOS",
                    descripcion: "Donde cada rincón, es un bello espacio histórico que hará resaltar tu evento. Recinto con 400 años de historia que forma parte de la riqueza arquitectónica de la ciudad, para hacer de tu evento la vivencia más memorable y exclusiva. Fundado en el siglo XVII, por la orden de las carmelitas descalzas como el primer claustro en Guadalajara.",
                    direccion: "Donato Guerra 25, Zona Centro 44100 Guadalajara, Jal.",
                    telefono: "+52 33 1989 0373",
                    web: "exconvento.com.mx",
                    facebook: "facebook.com/ExconventoST",
                    instagram: "@exconventost",
                    galeria: [
                        "assets/galeria-ex-convento/1.png",
                        "assets/galeria-ex-convento/2.png",
                        "assets/galeria-ex-convento/3.png",
                        "assets/galeria-ex-convento/4.png",
                        "assets/galeria-ex-convento/5.png",
                        "assets/galeria-ex-convento/6.png",
                        "assets/galeria-ex-convento/7.png",
                        "assets/galeria-ex-convento/8.png",
                        "assets/galeria-ex-convento/9.jpg"
                    ]
                },
                {
                    nombre: "CASA ANGUIANO Artículos Religiosos",
                    lat: 20.67720,
                    lng: -103.34780,
                    categoria: "ARTÍCULOS RELIGIOSOS",
                    descripcion: "Casa fundada en 1942. Líderes en la comercialización de Artículos Religiosos en la República Mexicana. Contamos con un punto de venta al público en el centro de la bella ciudad de Guadalajara, a unas cuantas calles de Catedral, además de un taller donde fabricamos diferentes artículos y realizamos restauraciones de imágenes y metales sagrados.",
                    direccion: "Av. Alcalde 113, Paseo Alcalde.",
                    horario: "Lunes – Domingo: 8:00 am – 10:00 pm",
                    telefono: "+52 333 614 6880",
                    whatsapp: "+52 331 061 6961",
                    web: "casaanguiano.com",
                    galeria: [
                        "assets/galeria-casa-anguiano/1.png",
                        "assets/galeria-casa-anguiano/2.png",
                        "assets/galeria-casa-anguiano/3.png",
                        "assets/galeria-casa-anguiano/4.png",
                        "assets/galeria-casa-anguiano/5.png",
                        "assets/galeria-casa-anguiano/6.png",
                        "assets/galeria-casa-anguiano/7.png"
                    ]
                },
                {
                    nombre: "BIRRIERIA El Pilón de los Arrieros",
                    lat: 20.67600,
                    lng: -103.34550,
                    categoria: "GASTRONOMÍA ARTESANAL",
                    descripcion: "Con más de 40 años de tradición. Lupita Figueroa es la dueña de todas las recetas, donde se sirven excelentes platillos, teniendo como especialidad la birria de chivo, además de la barbacoa de borrego, exquisitos chamorros adobados y la cochinita pibil complementan sus deliciosos platillos. Ven y disfruta de un festín de sabores mexicanos. Por sus mesas han pasado artistas, cantantes, actores, personajes de la radio y la televisión nacionales y extranjeros.",
                    direccion: "Calle Galeana 388, Plaza de las 9 esquinas, Centro Histórico. Guadalajara, Jal.",
                    horario: "Lunes – Domingo: 9:00 am – 9:00 pm",
                    telefono: "+52 33 3613 2799",
                    instagram: "@elpilondelosarrieros",
                    web: "elpilondelosarrieros.com",
                    galeria: [
                        "assets/galeria-pilon-arrieros/1.png",
                        "assets/galeria-pilon-arrieros/2.png",
                        "assets/galeria-pilon-arrieros/3.png",
                        "assets/galeria-pilon-arrieros/4.png",
                        "assets/galeria-pilon-arrieros/5.png",
                        "assets/galeria-pilon-arrieros/6.png",
                        "assets/galeria-pilon-arrieros/7.png"
                    ]
                },
                {
                    nombre: "GUARDIÁN CAFÉ-GALERÍA",
                    lat: 20.6797854,
                    lng: -103.3477979,
                    categoria: "ECLÉCTICA GALERÍA Y GALERÍA DE ARTE",
                    descripcion: "Ven, relájate y déjate llevar por la belleza que nos rodea. Sumérgete en un mundo de creatividad mientras disfrutas de una taza de café recién hecho. El espacio combina el aroma del café con la inspiración visual de obras de artistas locales y emergentes. Ofrecemos una variedad de opciones deliciosas, desde espressos intensos, café turco espumoso hasta lattes suaves, pasando por tisanas, tés aromáticos y chocolate caliente.",
                    direccion: "Av. Alcalde 207, Col. Centro",
                    horario: "Lunes a Domingo de 8:30 a 20:30 hrs.",
                    email: "guardiancafegdl@gmail.com",
                    facebook: "Guardian Café",
                    instagram: "@guardiancafegdl",
                    galeria: ["assets/fotos-anunciantes/guardian/Captura de Pantalla 2026-02-03 a la(s) 20.21.11.png", "assets/fotos-anunciantes/guardian/Captura de Pantalla 2026-02-03 a la(s) 20.21.23.png", "assets/fotos-anunciantes/guardian/Captura de Pantalla 2026-02-03 a la(s) 20.21.31.png", "assets/fotos-anunciantes/guardian/Captura de Pantalla 2026-02-03 a la(s) 20.21.40.png", "assets/fotos-anunciantes/guardian/Captura de Pantalla 2026-02-03 a la(s) 20.23.46.png"]
                },
                {
                    nombre: "TORTAS AHOGADAS Las Famosas",
                    lat: 20.6772053,
                    lng: -103.3435073,
                    categoria: "GASTRONOMÍA",
                    direccion: "Paseo Degollado 128, Col. Centro, Guadalajara, Jal.",
                    galeria: ["assets/fotos-anunciantes/tortas/Captura de Pantalla 2026-02-03 a la(s) 20.59.47.png", "assets/fotos-anunciantes/tortas/Captura de Pantalla 2026-02-03 a la(s) 21.00.26.png", "assets/fotos-anunciantes/tortas/Captura de Pantalla 2026-02-03 a la(s) 21.01.28.png", "assets/fotos-anunciantes/tortas/Captura de Pantalla 2026-02-03 a la(s) 21.03.20.png"]
                },
                {
                    nombre: "HOTEL Aló",
                    lat: 20.6772869,
                    lng: -103.3421337,
                    categoria: "EN EL CORAZÓN DEL CENTRO HISTÓRICO DE GUADALAJARA",
                    descripcion: "Espacios diseñados para tu comodidad. Aló Degollado Hotel combina historia y modernidad en pleno centro de Guadalajara. Situado en un andador lleno de historia, te ofrecemos una experiencia única cerca de los principales atractivos de la ciudad. Elige entre nuestras habitaciones sencillas o dobles y disfruta de una estancia inigualable.",
                    direccion: "Paseo Degollado 54, Zona Centro, Guadalajara, Jal.",
                    telefono: "+52 33 3054 7224",
                    facebook: "AlóHotelDegollado",
                    instagram: "alohoteld",
                    web: "alohotel.mx",
                    galeria: ["assets/fotos-anunciantes/hotel-alo/Captura de Pantalla 2026-02-03 a la(s) 21.05.13.png", "assets/fotos-anunciantes/hotel-alo/Captura de Pantalla 2026-02-03 a la(s) 21.05.29.png", "assets/fotos-anunciantes/hotel-alo/Captura de Pantalla 2026-02-03 a la(s) 21.05.48.png", "assets/fotos-anunciantes/hotel-alo/Captura de Pantalla 2026-02-03 a la(s) 21.06.04.png", "assets/fotos-anunciantes/hotel-alo/Captura de Pantalla 2026-02-03 a la(s) 21.06.19.png", "assets/fotos-anunciantes/hotel-alo/Captura de Pantalla 2026-02-03 a la(s) 21.07.18.png"]
                },
                {
                    nombre: "HOTEL Olá",
                    lat: 20.6728966,
                    lng: -103.3689122,
                    categoria: "EN EL CORAZÓN DEL CENTRO HISTÓRICO DE GUADALAJARA",
                    descripcion: "Espacios diseñados para tu comodidad. Descubre, experimenta y siente la Colonia Americana de Guadalajara, desde nuestro hotel en Av. Chapultepec. Según la revista Time Out, esta colonia cuenta con belleza que la posiciona entre las mejores del mundo. Sus habitaciones tienen una decoración moderna y son muy cómodas.",
                    direccion: "Av. Chapultepec Norte 20A, Ladrón de Guevara – Americana, 44600 Guadalajara, Jal.",
                    telefono: "+52 33 4347 3751",
                    facebook: "OLÁ Hotel",
                    instagram: "olahotelc",
                    web: "olahotel.mx",
                    galeria: ["assets/fotos-anunciantes/hotel-ola/Captura de Pantalla 2026-02-03 a la(s) 21.08.51.png"]
                },
                {
                    nombre: "RESTAURANT Los Paceños",
                    lat: 20.6767769,
                    lng: -103.3433889,
                    categoria: "TACOS DE CAMARÓN Y PESCADO",
                    descripcion: "En el meritito centro de Guadalajara. Un restaurante para todos. Aquí el sabor no tiene límites: platillos, mariscos, opciones para todos los paladares y un ambiente que se vive. Buena música, juegos y momentos que se convierten en recuerdos. Ven con amigos, en pareja o en familia… aquí todos caben.",
                    direccion: "Morelos 126, Centro Histórico de Guadalajara, Jal.",
                    horario: "Miércoles a lunes de 11:00 am a 6:30 pm. Para llevar: 11:00 am a 5:30 pm. Cerrado los martes.",
                    telefono: "+52 33 3955 3932",
                    email: "pacenostacos@gmail.com",
                    facebook: "Los Paceños",
                    instagram: "lospacenos.gdl",
                    galeria: ["assets/fotos-anunciantes/pacenos/Captura de Pantalla 2026-02-03 a la(s) 20.46.26.png", "assets/fotos-anunciantes/pacenos/Captura de Pantalla 2026-02-03 a la(s) 20.46.53.png", "assets/fotos-anunciantes/pacenos/Captura de Pantalla 2026-02-03 a la(s) 20.47.04.png", "assets/fotos-anunciantes/pacenos/Captura de Pantalla 2026-02-03 a la(s) 20.47.24.png", "assets/fotos-anunciantes/pacenos/Captura de Pantalla 2026-02-03 a la(s) 20.47.59.png", "assets/fotos-anunciantes/pacenos/Captura de Pantalla 2026-02-03 a la(s) 20.49.17.png"]
                },
                {
                    nombre: "TARASKA Helados y Paletas",
                    lat: 20.6765762,
                    lng: -103.3428047,
                    categoria: "PALETAS Y AGUAS FRESCAS DE FRUTA 100% NATURAL",
                    descripcion: "Michoacana por tradición. Encuentra los mejores helados, paletas y aguas frescas de fruta 100% natural y disfrútalas en familia. 100% mexicanas y 100% deliciosas!! Porque el verdadero lujo es consentirte con tus helados favoritos. En Taraska siempre hay un sabor dulce esperando para compartirlo.",
                    direccion: "Morelos 99, Centro Histórico de Guadalajara, Jal.",
                    horario: "Lunes a Domingo de 9:00 am a 9:00 pm",
                    telefono: "+52 33 3345 0021",
                    facebook: "Taraska Helados",
                    instagram: "taraska_helados",
                    galeria: ["assets/fotos-anunciantes/taraskas/Captura de Pantalla 2026-02-03 a la(s) 20.55.08.png", "assets/fotos-anunciantes/taraskas/Captura de Pantalla 2026-02-03 a la(s) 20.55.33.png", "assets/fotos-anunciantes/taraskas/Captura de Pantalla 2026-02-03 a la(s) 20.55.45.png", "assets/fotos-anunciantes/taraskas/Captura de Pantalla 2026-02-03 a la(s) 20.55.57.png", "assets/fotos-anunciantes/taraskas/Captura de Pantalla 2026-02-03 a la(s) 20.56.14.png", "assets/fotos-anunciantes/taraskas/Captura de Pantalla 2026-02-03 a la(s) 20.56.24.png", "assets/fotos-anunciantes/taraskas/Captura de Pantalla 2026-02-03 a la(s) 20.56.37.png"]
                },
                {
                    nombre: "TARASKA Helados y Paletas",
                    lat: 20.674271,
                    lng: -103.3465643,
                    categoria: "PALETAS Y AGUAS FRESCAS DE FRUTA 100% NATURAL",
                    descripcion: "Michoacana por tradición. Encuentra los mejores helados, paletas y aguas frescas de fruta 100% natural y disfrútalas en familia. 100% mexicanas y 100% deliciosas!! Porque el verdadero lujo es consentirte con tus helados favoritos. En Taraska siempre hay un sabor dulce esperando para compartirlo.",
                    direccion: "Ramón Corona 156, Zona Centro Guadalajara, Jal.",
                    horario: "Lunes a Domingo de 9:00 am a 9:00 pm",
                    telefono: "+52 33 3345 0021",
                    facebook: "Taraska Helados",
                    instagram: "taraska_helados",
                    galeria: ["assets/Anuncios/TARASKAS - Las mejores AGUAS FRESCAS (2)_page-0001.jpg"]
                },
                {
                    nombre: "EX-CONVENTO DE SANTA TERESA",
                    lat: 20.6759382,
                    lng: -103.3504487,
                    categoria: "SALÓN DE EVENTOS",
                    descripcion: "Donde cada rincón, es un bello espacio histórico que hará resaltar tu evento. Recinto con 400 años de historia que forma parte de la riqueza arquitectónica de la ciudad, para hacer de tu evento la vivencia más memorable y exclusiva. Fundado en el siglo XVII, por la orden de las carmelitas descalzas como el primer claustro en Guadalajara.",
                    direccion: "Donato Guerra 25, Zona Centro 44100 Guadalajara, Jal.",
                    telefono: "+52 33 1989 0373",
                    web: "exconvento.com.mx",
                    facebook: "facebook.com/ExconventoST",
                    instagram: "@exconventost",
                    galeria: ["assets/galeria-ex-convento/1.png", "assets/galeria-ex-convento/2.png", "assets/galeria-ex-convento/3.png"]
                },
                {
                    nombre: "HOTEL ONE Guadalajara Centro",
                    lat: 20.6760064,
                    lng: -103.3478317,
                    categoria: "IDEAL PARA VIAJES DE NEGOCIOS O DE PLACER",
                    descripcion: "Ubicación excelente. Ubicado en el centro histórico de la ciudad, a 2 minutos a pie de la Catedral de Guadalajara y del Museo Regional de Guadalajara. Ofrece habitaciones con aire acondicionado, WiFi gratuito y desayuno gratuito. Cada habitación moderna y luminosa le proporcionará un escritorio y un televisor con canales por cable.",
                    direccion: "Av. 16 de Septiembre No. 16, Centro Histórico, Guadalajara, Jal.",
                    telefono: "+52 55 2317 3736",
                    web: "onehoteles.com",
                    galeria: ["assets/Anuncios/Hotel ONE.jpg"]
                },
                {
                    nombre: "RAGAZZA Fashion",
                    lat: 20.6753489,
                    lng: -103.345839,
                    categoria: "DISEÑO Y VENTA DE VESTIDOS PARA XV AÑOS",
                    descripcion: "Enamórate de la magia de un AUTÉNTICO RAGAZZA. Cada vestido de XV años Ragazza nace de un proceso artesanal donde la creatividad, la técnica y la precisión se unen para dar vida a algo verdaderamente extraordinario. Detrás de cada diseño hay horas de trabajo minucioso: bordados hechos a mano, cristales aplicados con delicadeza y telas seleccionadas con rigor, para crear siluetas exclusivas que se ajustan a tu esencia.",
                    direccion: "Av. Juárez 210, Colonia Centro Guadalajara, Jal.",
                    telefono: "+52 33 3345 0021",
                    facebook: "Ragazza Fashion",
                    instagram: "ragazzafashion",
                    galeria: ["assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.14.15.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.14.33.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.14.45.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.15.28.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.15.43.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.15.52.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.16.02.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.16.26.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.16.38.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.17.01.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.17.13.png", "assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.17.26.png"]
                },
                {
                    nombre: "RAGAZZA Fashion",
                    lat: 20.67442,
                    lng: -103.3648253,
                    categoria: "DISEÑO Y VENTA DE VESTIDOS PARA XV AÑOS",
                    descripcion: "Enamórate de la magia de un AUTÉNTICO RAGAZZA. Porque cada pieza de tu Auténtico Ragazza expresa quién eres y todo lo que estás por vivir. Auténtico Ragazza no es solo una etiqueta: es el resultado de una visión, de un compromiso con la excelencia y de una historia que honra la tradición de la alta costura mexicana.",
                    direccion: "Av. Vallarta 1291, Col. Americana, Guadalajara, Jal.",
                    telefono: "+52 33 3345 0021",
                    facebook: "Ragazza Fashion",
                    instagram: "ragazzafashion",
                    galeria: ["assets/fotos-anunciantes/ragazza/Captura de Pantalla 2026-02-03 a la(s) 21.16.38.png"]
                },
                {
                    nombre: "RESTAURANT Casa Dolores",
                    lat: 20.676684,
                    lng: -103.3471716,
                    categoria: "COMIDA MEXICANA",
                    descripcion: "Inspirada en el aroma de la historia de México. Restaurante que elogia lo mejor de México, trasformando sus tradicionales sabores, texturas y aromas en los más exquisitos platillos de cocina mexicana.",
                    direccion: "Av. Alcalde 22, Paseo Alcalde.",
                    horario: "Lunes – Domingo: 8:00 am – 10:00 pm",
                    telefono: "+52 33 1001 8581",
                    web: "opentable.com.mx",
                    instagram: "@casadoloresgdl",
                    galeria: ["assets/Anuncios/DOL-9.5x10cm 01.jpg", "assets/galeria-casa-dolores/1.jpg"]
                },
                {
                    nombre: "RESTAURANT Casa Dolores",
                    lat: 20.6691209,
                    lng: -103.3681815,
                    categoria: "COMIDA MEXICANA",
                    descripcion: "Inspirada en el aroma de la historia de México. Restaurante que elogia lo mejor de México, trasformando sus tradicionales sabores, texturas y aromas en los más exquisitos platillos de cocina mexicana.",
                    direccion: "Av. Chapultepec Sur 451, Col. Americana.",
                    telefono: "+52 33 3794 2123",
                    web: "opentable.com.mx",
                    instagram: "@casadoloresgdl",
                    galeria: ["assets/Anuncios/DOL-9.5x10cm 01.jpg", "assets/galeria-casa-dolores/1.jpg"]
                },
                {
                    nombre: "RESTAURANT Alma Jalisco",
                    lat: 20.6775006,
                    lng: -103.3494319,
                    categoria: "ESPACIO CULTURAL Y GASTRONÓMICO",
                    descripcion: "Una carta de amor a Jalisco. Vive la esencia de Jalisco en cada detalle: gastronomía, música y hospitalidad. Alma es tradición que se disfruta con orgullo. En Alma, cada visita es una historia: comida que apapacha, ambiente que inspira y servicio que enamora.",
                    direccion: "Av. Miguel Hidalgo y Costilla 469, 5to. Piso, Zona Centro, Guadalajara, Jal.",
                    telefono: "+52 33 2034 8548",
                    facebook: "Alma Jalisco",
                    instagram: "@almajalisco.mx",
                    web: "almajalisco.mx"
                },
                {
                    nombre: "CONOCE JALISCO Tours",
                    lat: 20.67874,
                    lng: -103.3465796,
                    categoria: "SOMOS LOS REYES DEL TOUR",
                    descripcion: "Paseos a los principales destinos como Tequila, Chapala, Tlaquepaque, Mazamitla. Conoce nuestra oficina y tienda de souvenir y recibe grandes descuentos.",
                    direccion: "Calle Liceo 148, Col. Centro, Guadalajara, Jal.",
                    whatsapp: "+52 33 2782 0155",
                    facebook: "Tours Meralib Travels"
                },
                {
                    nombre: "CASA ANGUIANO Artículos Religiosos",
                    lat: 20.6782519,
                    lng: -103.3477103,
                    categoria: "ARTÍCULOS RELIGIOSOS",
                    descripcion: "Casa fundada en 1942. Líderes en la comercialización de Artículos Religiosos en la República Mexicana. Contamos con un punto de venta al público en el centro de la bella ciudad de Guadalajara, a unas cuantas calles de Catedral, además de un taller donde fabricamos diferentes artículos y realizamos restauraciones de imágenes y metales sagrados.",
                    direccion: "Av. Fray Antonio Alcalde 113, Col. Centro, Guadalajara, Jal.",
                    horario: "Lunes – Domingo: 8:00 am – 10:00 pm",
                    telefono: "+52 333 614 6880",
                    whatsapp: "+52 331 061 6961",
                    web: "casaanguiano.com",
                    galeria: ["assets/Anuncios/Casa Anguiano - Modulo PDF_page-0001.jpg", "assets/galeria-casa-anguiano/1.png"]
                },
                {
                    nombre: "RESTAURANT BAR El Mesón",
                    lat: 20.6779142,
                    lng: -103.3457776,
                    categoria: "RESTAURANT BAR",
                    descripcion: "Casa fundada en 1942. El Mesón, un restaurante de estilo colonial en el corazón del centro histórico de Guadalajara. A un costado del Congreso del estado y solo unos pasos del Teatro Degollado y de la Catedral Metropolitana. Desayunos, comida mexicana auténtica, tacos artesanales y cócteles.",
                    direccion: "Calle Pino Suárez 92, Centro Histórico, Guadalajara, Jal.",
                    telefono: "+52 33 3614 7992",
                    facebook: "El Mesón",
                    galeria: ["assets/Anuncios/ANUNCIO EL MESON (1)_page-0001.jpg"]
                },
                {
                    nombre: "BIRRIERIA El Pilón de los Arrieros",
                    lat: 20.6705018,
                    lng: -103.348486,
                    categoria: "GASTRONOMÍA ARTESANAL",
                    descripcion: "Con más de 40 años de tradición. Lupita Figueroa es la dueña de todas las recetas, donde se sirven excelentes platillos, teniendo como especialidad la birria de chivo, además de la barbacoa de borrego, exquisitos chamorros adobados y la cochinita pibil complementan sus deliciosos platillos. Ven y disfruta de un festín de sabores mexicanos. Por sus mesas han pasado artistas, cantantes, actores, personajes de la radio y la televisión nacionales y extranjeros.",
                    direccion: "Calle Galeana 388, Plaza de las 9 esquinas, Centro Histórico. Guadalajara, Jal.",
                    horario: "Lunes – Domingo: 9:00 am – 9:00 pm",
                    telefono: "+52 33 3613 2799",
                    instagram: "@elpilondelosarrieros",
                    web: "elpilondelosarrieros.com",
                    galeria: ["assets/Anuncios/ANUNCIO PILON DE LOS ARRIEROS_page-0001.jpg", "assets/galeria-pilon-arrieros/1.png"]
                },
                {
                    nombre: "CARNITAS Uruapan",
                    lat: 20.6708807,
                    lng: -103.348373,
                    categoria: "UNA TRADICIÓN HECHA COMIDA",
                    descripcion: "Carnitas, Birria, Carne en su Jugo, Carne Asada. Famosas por su sabor las Carnitas Uruapan combinan el sazón y la calidad de sus ingredientes desde 1948. Carnitas estilo Michoacán y antojitos locales como tortas ahogadas en una fonda de barrio abierta a la calle.",
                    direccion: "Calle Colón 368, Plaza de las 9 esquinas, Centro Histórico. Guadalajara, Jal.",
                    horario: "Abre a las 9:00 hrs. / Cerrado los miércoles",
                    telefono: "+52 33 3614 3291",
                    facebook: "Carnitas Uruapan 9 Esquinas",
                    instagram: "@carnitas.uruapan_9",
                    web: "carnitasuruapan9esquinas.com.mx",
                    galeria: ["assets/Anuncios/ANUNCIO CARNITAS URUAPAN_page-0001.jpg"]
                },
                {
                    nombre: "FARMACIA Toledo",
                    lat: 20.6830116,
                    lng: -103.3479814,
                    categoria: "DESDE 1950",
                    descripcion: "La Botica Toledo sigue las tradicionales recetas de nuestros ancestros y te ofrece una variedad de productos a buen precio.",
                    direccion: "Paseo Alcalde 409, Centro Histórico. Guadalajara, Jal.",
                    telefono: "+52 33 3614 7990",
                    facebook: "Farmacia Toledo",
                    galeria: ["assets/Anuncios/ANUNCIO TOLEDO.jpeg"]
                },
                {
                    nombre: "BOTICA Toledo",
                    lat: 20.6830043,
                    lng: -103.3480686,
                    categoria: "DESDE 1950",
                    descripcion: "La Botica Toledo sigue las tradicionales recetas de nuestros ancestros y te ofrece una variedad de productos a buen precio.",
                    direccion: "Calle Herrera y Cairo 422, Col. Centro, Guadalajara, Jal.",
                    telefono: "+52 33 3613 0063",
                    facebook: "Farmacia Toledo",
                    galeria: ["assets/Anuncios/ANUNCIO TOLEDO.jpeg"]
                },
                {
                    nombre: "MERCADO de las Flores",
                    lat: 20.6905,
                    lng: -103.342,
                    categoria: "LA MAYOR OFERTA FLORAL EN GUADALAJARA",
                    descripcion: "Conocido también como el Mercado de Mezquitán, en él se encuentra la mayor variedad de tipos de flores, accesorios, ramos y arreglos florales para eventos sociales como Bodas, XV Años, Cumpleaños, Aniversarios, Coronas, Floreros, etc.",
                    direccion: "Calle Mezquitán esquina Jesús García",
                    galeria: ["assets/Anuncios/mercado de las flores_page-0001.jpg"]
                },
                {
                    nombre: "CALANDRIAS eléctricas",
                    lat: 20.6772,
                    lng: -103.3468,
                    categoria: "RECORRIDOS EN CALANDRIAS",
                    descripcion: "Disfruta de un paseo tradicional en calandria por el centro de Guadalajara, con vistas panorámicas por las principales plazas y puntos turísticos de la ciudad. Con capacidad de 1 a 5 personas, existen diferentes tipos de recorrido, ideal para los que quieran conocer la ciudad de forma cómoda y pintoresca. Ubicadas sobre Av. Hidalgo, a una cuadra de La Catedral. Contrataciones: Pedro Aguilar / Tel. y Whatsapp: +52 33 1209 5377. Gerardo Jiménez / Tel.: +52 33 2216 5446.",
                    direccion: "Ubicadas sobre Av. Hidalgo, a una cuadra de La Catedral",
                    galeria: ["assets/Anuncios/calandrias_page-0001.jpg"]
                },
                {
                    nombre: "LA GLORIA Artículos Religiosos",
                    lat: 20.6792802,
                    lng: -103.348433,
                    categoria: "TODA CLASE DE ARTÍCULOS PARA LA RELIGIÓN CATÓLICA",
                    descripcion: "La tienda Artículos Religiosos \"La Gloria\" se encuentra en el Centro de la ciudad y ofrece una variedad de artículos religiosos, como velas, rosarios, imágenes religiosas en resina, estampas y mucho más.",
                    direccion: "Calle Pedro Loza 189, Col. Centro, Guadalajara, Jal.",
                    telefono: "+52 33 3613 6370",
                    facebook: "Gloria de LA Gloria",
                    galeria: ["assets/Anuncios/ANUNCIO LA GLORIA.jpeg"]
                },
                {
                    nombre: "CASA CARRANZA Hotel Airbnb",
                    lat: 20.6810377,
                    lng: -103.3442471,
                    categoria: "BOUTIQUE HOTEL EN AIRBNB",
                    descripcion: "Descubre Guadalajara en nuestra suite ubicada en el corazón del centro histórico: Baño y cocina independiente totalmente equipada; 5-10 minutos caminando a la Catedral/Teatro Degollado. Disponibilidad para que dejes antes tus maletas. Contacto: Miguel Álvarez.",
                    direccion: "Calle Venustiano Carranza 242, Col. Centro, Guadalajara",
                    telefono: "+52 33 1062 6345",
                    instagram: "_casacarranza_",
                    galeria: ["assets/Anuncios/CASA CARRANZA.jpg"]
                },
                {
                    nombre: "RESTAURANT Guasanga",
                    lat: 20.6764485,
                    lng: -103.3483055,
                    categoria: "LA MEJOR COMIDA – LA MEJOR VISTA",
                    descripcion: "Restaurante Bar Familiar con música en vivo y la mejor vista de Guadalajara! Disfruta de nuestra coctelería y cantaritos, acompañados de los diversos platillos con la creatividad de nuestra cocina.",
                    direccion: "Calle Morelos 401, Primer piso, Col. Centro, Guadalajara",
                    horario: "Domingo a Jueves de 9:00 a 22:00 hrs. Viernes y Sábado de 9:00 hrs a 01:30 am",
                    instagram: "guasanga.mx",
                    galeria: ["assets/Anuncios/Guasanga mapa Guadalajara ciudad de las rosas_page-0001.jpg"]
                },
                {
                    nombre: "CANTINA Los Famosos Equipales",
                    lat: 20.684555,
                    lng: -103.3522987,
                    categoria: "FUNDADA EN 1920 POR CARMEN MANCILLA",
                    descripcion: "Es un símbolo de la tradición tapatía que está por cumplir su 106 aniversario. Su trago más famoso es la \"Nalga Alegre\", una mezcla de ginebra, ron, vino tinto, refresco de cola y jugo de naranja. Conserva la estética tradicional de las cantinas antiguas, decorada, por supuesto, con muebles de equipal.",
                    direccion: "Calle Juan Álvarez 704, Col. Centro, Guadalajara",
                    instagram: "losfamososequipales",
                    galeria: ["assets/Anuncios/ANUNCIO LOS EQUIPALES_page-0001.jpg"]
                },
                {
                    nombre: "MARIACHI México en la Piel",
                    lat: 20.677,
                    lng: -103.347,
                    categoria: "AL SON DEL MARIACHI, JALISCO ESTÁ DE FIESTA",
                    descripcion: "La música más mexicana interpretada por mariachis profesionales que viven y comparten las mejores canciones para amenizar cualquier evento u ocasión. Atención personalizada. Contrataciones: Rep. Pedro Zaragoza +52 33 1027 6501.",
                    direccion: "Contrataciones: Rep. Pedro Zaragoza +52 33 1027 6501",
                    telefono: "+52 33 1027 6501",
                    facebook: "Mariachi México en la piel",
                    galeria: ["assets/Anuncios/mariachi02_page-0001.jpg"]
                },
                {
                    nombre: "ACADEMIA Nuevo Jalisco",
                    lat: 20.6773644,
                    lng: -103.3431203,
                    categoria: "CLASES DE DANZA FOLCLÓRICA",
                    descripcion: "Inscripciones abiertas para niños, jóvenes y adultos.",
                    direccion: "Av. Hidalgo 107, Col. Centro, Guadalajara, Jal.",
                    telefono: "+52 33 3033 5787"
                },
                {
                    nombre: "MIMOSA Artículos Religiosos",
                    lat: 20.6764789,
                    lng: -103.3595036,
                    categoria: "DESIGN & MERCH STUDIO",
                    descripcion: "Estudio de diseño & personalización de productos. Stickers, thermos, playeras, gorras, vinos, uniformes, mochilas, viniles, papelería y mucho más para empresas, eventos sociales, instituciones educativas.",
                    direccion: "Av. Enrique Díaz de León 13, Col. Villaseñor, Guadalajara, Jal.",
                    horario: "Oficinas de 9:00 a 14:00 hrs.",
                    telefono: "+52 33 3827 2712",
                    instagram: "mimosa.estudio",
                    web: "mimosaestudio.com",
                    galeria: ["assets/Anuncios/MIMOSA_page-0001.jpg"]
                },
                {
                    nombre: "TAKASAMI Clothing",
                    lat: 20.639109,
                    lng: -103.3126873,
                    categoria: "MEXICAN HANDCRAFTED CLOTHES",
                    descripcion: "Somos una línea de ropa artesanal que se caracteriza por el uso de mantas y tejidos de algodón en diferentes texturas, que al ser complementadas con los textiles mexicanos y los detalles artesanales damos vida a prendas con diseño internacional y alma mexicana.",
                    direccion: "Calle Matamoros No. 12, Centro Tlaquepaque, Jal.",
                    telefono: "+52 33 3122 4512",
                    email: "tienda@takasami.com.mx",
                    instagram: "tkstakasami",
                    facebook: "Takasami",
                    web: "takasami.com.mx",
                    galeria: ["assets/Anuncios/takasami_page-0001.jpg"]
                }
            ]
        };

        // Rellenar lista del sidebar izquierdo desde lugares (funciona aunque el mapa no cargue, p. ej. en producción sin API key)
        function getDisplayNameForSidebar(nombreEspanol) {
            var lang = window.currentLang || 'es';
            if (lang === 'en' && window.T && window.T.en && window.T.en.sidebarLeftNames && window.T.en.sidebarLeftNames[nombreEspanol])
                return window.T.en.sidebarLeftNames[nombreEspanol];
            return nombreEspanol || '';
        }
        window.fillSidebarListFromLugares = function(opts) {
            opts = opts || {};
            var list = document.getElementById('sidebarPuntosList');
            if (!list) return;
            var historicos = lugares.historicos || [];
            var empresas = lugares.empresas || [];
            var ordenAnunciantes = [
                'GUARDIÁN CAFÉ-GALERÍA', 'TORTAS AHOGADAS Las Famosas', 'HOTEL Aló', 'HOTEL Olá', 'RESTAURANT Los Paceños',
                'TARASKA Helados y Paletas', 'TARASKA Helados y Paletas', 'EX-CONVENTO DE SANTA TERESA', 'HOTEL ONE Guadalajara Centro',
                'RAGAZZA Fashion', 'RAGAZZA Fashion', 'RESTAURANT Casa Dolores', 'RESTAURANT Casa Dolores', 'RESTAURANT Alma Jalisco',
                'CONOCE JALISCO Tours', 'CASA ANGUIANO Artículos Religiosos', 'RESTAURANT BAR El Mesón', 'BIRRIERIA El Pilón de los Arrieros',
                'CARNITAS Uruapan', 'BOTICA Toledo', 'FARMACIA Toledo', 'MERCADO de las Flores', 'CALANDRIAS eléctricas',
                'LA GLORIA Artículos Religiosos', 'CASA CARRANZA Hotel Airbnb', 'RESTAURANT Guasanga', 'CANTINA Los Famosos Equipales',
                'MARIACHI México en la Piel', 'ACADEMIA Nuevo Jalisco', 'MIMOSA Artículos Religiosos', 'TAKASAMI Clothing'
            ];
            list.innerHTML = '';

            function addItem(label, nombre, markerIndex) {
                var li = document.createElement('li');
                li.className = 'sidebar-puntos-item';
                li.dataset.markerIndex = markerIndex;
                li.dataset.nombre = nombre || '';
                var displayName = getDisplayNameForSidebar(nombre);
                li.innerHTML = '<span class="num">' + (label + '').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</span><span class="name">' + (displayName.replace(/</g, '&lt;').replace(/>/g, '&gt;')) + '</span>';
                if (opts.map && opts.allMarkers && opts.allMarkers[markerIndex]) {
                    var m = opts.allMarkers[markerIndex];
                    li.addEventListener('click', function() {
                        opts.map.panTo(m.marker.getPosition());
                        opts.map.setZoom(17);
                        if (m.marker.getMap()) google.maps.event.trigger(m.marker, 'click');
                        if (window.innerWidth <= 768 && typeof window.closeSidebarPuntos === 'function') window.closeSidebarPuntos();
                    });
                }
                list.appendChild(li);
            }

            // 1. Anunciantes: números 1 a 31 en el orden del listado oficial (nombres duplicados por ocurrencia)
            var usedCount = {};
            ordenAnunciantes.forEach(function(nombre, i) {
                var count = (usedCount[nombre] || 0);
                usedCount[nombre] = count + 1;
                var idx = -1, n = 0;
                for (var j = 0; j < empresas.length; j++) {
                    if (empresas[j].nombre === nombre) {
                        if (n === count - 1) { idx = j; break; }
                        n++;
                    }
                }
                if (idx === -1) idx = i;
                var markerIndex = historicos.length + idx;
                addItem(i + 1, nombre, markerIndex);
            });

            // 2. Separador: Edificios históricos (A-I, 9 en total)
            var sep = document.createElement('li');
            sep.className = 'sidebar-puntos-sep';
            sep.setAttribute('aria-hidden', 'true');
            sep.textContent = 'Edificios históricos (A-' + String.fromCharCode(64 + Math.max(1, historicos.length)) + ')';
            list.appendChild(sep);

            // 3. Edificios históricos: letras A, B, C... I (9 lugares)
            historicos.forEach(function(lugar, i) {
                var letra = String.fromCharCode(65 + i);
                addItem(letra, lugar.nombre, i);
            });
        };

        // Mostrar lista del sidebar en cuanto el DOM esté listo (así se ve aunque el mapa no cargue)
        function initSidebarList() {
            if (typeof window.fillSidebarListFromLugares === 'function') window.fillSidebarListFromLugares();
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSidebarList);
        } else {
            initSidebarList();
        }

        // ===== FUNCIONES DE GALERÍA =====
        // Almacenar estado de cada galería
        const galeriaEstado = {};

        function inicializarGaleria(galeriaId, imagenes) {
            galeriaEstado[galeriaId] = {
                imagenes: imagenes,
                indiceActual: 0
            };
        }

        function cambiarImagenGaleria(galeriaId, direccion) {
            const estado = galeriaEstado[galeriaId];
            if (!estado) return;
            
            estado.indiceActual += direccion;
            if (estado.indiceActual < 0) estado.indiceActual = estado.imagenes.length - 1;
            if (estado.indiceActual >= estado.imagenes.length) estado.indiceActual = 0;
            
            actualizarGaleria(galeriaId);
        }

        function irAImagenGaleria(galeriaId, indice) {
            const estado = galeriaEstado[galeriaId];
            if (!estado) return;
            
            estado.indiceActual = indice;
            actualizarGaleria(galeriaId);
        }

        function actualizarGaleria(galeriaId) {
            const estado = galeriaEstado[galeriaId];
            if (!estado) return;
            
            const mainImg = document.getElementById(galeriaId + '-main');
            const counter = document.getElementById(galeriaId + '-counter');
            const thumbs = document.querySelectorAll(`#${galeriaId} .gallery-thumb`);
            
            if (mainImg) {
                mainImg.style.opacity = '0';
                setTimeout(() => {
                    mainImg.src = estado.imagenes[estado.indiceActual];
                    mainImg.style.opacity = '1';
                }, 150);
            }
            
            if (counter) {
                counter.textContent = `${estado.indiceActual + 1} / ${estado.imagenes.length}`;
            }
            
            thumbs.forEach((thumb, i) => {
                thumb.classList.toggle('active', i === estado.indiceActual);
            });
        }

        // Lightbox
        let lightboxActivo = null;

        function abrirLightbox(galeriaId) {
            const estado = galeriaEstado[galeriaId];
            if (!estado) return;
            
            lightboxActivo = galeriaId;
            
            // Crear lightbox si no existe
            let lightbox = document.getElementById('lightbox-global');
            if (!lightbox) {
                lightbox = document.createElement('div');
                lightbox.id = 'lightbox-global';
                lightbox.className = 'lightbox';
                lightbox.innerHTML = `
                    <button class="lightbox-close" onclick="cerrarLightbox()">
                        <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                    </button>
                    <button class="lightbox-nav prev" onclick="cambiarImagenLightbox(-1)">
                        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                    </button>
                    <img id="lightbox-img" src="" alt="">
                    <button class="lightbox-nav next" onclick="cambiarImagenLightbox(1)">
                        <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                    </button>
                    <span class="lightbox-counter" id="lightbox-counter"></span>
                `;
                document.body.appendChild(lightbox);
                
                // Cerrar con click en fondo
                lightbox.addEventListener('click', (e) => {
                    if (e.target === lightbox) cerrarLightbox();
                });
                
                // Cerrar con Escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') cerrarLightbox();
                    if (e.key === 'ArrowLeft') cambiarImagenLightbox(-1);
                    if (e.key === 'ArrowRight') cambiarImagenLightbox(1);
                });
            }
            
            actualizarLightbox();
            lightbox.classList.add('active');
        }

        function cerrarLightbox() {
            const lightbox = document.getElementById('lightbox-global');
            if (lightbox) lightbox.classList.remove('active');
            lightboxActivo = null;
        }

        function cambiarImagenLightbox(direccion) {
            if (!lightboxActivo) return;
            cambiarImagenGaleria(lightboxActivo, direccion);
            actualizarLightbox();
        }

        function actualizarLightbox() {
            if (!lightboxActivo) return;
            const estado = galeriaEstado[lightboxActivo];
            if (!estado) return;
            
            const img = document.getElementById('lightbox-img');
            const counter = document.getElementById('lightbox-counter');
            
            if (img) img.src = estado.imagenes[estado.indiceActual];
            if (counter) counter.textContent = `${estado.indiceActual + 1} / ${estado.imagenes.length}`;
        }

        // Función para inicializar galería cuando se abre un InfoWindow
        function setupGaleria(lugar) {
            if (lugar.galeria && lugar.galeria.length > 0) {
                const galeriaId = 'gallery-' + lugar.nombre.replace(/\s+/g, '-').toLowerCase();
                inicializarGaleria(galeriaId, lugar.galeria);
            }
        }

        // Función para inicializar el mapa
        function initMap() {
            if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
                var el = document.getElementById('map');
                if (el) el.innerHTML = '<div class="map-error-msg" style="padding:24px;text-align:center;font-family:sans-serif;color:#666;">No se pudo cargar la API de Google Maps. Revisa la consola del navegador (F12).</div>';
                return;
            }
            // Calcular el centro óptimo basado en todos los puntos
            const todosLosPuntos = [...lugares.historicos, ...lugares.empresas];
            const sumaLat = todosLosPuntos.reduce((acc, p) => acc + p.lat, 0);
            const sumaLng = todosLosPuntos.reduce((acc, p) => acc + p.lng, 0);
            const centro = { 
                lat: sumaLat / todosLosPuntos.length, 
                lng: sumaLng / todosLosPuntos.length 
            };
            
            // Crear el mapa centrado donde están los puntos
            // Estilo "Ciudad de las Rosas" - tonos rosa/pastel
            const estiloMapa = [
                // Fondo general rosa claro
                {
                    featureType: 'all',
                    elementType: 'geometry',
                    stylers: [{ saturation: 10 }, { lightness: 5 }]
                },
                // Paisaje/fondo en rosa #f79ed6
                {
                    featureType: 'landscape',
                    elementType: 'geometry.fill',
                    stylers: [{ color: '#f9c4e2' }] // Rosa claro basado en #f79ed6
                },
                {
                    featureType: 'landscape.man_made',
                    elementType: 'geometry.fill',
                    stylers: [{ color: '#f79ed6' }] // Rosa principal del usuario
                },
                // Parques en verde suave
                {
                    featureType: 'poi.park',
                    elementType: 'geometry.fill',
                    stylers: [{ color: '#a5d6a7' }] // Verde pastel
                },
                // Ocultar POIs
                {
                    featureType: 'poi',
                    elementType: 'labels',
                    stylers: [{ visibility: 'off' }]
                },
                {
                    featureType: 'poi.business',
                    stylers: [{ visibility: 'off' }]
                },
                // ===== OCULTAR ETIQUETAS DE GOOGLE MAPS PARA COLONIAS/BARRIOS =====
                // Solo usamos nuestras etiquetas personalizadas con tipografía Bebas Neue
                {
                    featureType: 'administrative.neighborhood',
                    elementType: 'labels',
                    stylers: [{ visibility: 'off' }]
                },
                {
                    featureType: 'administrative.land_parcel',
                    elementType: 'labels',
                    stylers: [{ visibility: 'off' }]
                },
                {
                    featureType: 'administrative.locality',
                    elementType: 'labels.text',
                    stylers: [{ visibility: 'off' }]
                },
                // Calles principales en blanco/crema
                {
                    featureType: 'road.highway',
                    elementType: 'geometry.fill',
                    stylers: [{ color: '#fff9c4' }] // Amarillo muy claro
                },
                {
                    featureType: 'road.highway',
                    elementType: 'geometry.stroke',
                    stylers: [{ color: '#ffeb3b' }, { weight: 1 }]
                },
                {
                    featureType: 'road.arterial',
                    elementType: 'geometry.fill',
                    stylers: [{ color: '#ffffff' }] // Blanco
                },
                {
                    featureType: 'road.arterial',
                    elementType: 'geometry.stroke',
                    stylers: [{ color: '#e0e0e0' }]
                },
                {
                    featureType: 'road.local',
                    elementType: 'geometry.fill',
                    stylers: [{ color: '#ffffff' }]
                },
                {
                    featureType: 'road.local',
                    elementType: 'geometry.stroke',
                    stylers: [{ color: '#f5f5f5' }]
                },
                // Nombres de calles - ocultar para usar solo nuestras etiquetas
                {
                    featureType: 'road',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#888888' }] // Gris claro para calles menores
                },
                {
                    featureType: 'road',
                    elementType: 'labels.text.stroke',
                    stylers: [{ color: '#ffffff' }, { weight: 2 }]
                },
                // Agua en azul claro
                {
                    featureType: 'water',
                    elementType: 'geometry.fill',
                    stylers: [{ color: '#81d4fa' }] // Azul claro
                },
                // Transporte simplificado
                {
                    featureType: 'transit',
                    elementType: 'all',
                    stylers: [{ visibility: 'simplified' }]
                },
                {
                    featureType: 'transit.station',
                    elementType: 'labels.icon',
                    stylers: [{ visibility: 'off' }]
                }
            ];

            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15, // Zoom para mostrar todos los puntos claramente
                center: centro,
                mapTypeId: 'roadmap',
                styles: estiloMapa,
                mapTypeControl: false, // Usamos nuestro propio control
                fullscreenControl: false,
                streetViewControl: false,
                zoomControl: false, // Usamos controles personalizados
                scaleControl: true, // Mostrar escala de Google
                scaleControlOptions: {
                    position: google.maps.ControlPosition.BOTTOM_RIGHT
                }
            });

            window._mapLoaded = true;
            if (window._mapLoadTimeout) clearTimeout(window._mapLoadTimeout);

            // ===== ETIQUETAS DE ZONAS ESTILO VINTAGE =====
            // Clase personalizada para crear etiquetas sobre el mapa
            class ZoneLabel extends google.maps.OverlayView {
                constructor(position, text, options = {}) {
                    super();
                    this.position = position;
                    this.text = text;
                    this.options = {
                        className: options.className || 'zone-label',
                        prefix: options.prefix || '',
                        minZoom: options.minZoom || 13,
                        maxZoom: options.maxZoom || 20
                    };
                    this.div = null;
                }

                onAdd() {
                    this.div = document.createElement('div');
                    this.div.className = this.options.className;
                    
                    if (this.options.prefix) {
                        this.div.innerHTML = `
                            <div class="zone-label-container">
                                <span class="zone-label-prefix">${this.options.prefix}</span>
                                <span class="zone-label-name">${this.text}</span>
                            </div>
                        `;
                    } else {
                        this.div.textContent = this.text;
                    }
                    
                    const panes = this.getPanes();
                    panes.overlayLayer.appendChild(this.div);
                }

                draw() {
                    const overlayProjection = this.getProjection();
                    const pos = overlayProjection.fromLatLngToDivPixel(this.position);
                    
                    if (this.div) {
                        this.div.style.left = pos.x + 'px';
                        this.div.style.top = pos.y + 'px';
                        this.div.style.transform = 'translate(-50%, -50%)';
                        
                        // Mostrar/ocultar según el nivel de zoom
                        const currentZoom = this.getMap().getZoom();
                        if (currentZoom >= this.options.minZoom && currentZoom <= this.options.maxZoom) {
                            this.div.style.display = 'block';
                            // Ajustar tamaño según zoom
                            const scale = Math.min(1.3, Math.max(0.7, (currentZoom - 12) / 5));
                            this.div.style.transform = `translate(-50%, -50%) scale(${scale})`;
                        } else {
                            this.div.style.display = 'none';
                        }
                    }
                }

                onRemove() {
                    if (this.div) {
                        this.div.parentNode.removeChild(this.div);
                        this.div = null;
                    }
                }
            }

            // Definir las zonas de Guadalajara con sus coordenadas (basado en mapa ilustrado)
            const zonasGDL = [
                // ===== ZONAS PRINCIPALES (Grandes) =====
                { lat: 20.6740, lng: -103.3450, text: 'ZONA CENTRO', className: 'zone-label zona-grande', minZoom: 14 },
                { lat: 20.6680, lng: -103.3620, text: 'ZONA CHAPULTEPEC', className: 'zone-label zona-grande', minZoom: 14 },
                { lat: 20.6800, lng: -103.3700, text: 'ZONA VALLARTA NTE.', className: 'zone-label zona-grande', minZoom: 14 },
                { lat: 20.6720, lng: -103.3780, text: 'ZONA MINERVA', className: 'zone-label zona-grande', minZoom: 14 },
                { lat: 20.6580, lng: -103.3720, text: 'ZONA CHAPALITA', className: 'zone-label zona-grande', minZoom: 14 },
                
                // ===== BARRIOS CON PREFIJO =====
                { lat: 20.6900, lng: -103.3520, prefix: 'BARRIO DE', text: 'MEZQUITÁN', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6830, lng: -103.3600, prefix: 'BARRIO DE', text: 'SANTA TERE', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6680, lng: -103.3350, prefix: 'BARRIO DE LAS', text: 'NUEVE ESQUINAS', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6580, lng: -103.3450, prefix: 'BARRIO DE', text: 'MEXICALTZINGO', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6860, lng: -103.3480, prefix: 'PANTEÓN DE', text: 'MEZQUITÁN', className: 'zone-label barrio-small', minZoom: 15 },
                { lat: 20.6650, lng: -103.3250, prefix: 'PARQUE', text: 'AGUA AZUL', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6660, lng: -103.3150, prefix: 'BARRIO DE', text: 'ANALCO', className: 'zone-label barrio', minZoom: 14 },
                
                // ===== COLONIAS Y FRACCIONAMIENTOS =====
                { lat: 20.6660, lng: -103.3590, text: 'COLONIA AMERICANA', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6600, lng: -103.3500, text: 'COLONIA MODERNA', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6780, lng: -103.3680, text: 'LADRÓN DE GUEVARA', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6880, lng: -103.3320, prefix: 'ALCALDE', text: 'BARRANQUITAS', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6920, lng: -103.3250, text: 'EL RETIRO', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6950, lng: -103.3180, text: 'SANTA MARÍA', className: 'zone-label barrio-small', minZoom: 15 },
                { lat: 20.6850, lng: -103.3150, text: 'BELISARIO DOMÍNGUEZ', className: 'zone-label barrio-small', minZoom: 15 },
                { lat: 20.6750, lng: -103.3220, text: 'SAN JUAN DE DIOS', className: 'zone-label barrio', minZoom: 14 },
                { lat: 20.6800, lng: -103.3150, text: 'OBLATOS', className: 'zone-label barrio', minZoom: 15 },
                { lat: 20.6700, lng: -103.3130, text: 'REFORMA', className: 'zone-label barrio', minZoom: 15 },
                { lat: 20.6730, lng: -103.3050, text: 'LA PENAL', className: 'zone-label barrio', minZoom: 15 },
                { lat: 20.6620, lng: -103.3080, text: 'REVOLUCIÓN', className: 'zone-label barrio', minZoom: 15 },
                { lat: 20.6580, lng: -103.3200, text: 'LAS CONCHAS', className: 'zone-label barrio-small', minZoom: 15 },
                { lat: 20.6620, lng: -103.3020, text: 'HERNÁNDEZ ROMO', className: 'zone-label barrio-small', minZoom: 15 },
                { lat: 20.6780, lng: -103.3750, text: 'VILLASEÑOR', className: 'zone-label barrio-small', minZoom: 15 },
                { lat: 20.6850, lng: -103.3720, text: 'ARTESANOS', className: 'zone-label barrio-small', minZoom: 15 },
                { lat: 20.6920, lng: -103.3700, text: 'COUNTRY', className: 'zone-label barrio-small', minZoom: 15 },
                { lat: 20.6600, lng: -103.3650, text: 'OBRERA', className: 'zone-label barrio-small', minZoom: 15 },
                { lat: 20.6920, lng: -103.3150, prefix: 'PARQUE', text: 'MORELOS', className: 'zone-label barrio', minZoom: 14 },
                
                // ===== PARQUES Y PLAZAS =====
                { lat: 20.6940, lng: -103.3550, text: 'PLAZA PATRIA', className: 'zone-label glorieta', minZoom: 14 },
                { lat: 20.6910, lng: -103.3280, prefix: 'PARQUE', text: 'ALCALDE', className: 'zone-label glorieta', minZoom: 15 },
                { lat: 20.6720, lng: -103.3550, prefix: 'PARQUE', text: 'REVOLUCIÓN', className: 'zone-label glorieta', minZoom: 14 },
                
                // ===== GLORIETAS =====
                { lat: 20.6850, lng: -103.3630, text: 'GLORIETA COLÓN', className: 'zone-label glorieta', minZoom: 15 },
                { lat: 20.6620, lng: -103.3560, text: 'GLORIETA NIÑOS HÉROES', className: 'zone-label glorieta', minZoom: 14 },
                { lat: 20.6930, lng: -103.3100, prefix: 'GLORIETA', text: 'LA NORMAL', className: 'zone-label glorieta', minZoom: 15 },
                { lat: 20.6700, lng: -103.3800, text: 'GLORIETA MINERVA', className: 'zone-label glorieta', minZoom: 15 },
                
                // ===== AVENIDAS PRINCIPALES =====
                { lat: 20.6770, lng: -103.3480, text: 'AV. HIDALGO', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6700, lng: -103.3650, text: 'AV. VALLARTA', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6650, lng: -103.3480, text: 'AV. LA PAZ', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6630, lng: -103.3530, text: 'AV. NIÑOS HÉROES', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6780, lng: -103.3380, text: 'CALZ. INDEPENDENCIA', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6800, lng: -103.3550, text: 'CALZ. FEDERALISMO', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6920, lng: -103.3480, text: 'AV. ÁVILA CAMACHO', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6760, lng: -103.3250, text: 'AV. JAVIER MINA', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6720, lng: -103.3400, text: 'AV. JUÁREZ', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6700, lng: -103.3320, text: 'AV. ALCALDE', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6580, lng: -103.3320, text: 'CALZ. REVOLUCIÓN', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6850, lng: -103.3750, text: 'AV. MÉXICO', className: 'zone-label avenida', minZoom: 15 },
                { lat: 20.6550, lng: -103.3600, text: 'AV. MARIANO OTERO', className: 'zone-label avenida', minZoom: 15 }
            ];

            // Crear las etiquetas de zonas
            const zoneLabels = [];
            zonasGDL.forEach(zona => {
                const label = new ZoneLabel(
                    new google.maps.LatLng(zona.lat, zona.lng),
                    zona.text,
                    {
                        className: zona.className,
                        prefix: zona.prefix || '',
                        minZoom: zona.minZoom || 14
                    }
                );
                label.setMap(map);
                zoneLabels.push(label);
            });

            // Actualizar etiquetas cuando cambia el zoom
            map.addListener('zoom_changed', () => {
                zoneLabels.forEach(label => label.draw());
            });

            // ===== FUNCIONALIDAD DE BÚSQUEDA =====
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            const allPlaces = [...lugares.historicos, ...lugares.empresas];

            function filterPlaces(query) {
                if (!query.trim()) return [];
                const lowerQuery = query.toLowerCase();
                return allPlaces.filter(place => 
                    place.nombre.toLowerCase().includes(lowerQuery) ||
                    place.categoria.toLowerCase().includes(lowerQuery) ||
                    (place.descripcion && place.descripcion.toLowerCase().includes(lowerQuery))
                );
            }

            function renderSearchResults(results) {
                if (results.length === 0) {
                    searchResults.classList.remove('active');
                    return;
                }
                
                searchResults.innerHTML = results.map(place => {
                    const isHistorical = place.categoria.includes('HISTÓRICO');
                    const iconClass = isHistorical ? 'historical' : 'business';
                    const hasLocation = currentUserLocation !== null;
                    return `
                        <div class="search-result-item" data-lat="${place.lat}" data-lng="${place.lng}" data-name="${place.nombre}">
                            <div class="search-result-icon ${iconClass}">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
                                </svg>
                            </div>
                            <div class="search-result-text">
                                <div class="search-result-name">${place.nombre}</div>
                                <div class="search-result-category">${place.categoria}</div>
                            </div>
                            ${hasLocation ? `
                                <button class="search-route-btn" data-lat="${place.lat}" data-lng="${place.lng}" data-name="${place.nombre}" title="Cómo llegar">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M21.71 11.29l-9-9a.996.996 0 00-1.41 0l-9 9a.996.996 0 000 1.41l9 9c.39.39 1.02.39 1.41 0l9-9a.996.996 0 000-1.41zM14 14.5V12h-4v3H8v-4c0-.55.45-1 1-1h5V7.5l3.5 3.5-3.5 3.5z"/>
                                    </svg>
                                </button>
                            ` : ''}
                        </div>
                    `;
                }).join('');
                
                searchResults.classList.add('active');
            }

            searchInput.addEventListener('input', function() {
                const results = filterPlaces(this.value);
                renderSearchResults(results);
            });

            searchInput.addEventListener('focus', function() {
                if (this.value.trim()) {
                    const results = filterPlaces(this.value);
                    renderSearchResults(results);
                }
            });

            searchResults.addEventListener('click', function(e) {
                // Verificar si se hizo clic en el botón de ruta
                const routeBtn = e.target.closest('.search-route-btn');
                if (routeBtn) {
                    e.stopPropagation();
                    const lat = parseFloat(routeBtn.dataset.lat);
                    const lng = parseFloat(routeBtn.dataset.lng);
                    const name = routeBtn.dataset.name;
                    searchResults.classList.remove('active');
                    searchInput.value = name;
                    calculateRoute({ lat, lng }, name);
                    return;
                }
                
                const item = e.target.closest('.search-result-item');
                if (item) {
                    const lat = parseFloat(item.dataset.lat);
                    const lng = parseFloat(item.dataset.lng);
                    const name = item.dataset.name;
                    map.setCenter({ lat, lng });
                    map.setZoom(17);
                    searchResults.classList.remove('active');
                    searchInput.value = name;
                    
                    // Encontrar y abrir el InfoWindow del marcador correspondiente
                    const markerData = allMarkers.find(m => 
                        m.lugar.lat === lat && m.lugar.lng === lng
                    );
                    if (markerData) {
                        closeActiveInfoWindow();
                        markerData.infoWindow.open(map, markerData.marker);
                        activeInfoWindow = markerData.infoWindow;
                        activeMarker = markerData.marker;
                        markerData.marker.setAnimation(google.maps.Animation.BOUNCE);
                        setTimeout(() => markerData.marker.setAnimation(null), 700);
                    }
                }
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    searchResults.classList.remove('active');
                }
            });

            // ===== CONTROLES DE ZOOM PERSONALIZADOS =====
            document.getElementById('zoomIn').addEventListener('click', function() {
                map.setZoom(map.getZoom() + 1);
            });

            document.getElementById('zoomOut').addEventListener('click', function() {
                map.setZoom(map.getZoom() - 1);
            });

            // ===== STREET VIEW =====
            const streetViewBtn = document.getElementById('btnStreetView');
            let streetViewActive = false;
            
            // Crear el servicio de Street View
            const streetViewService = new google.maps.StreetViewService();
            const panorama = map.getStreetView();
            
            streetViewBtn.addEventListener('click', function() {
                if (streetViewActive) {
                    // Desactivar Street View
                    panorama.setVisible(false);
                    streetViewActive = false;
                    this.classList.remove('active');
                } else {
                    // Activar Street View en el centro actual del mapa
                    const center = map.getCenter();
                    streetViewService.getPanorama({
                        location: center,
                        radius: 50
                    }, function(data, status) {
                        if (status === google.maps.StreetViewStatus.OK) {
                            panorama.setPosition(data.location.latLng);
                            panorama.setPov({
                                heading: 270,
                                pitch: 0
                            });
                            panorama.setVisible(true);
                            streetViewActive = true;
                            streetViewBtn.classList.add('active');
                        } else {
                            alert('Street View no disponible en esta ubicación. Mueve el mapa a una calle.');
                        }
                    });
                }
            });

            // Detectar cuando se cierra Street View
            panorama.addListener('visible_changed', function() {
                if (!panorama.getVisible()) {
                    streetViewActive = false;
                    streetViewBtn.classList.remove('active');
                }
            });

            // Variables para controlar las capas
            let trafficLayer = null;
            let transitLayer = null;
            const layerStates = {
                traffic: false,
                transit: false
            };

            // Inicializar capas de Google Maps
            trafficLayer = new google.maps.TrafficLayer();
            transitLayer = new google.maps.TransitLayer();

            // Widget de Capas (Tráfico y Transporte público)
            const layersButton = document.getElementById('btnLayers');
            const layersMenu = document.getElementById('layersMenu');
            const layerItems = layersMenu.querySelectorAll('.layers-menu-item');

            // Widget de Tipo de Mapa (Estándar, Satélite, Relieve)
            const mapTypeButton = document.getElementById('btnMapType');
            const mapTypeMenu = document.getElementById('mapTypeMenu');
            const mapTypeItems = mapTypeMenu.querySelectorAll('.map-type-menu-item');

            // Toggle del menú de capas
            layersButton.addEventListener('click', function(e) {
                e.stopPropagation();
                layersMenu.classList.toggle('active');
                // Cerrar el menú de tipo de mapa si está abierto
                mapTypeMenu.classList.remove('active');
            });

            // Manejar clics en los items del menú de capas
            layerItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const layerType = this.getAttribute('data-layer');
                    toggleLayer(layerType);
                });
            });

            // Función para activar/desactivar capas
            function toggleLayer(layerType) {
                const item = layersMenu.querySelector(`[data-layer="${layerType}"]`);
                
                if (layerType === 'traffic') {
                    layerStates.traffic = !layerStates.traffic;
                    if (layerStates.traffic) {
                        trafficLayer.setMap(map);
                        item.classList.add('active');
                    } else {
                        trafficLayer.setMap(null);
                        item.classList.remove('active');
                    }
                } else if (layerType === 'transit') {
                    layerStates.transit = !layerStates.transit;
                    if (layerStates.transit) {
                        transitLayer.setMap(map);
                        item.classList.add('active');
                    } else {
                        transitLayer.setMap(null);
                        item.classList.remove('active');
                    }
                }
            }

            // Marcar "Estándar" como activo por defecto
            const defaultMapTypeItem = mapTypeMenu.querySelector('[data-map-type="roadmap"]');
            if (defaultMapTypeItem) {
                defaultMapTypeItem.classList.add('active');
            }

            // Toggle del menú de tipo de mapa
            mapTypeButton.addEventListener('click', function(e) {
                e.stopPropagation();
                mapTypeMenu.classList.toggle('active');
                // Cerrar el menú de capas si está abierto
                layersMenu.classList.remove('active');
            });

            // Manejar clics en los items del menú de tipo de mapa
            mapTypeItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const mapType = this.getAttribute('data-map-type');
                    setMapType(mapType);
                });
            });

            // Función para cambiar el tipo de mapa base
            function setMapType(mapType) {
                // Remover activo de todos los items
                mapTypeItems.forEach(item => {
                    item.classList.remove('active');
                });

                // Activar el item seleccionado
                const selectedItem = mapTypeMenu.querySelector(`[data-map-type="${mapType}"]`);
                if (selectedItem) {
                    selectedItem.classList.add('active');
                }

                // Cambiar el tipo de mapa
                map.setMapTypeId(mapType);
            }

            // Cerrar los menús al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (!layersMenu.contains(e.target) && !layersButton.contains(e.target)) {
                    layersMenu.classList.remove('active');
                }
                if (!mapTypeMenu.contains(e.target) && !mapTypeButton.contains(e.target)) {
                    mapTypeMenu.classList.remove('active');
                }
            });

            // Función para crear icono personalizado desde imagen
            function crearIconoPersonalizado(rutaImagen, tamaño = 34) {
                return {
                    url: rutaImagen,
                    scaledSize: new google.maps.Size(tamaño, tamaño),
                    anchor: new google.maps.Point(tamaño / 2, tamaño / 2),
                    origin: new google.maps.Point(0, 0)
                };
            }

            // Icono de georreferenciación para empresas - estilo ArcGIS profesional (reserva / sin número)
            const iconoGeorreferenciacion = {
                url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                    <svg width="40" height="52" viewBox="0 0 40 52" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.3"/>
                            </filter>
                        </defs>
                        <path d="M20 0 C8.95 0 0 8.95 0 20 C0 35 20 52 20 52 C20 52 40 35 40 20 C40 8.95 31.05 0 20 0 Z" 
                              fill="#8B1538" filter="url(#shadow)"/>
                        <circle cx="20" cy="20" r="14" fill="#fff"/>
                        <circle cx="20" cy="20" r="8" fill="#8B1538"/>
                        <circle cx="20" cy="20" r="4" fill="#fff"/>
                    </svg>
                `),
                scaledSize: new google.maps.Size(22, 29),
                anchor: new google.maps.Point(11, 29)
            };

            // Icono para edificios históricos (sin imagen) - color distintivo
            const iconoHistorico = {
                url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                    <svg width="40" height="52" viewBox="0 0 40 52" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="shadowH" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.3"/>
                            </filter>
                        </defs>
                        <path d="M20 0 C8.95 0 0 8.95 0 20 C0 35 20 52 20 52 C20 52 40 35 40 20 C40 8.95 31.05 0 20 0 Z" 
                              fill="#1565C0" filter="url(#shadowH)"/>
                        <circle cx="20" cy="20" r="14" fill="#fff"/>
                        <circle cx="20" cy="20" r="8" fill="#1565C0"/>
                        <circle cx="20" cy="20" r="4" fill="#fff"/>
                    </svg>
                `),
                scaledSize: new google.maps.Size(22, 29),
                anchor: new google.maps.Point(11, 29)
            };
            const iconoHistoricoGrande = {
                url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                    <svg width="40" height="52" viewBox="0 0 40 52" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="shadowHg" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.3"/>
                            </filter>
                        </defs>
                        <path d="M20 0 C8.95 0 0 8.95 0 20 C0 35 20 52 20 52 C20 52 40 35 40 20 C40 8.95 31.05 0 20 0 Z" 
                              fill="#1565C0" filter="url(#shadowHg)"/>
                        <circle cx="20" cy="20" r="14" fill="#fff"/>
                        <circle cx="20" cy="20" r="8" fill="#1565C0"/>
                        <circle cx="20" cy="20" r="4" fill="#fff"/>
                    </svg>
                `),
                scaledSize: new google.maps.Size(28, 36),
                anchor: new google.maps.Point(14, 36)
            };

            // Crear icono crema con número (1-31) para anunciantes
            function crearIconoEmpresaNumero(num, grande) {
                var size = grande ? 28 : 22;
                var anchorY = grande ? 36 : 29;
                var textSize = grande ? 12 : 10;
                var svg = '<svg width="40" height="52" viewBox="0 0 40 52" xmlns="http://www.w3.org/2000/svg">' +
                    '<defs><filter id="shadowC' + (grande ? 'g' : '') + '" x="-20%" y="-20%" width="140%" height="140%">' +
                    '<feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.25"/></filter></defs>' +
                    '<path d="M20 0 C8.95 0 0 8.95 0 20 C0 35 20 52 20 52 C20 52 40 35 40 20 C40 8.95 31.05 0 20 0 Z" fill="#E8E0D5" filter="url(#shadowC' + (grande ? 'g' : '') + ')"/>' +
                    '<circle cx="20" cy="20" r="14" fill="#fff"/>' +
                    '<text x="20" y="24" text-anchor="middle" font-family="Arial,sans-serif" font-weight="bold" font-size="' + textSize + '" fill="#5d4037">' + num + '</text>' +
                    '</svg>';
                return {
                    url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(svg),
                    scaledSize: new google.maps.Size(size, Math.round(size * 52 / 40)),
                    anchor: new google.maps.Point(size / 2, anchorY)
                };
            }
            
            // Icono de georreferenciación GRANDE para hover
            const iconoGeorreferenciacionGrande = {
                url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                    <svg width="40" height="52" viewBox="0 0 40 52" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.3"/>
                            </filter>
                        </defs>
                        <path d="M20 0 C8.95 0 0 8.95 0 20 C0 35 20 52 20 52 C20 52 40 35 40 20 C40 8.95 31.05 0 20 0 Z" 
                              fill="#8B1538" filter="url(#shadow)"/>
                        <circle cx="20" cy="20" r="14" fill="#fff"/>
                        <circle cx="20" cy="20" r="8" fill="#8B1538"/>
                        <circle cx="20" cy="20" r="4" fill="#fff"/>
                    </svg>
                `),
                scaledSize: new google.maps.Size(28, 36),
                anchor: new google.maps.Point(14, 36)
            };

            // Icono para la ubicación actual del usuario - estilo moderno con pulso
            const iconoUbicacionUsuario = {
                url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                    <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <circle cx="16" cy="16" r="14" fill="#4285F4" opacity="0.2"/>
                        <circle cx="16" cy="16" r="10" fill="#4285F4" opacity="0.4"/>
                        <circle cx="16" cy="16" r="6" fill="#4285F4" stroke="#fff" stroke-width="2" filter="url(#glow)"/>
                    </svg>
                `),
                scaledSize: new google.maps.Size(32, 32),
                anchor: new google.maps.Point(16, 16)
            };

            // Función para crear contenido del info window mejorado. lang opcional (usa window.currentLang si no se pasa).
            function crearContenidoInfo(lugar, lang) {
                const lang_ = lang || (window.currentLang || 'es');
                const t = (window.T && window.T[lang_] && window.T[lang_].tooltipLabels) ? window.T[lang_].tooltipLabels : { direccion: 'Dirección', verRuta: 'Cómo llegar', streetView: 'Street View', verStreetView: 'Ver Street View', whatsapp: 'WhatsApp', web: 'Web', instagram: 'Instagram', facebook: 'Facebook' };
                const tr = (window.T && window.T[lang_] && window.T[lang_].places && window.T[lang_].places[lugar.nombre]) ? window.T[lang_].places[lugar.nombre] : {};
                const nombre = tr.nombre !== undefined ? tr.nombre : lugar.nombre;
                const descripcion = tr.descripcion !== undefined ? tr.descripcion : (lugar.descripcion || '');
                const categoria = tr.categoria !== undefined ? tr.categoria : lugar.categoria;
                const direccion = tr.direccion !== undefined ? tr.direccion : (lugar.direccion || '');

                const esHistorico = (categoria || '').toUpperCase().includes('HISTORIC') || (lugar.categoria || '').includes('HISTÓRICO');
                const categoriaClass = esHistorico ? 'historical' : 'business';
                
                const imagenHTML = lugar.imagen 
                    ? `<img src="${lugar.imagen}" alt="${nombre.replace(/"/g, '&quot;')}" class="info-window-image">` 
                    : '';
                
                const routeButtonHTML = createRouteButton(lugar.lat, lugar.lng, lugar.nombre, t.verRuta);
                const streetViewButtonHTML = createStreetViewButton(lugar.lat, lugar.lng, lugar.nombre, t.streetView, t.verStreetView);
                
                let galeriaHTML = '';
                if (lugar.galeria && lugar.galeria.length > 0) {
                    const galeriaId = 'gallery-' + (lugar.nombre || '').replace(/\s+/g, '-').toLowerCase();
                    const imgAlt = lang_ === 'en' ? 'Image' : 'Imagen';
                    galeriaHTML = `
                        <div class="gallery-container" id="${galeriaId}">
                            <div class="gallery-main">
                                <img src="${lugar.galeria[0]}" alt="${nombre.replace(/"/g, '&quot;')}" id="${galeriaId}-main">
                                <button class="gallery-nav prev" onclick="cambiarImagenGaleria('${galeriaId}', -1)">
                                    <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                                </button>
                                <button class="gallery-nav next" onclick="cambiarImagenGaleria('${galeriaId}', 1)">
                                    <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                                </button>
                                <button class="gallery-fullscreen-btn" onclick="abrirLightbox('${galeriaId}')">
                                    <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
                                </button>
                                <span class="gallery-counter" id="${galeriaId}-counter">1 / ${lugar.galeria.length}</span>
                            </div>
                            <div class="gallery-thumbnails">
                                ${lugar.galeria.map((img, i) => `
                                    <div class="gallery-thumb ${i === 0 ? 'active' : ''}" onclick="irAImagenGaleria('${galeriaId}', ${i})">
                                        <img src="${img}" alt="${imgAlt} ${i+1}">
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                let contenido = `
                    <div class="info-window">
                        <div class="info-window-header ${categoriaClass}">
                            <button type="button" class="info-window-close-btn" aria-label="Cerrar">×</button>
                            ${imagenHTML}
                            <span class="category">${categoria}</span>
                            <h3>${nombre}</h3>
                        </div>
                        <div class="info-window-body">
                            ${descripcion ? '<p>' + descripcion + '</p>' : ''}
                            ${galeriaHTML}
                            <div class="address ${categoriaClass}">
                                <strong>📍 ${t.direccion}</strong><br>${direccion}
                            </div>
                            <div class="info-window-actions" style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: wrap;">
                                ${routeButtonHTML}
                                ${streetViewButtonHTML}
                            </div>
                        </div>
                `;

                const tieneContacto = lugar.horario || lugar.telefono || lugar.whatsapp || lugar.web || lugar.instagram || lugar.facebook || lugar.email;
                
                if (tieneContacto) {
                    contenido += `<div class="info-window-footer">`;
                    
                    if (lugar.horario) {
                        contenido += `<span class="contact-item">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/></svg>
                            ${lugar.horario}
                        </span>`;
                    }

                    if (lugar.telefono) {
                        const telNum = lugar.telefono.replace(/[^0-9+]/g, '');
                        contenido += `<a href="tel:${telNum}" class="contact-item" target="_blank">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                            ${lugar.telefono}
                        </a>`;
                    }

                    if (lugar.whatsapp) {
                        const waNum = lugar.whatsapp.replace(/[^0-9]/g, '');
                        contenido += `<a href="https://wa.me/${waNum}" class="contact-item" target="_blank">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                            ${t.whatsapp}
                        </a>`;
                    }

                    if (lugar.web) {
                        const webUrl = lugar.web.startsWith('http') ? lugar.web : 'https://' + lugar.web;
                        contenido += `<a href="${webUrl}" class="contact-item" target="_blank">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                            ${t.web}
                        </a>`;
                    }

                    if (lugar.instagram) {
                        const igUser = lugar.instagram.replace('@', '');
                        contenido += `<a href="https://instagram.com/${igUser}" class="contact-item" target="_blank">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                            ${t.instagram}
                        </a>`;
                    }

                    if (lugar.facebook) {
                        const fbUrl = lugar.facebook.startsWith('http') ? lugar.facebook : 'https://' + lugar.facebook;
                        contenido += `<a href="${fbUrl}" class="contact-item" target="_blank">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                            ${t.facebook}
                        </a>`;
                    }

                    if (lugar.email) {
                        contenido += `<a href="mailto:${lugar.email}" class="contact-item" target="_blank">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                            ${lugar.email}
                        </a>`;
                    }

                    contenido += `</div>`;
                }

                contenido += `</div>`;
                return contenido;
            }

            // ===== MEJORAS UX: Control de InfoWindows =====
            let activeInfoWindow = null; // Solo un InfoWindow abierto a la vez
            let activeMarker = null; // Marcador activo actual
            const allMarkers = []; // Array para almacenar todos los marcadores

            // Función para cerrar el InfoWindow activo
            function closeActiveInfoWindow() {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                    // Restaurar el icono al tamaño normal
                    if (activeMarker) {
                        const markerData = allMarkers.find(m => m.marker === activeMarker);
                        if (markerData && markerData.iconoNormal) {
                            activeMarker.setIcon(markerData.iconoNormal);
                        }
                    }
                    activeInfoWindow = null;
                    activeMarker = null;
                }
            }
            window.closeActiveInfoWindow = closeActiveInfoWindow;

            // Cerrar InfoWindow al hacer clic en el mapa (fuera de marcadores)
            map.addListener('click', () => {
                closeActiveInfoWindow();
            });

            // Cerrar InfoWindow con tecla Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeActiveInfoWindow();
                    closeRoutePanel();
                }
            });

            // ===== SISTEMA DE RUTAS =====
            // Variables globales para el sistema de rutas
            let currentUserLocation = null; // Ubicación actual del usuario
            let directionsService = null;
            let directionsRenderer = null;
            let currentRoute = null;
            let currentTravelMode = 'DRIVING';
            let currentDestination = null;
            let currentDestinationName = '';

            // Inicializar el servicio de direcciones
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                map: map,
                suppressMarkers: false,
                polylineOptions: {
                    strokeColor: '#8B1538',
                    strokeWeight: 5,
                    strokeOpacity: 0.8
                }
            });

            // Elementos del DOM para el panel de rutas
            const routePanel = document.getElementById('routePanel');
            const routeLoading = document.getElementById('routeLoading');
            const routeDetails = document.getElementById('routeDetails');
            const routeError = document.getElementById('routeError');
            const routeDestinationName = document.getElementById('routeDestinationName');
            const routeDistance = document.getElementById('routeDistance');
            const routeDuration = document.getElementById('routeDuration');
            const routeSteps = document.getElementById('routeSteps');
            const routeErrorMessage = document.getElementById('routeErrorMessage');

            // Función para abrir el panel de rutas
            function openRoutePanel() {
                // En móvil, cerrar el InfoWindow y empezar minimizado
                if (window.innerWidth <= 768) {
                    closeActiveInfoWindow();
                    routePanel.classList.add('minimized');
                    const expandText = document.getElementById('routeExpandText');
                    if (expandText) expandText.textContent = 'Ver indicaciones';
                } else {
                    routePanel.classList.remove('minimized');
                }
                routePanel.classList.add('active');
                routeLoading.style.display = 'flex';
                routeDetails.style.display = 'none';
                routeError.style.display = 'none';
            }

            // Función para cerrar el panel de rutas
            function closeRoutePanel() {
                routePanel.classList.remove('active');
                if (directionsRenderer) {
                    directionsRenderer.setMap(null);
                }
                currentRoute = null;
                currentDestination = null;
            }

            // Función para mostrar la ruta calculada
            function showRouteDetails(route) {
                const leg = route.routes[0].legs[0];
                
                routeLoading.style.display = 'none';
                routeDetails.style.display = 'block';
                routeError.style.display = 'none';
                
                // Actualizar resumen
                routeDistance.textContent = leg.distance.text;
                routeDuration.textContent = leg.duration.text;
                
                // Actualizar pasos
                const stepsHTML = leg.steps.map((step, index) => {
                    const instruction = step.instructions.replace(/<[^>]*>/g, ''); // Limpiar HTML
                    const icon = getStepIcon(step.maneuver);
                    return `
                        <div class="route-step" data-step-index="${index}">
                            <div class="route-step-icon">
                                ${icon}
                            </div>
                            <div class="route-step-content">
                                <div class="route-step-instruction">${instruction}</div>
                                <div class="route-step-distance">${step.distance.text} • ${step.duration.text}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                routeSteps.innerHTML = stepsHTML;
                
                // Agregar interactividad a los pasos
                routeSteps.querySelectorAll('.route-step').forEach((stepEl, index) => {
                    stepEl.addEventListener('click', () => {
                        const step = leg.steps[index];
                        map.panTo(step.start_location);
                        map.setZoom(17);
                    });
                });
            }

            // Función para mostrar error
            function showRouteError(message) {
                routeLoading.style.display = 'none';
                routeDetails.style.display = 'none';
                routeError.style.display = 'block';
                routeErrorMessage.textContent = message;
            }

            // Función para obtener icono según el tipo de maniobra
            function getStepIcon(maneuver) {
                const icons = {
                    'turn-left': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 7v6l-4-3 4-3zm-2 10.5V15H7V9H5v6c0 1.1.9 2 2 2h5v2.5l3.5-3.5L12 12.5z"/></svg>',
                    'turn-right': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 7v6l4-3-4-3zm2 10.5V15h5V9h2v6c0 1.1-.9 2-2 2h-5v2.5L8.5 16l3.5-3.5z"/></svg>',
                    'straight': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l-4 4h3v8H8l4 4 4-4h-3V8h3z"/></svg>',
                    'merge': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 18.59L8.83 20 12 16.83 15.17 20l1.41-1.41L12 14l-4.59 4.59zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10l4.59-4.59z"/></svg>',
                    'roundabout-left': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"/></svg>',
                    'roundabout-right': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"/></svg>',
                    'uturn-left': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 9v12h-2V9c0-2.21-1.79-4-4-4S8 6.79 8 9v4.17l1.59-1.59L11 13l-4 4-4-4 1.41-1.41L6 13.17V9c0-3.31 2.69-6 6-6s6 2.69 6 6z"/></svg>',
                    'uturn-right': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 9v12h2V9c0-2.21 1.79-4 4-4s4 1.79 4 4v4.17l-1.59-1.59L13 13l4 4 4-4-1.41-1.41L18 13.17V9c0-3.31-2.69-6-6-6S6 5.69 6 9z"/></svg>',
                    'fork-left': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 3h-4v7.9l-6 4.5V21h2v-4.6l5-3.75V21h2v-8.35l5 3.75V21h2v-5.6l-6-4.5V3z"/></svg>',
                    'fork-right': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 3h-4v7.9l-6 4.5V21h2v-4.6l5-3.75V21h2v-8.35l5 3.75V21h2v-5.6l-6-4.5V3z"/></svg>',
                    'ramp-left': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"/></svg>',
                    'ramp-right': '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M15 5v2H8.41L20 18.59 18.59 20 7 8.41V15H5V5h10z"/></svg>'
                };
                
                return icons[maneuver] || '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>';
            }

            // Función principal para calcular ruta
            function calculateRoute(destination, destinationName, travelMode = 'DRIVING') {
                if (!currentUserLocation) {
                    mostrarMensaje('Necesitamos tu ubicación para calcular la ruta. Haz clic en "Mi ubicación".', 'error');
                    return;
                }

                currentDestination = destination;
                currentDestinationName = destinationName;
                currentTravelMode = travelMode;

                // Abrir panel y mostrar loading
                openRoutePanel();
                routeDestinationName.textContent = destinationName;

                // Activar el renderer en el mapa
                directionsRenderer.setMap(map);

                const request = {
                    origin: currentUserLocation,
                    destination: destination,
                    travelMode: google.maps.TravelMode[travelMode],
                    unitSystem: google.maps.UnitSystem.METRIC,
                    provideRouteAlternatives: false
                };

                directionsService.route(request, (result, status) => {
                    if (status === 'OK') {
                        currentRoute = result;
                        directionsRenderer.setDirections(result);
                        showRouteDetails(result);
                        
                        // Ajustar vista para mostrar toda la ruta
                        const bounds = result.routes[0].bounds;
                        map.fitBounds(bounds, { padding: 80 });
                    } else {
                        let errorMsg = 'No se pudo calcular la ruta.';
                        switch (status) {
                            case 'ZERO_RESULTS':
                                errorMsg = 'No hay ruta disponible entre estos puntos.';
                                break;
                            case 'NOT_FOUND':
                                errorMsg = 'No se encontró uno de los puntos.';
                                break;
                            case 'OVER_QUERY_LIMIT':
                                errorMsg = 'Límite de consultas excedido. Intenta más tarde.';
                                break;
                            case 'REQUEST_DENIED':
                                errorMsg = 'El servicio de rutas no está disponible.';
                                break;
                            case 'INVALID_REQUEST':
                                errorMsg = 'Solicitud inválida.';
                                break;
                        }
                        showRouteError(errorMsg);
                        console.error('Error al calcular ruta:', status);
                    }
                });
            }

            // Exponer calculateRoute globalmente para los onclick inline
            window.calculateRoute = calculateRoute;

            // Event listeners para el panel de rutas
            document.getElementById('routePanelClose').addEventListener('click', closeRoutePanel);

            // Botón expandir/colapsar para móvil
            const routeExpandBtn = document.getElementById('routeExpandBtn');
            const routeExpandText = document.getElementById('routeExpandText');
            
            // Iniciar minimizado en móvil
            function initRoutePanelState() {
                if (window.innerWidth <= 768) {
                    routePanel.classList.add('minimized');
                    routeExpandText.textContent = 'Ver indicaciones';
                } else {
                    routePanel.classList.remove('minimized');
                }
            }
            
            routeExpandBtn.addEventListener('click', () => {
                const isMinimized = routePanel.classList.toggle('minimized');
                routeExpandText.textContent = isMinimized ? 'Ver indicaciones' : 'Ocultar indicaciones';
            });
            
            // También permitir expandir/colapsar tocando el header en móvil
            document.querySelector('.route-panel-header').addEventListener('click', (e) => {
                // Solo si es móvil y no se hizo clic en el botón cerrar
                if (window.innerWidth <= 768 && !e.target.closest('.route-panel-close')) {
                    const isMinimized = routePanel.classList.toggle('minimized');
                    routeExpandText.textContent = isMinimized ? 'Ver indicaciones' : 'Ocultar indicaciones';
                }
            });
            
            // Ajustar estado al cambiar tamaño de ventana
            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    routePanel.classList.remove('minimized');
                }
            });

            // Botones de modo de transporte
            document.querySelectorAll('.route-mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!currentDestination) return;
                    
                    // Actualizar UI
                    document.querySelectorAll('.route-mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Recalcular ruta con nuevo modo
                    const mode = btn.dataset.mode;
                    calculateRoute(currentDestination, currentDestinationName, mode);
                });
            });

            // Botón de reintentar
            document.getElementById('routeRetryBtn').addEventListener('click', () => {
                if (currentDestination) {
                    calculateRoute(currentDestination, currentDestinationName, currentTravelMode);
                }
            });

            // Botones sin onclick inline para que funcionen cuando el mapa está embebido (CSP de WordPress puede bloquear inline)
            function createRouteButton(lat, lng, nombre, label) {
                const text = (label || 'Cómo llegar').replace(/"/g, '&quot;');
                const nombreEscapado = (nombre || '').replace(/"/g, '&quot;');
                return `
                    <button type="button" class="route-btn" data-lat="${lat}" data-lng="${lng}" data-nombre="${nombreEscapado}" title="${text}">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21.71 11.29l-9-9a.996.996 0 00-1.41 0l-9 9a.996.996 0 000 1.41l9 9c.39.39 1.02.39 1.41 0l9-9a.996.996 0 000-1.41zM14 14.5V12h-4v3H8v-4c0-.55.45-1 1-1h5V7.5l3.5 3.5-3.5 3.5z"/>
                        </svg>
                        ${(label || 'Cómo llegar')}
                    </button>
                `;
            }

            function createStreetViewButton(lat, lng, nombre, label, titleLabel) {
                const text = (label || 'Street View').replace(/"/g, '&quot;');
                const title = (titleLabel != null ? titleLabel : text).replace(/"/g, '&quot;');
                const nombreEscapado = (nombre || '').replace(/"/g, '&quot;');
                return `
                    <button type="button" class="streetview-btn" data-lat="${lat}" data-lng="${lng}" data-nombre="${nombreEscapado}" title="${title}">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12.56 14.33c-.34.27-.56.7-.56 1.17V21h7c1.1 0 2-.9 2-2v-5.98c-.94-.33-1.95-.52-3-.52-2.03 0-3.93.7-5.44 1.83z"/>
                            <circle cx="18" cy="6" r="5"/>
                            <path d="M11.5 6c0-1.08.27-2.1.74-3H5c-1.1 0-2 .9-2 2v14c0 .55.23 1.05.59 1.41l9.82-9.82C12.23 9.42 11.5 7.8 11.5 6z"/>
                        </svg>
                        ${(label || 'Street View')}
                    </button>
                `;
            }
            window.createStreetViewButton = createStreetViewButton;

            // Delegación: clics en botones del tooltip (funciona en embed cuando CSP bloquea onclick inline)
            document.addEventListener('click', function(e) {
                var closeBtn = e.target && e.target.closest && e.target.closest('.info-window .info-window-close-btn');
                if (closeBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (typeof window.closeActiveInfoWindow === 'function') window.closeActiveInfoWindow();
                    return;
                }
                var routeBtn = e.target && e.target.closest && e.target.closest('.info-window .route-btn');
                if (routeBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    var lat = parseFloat(routeBtn.getAttribute('data-lat'));
                    var lng = parseFloat(routeBtn.getAttribute('data-lng'));
                    var nom = (routeBtn.getAttribute('data-nombre') || '').replace(/&quot;/g, '"');
                    if (typeof window.calculateRoute === 'function') window.calculateRoute({ lat: lat, lng: lng }, nom);
                    return;
                }
                var svBtn = e.target && e.target.closest && e.target.closest('.info-window .streetview-btn');
                if (svBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    var lat = parseFloat(svBtn.getAttribute('data-lat'));
                    var lng = parseFloat(svBtn.getAttribute('data-lng'));
                    var nom = (svBtn.getAttribute('data-nombre') || '').replace(/&quot;/g, '"');
                    if (typeof window.openStreetView === 'function') window.openStreetView(lat, lng, nom);
                }
            });

            // ===== SISTEMA DE STREET VIEW =====
            const streetviewModal = document.getElementById('streetviewModal');
            const streetviewModalTitle = document.getElementById('streetviewModalTitle');
            const streetviewModalBody = document.getElementById('streetviewModalBody');
            let currentStreetViewLocation = null;

            // Abrir modal de Street View
            function openStreetView(lat, lng, placeName) {
                currentStreetViewLocation = { lat, lng };
                
                // Actualizar título
                streetviewModalTitle.textContent = placeName;
                
                // Mostrar modal con loading
                streetviewModal.classList.add('active');
                streetviewModalBody.innerHTML = `
                    <div class="streetview-loading">
                        <div class="streetview-loading-spinner"></div>
                        <div class="streetview-loading-text">Cargando Street View...</div>
                    </div>
                `;
                
                // Crear el Street View panorama dentro del modal
                setTimeout(() => {
                    streetviewModalBody.innerHTML = '<div id="streetviewPanorama" style="width:100%;height:500px;"></div>';
                    
                    const panorama = new google.maps.StreetViewPanorama(
                        document.getElementById('streetviewPanorama'),
                        {
                            position: { lat, lng },
                            pov: { heading: 0, pitch: 0 },
                            zoom: 1,
                            addressControl: true,
                            fullscreenControl: true,
                            motionTracking: false,
                            motionTrackingControl: false,
                            linksControl: true,
                            panControl: true,
                            zoomControl: true,
                            enableCloseButton: false
                        }
                    );
                    
                    // Verificar si Street View está disponible
                    const streetViewService = new google.maps.StreetViewService();
                    streetViewService.getPanorama({ location: { lat, lng }, radius: 100 }, (data, status) => {
                        if (status !== 'OK') {
                            streetviewModalBody.innerHTML = `
                                <div style="text-align:center;padding:60px 20px;color:#666;background:#fce4ec;">
                                    <svg viewBox="0 0 24 24" fill="#C2185B" style="width:64px;height:64px;margin-bottom:16px;">
                                        <path d="M12.56 14.33c-.34.27-.56.7-.56 1.17V21h7c1.1 0 2-.9 2-2v-5.98c-.94-.33-1.95-.52-3-.52-2.03 0-3.93.7-5.44 1.83z"/>
                                        <circle cx="18" cy="6" r="5"/>
                                        <path d="M11.5 6c0-1.08.27-2.1.74-3H5c-1.1 0-2 .9-2 2v14c0 .55.23 1.05.59 1.41l9.82-9.82C12.23 9.42 11.5 7.8 11.5 6z"/>
                                    </svg>
                                    <div style="font-size:18px;font-weight:600;color:#8B1538;margin-bottom:8px;">Street View no disponible</div>
                                    <div style="font-size:14px;color:#666;">No hay imágenes de Street View cerca de esta ubicación.</div>
                                </div>
                            `;
                        }
                    });
                }, 100);
            }
            window.openStreetView = openStreetView;

            // Cerrar modal de Street View
            function closeStreetViewModal() {
                streetviewModal.classList.remove('active');
                streetviewModalBody.innerHTML = '';
                currentStreetViewLocation = null;
            }

            // Event listeners para el modal de Street View
            document.getElementById('streetviewModalClose').addEventListener('click', closeStreetViewModal);
            streetviewModal.addEventListener('click', (e) => {
                if (e.target === streetviewModal) {
                    closeStreetViewModal();
                }
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && streetviewModal.classList.contains('active')) {
                    closeStreetViewModal();
                }
            });

            // Agregar marcadores históricos
            const tamañoNormal = 34;
            const tamañoGrande = 44;
            
            lugares.historicos.forEach(lugar => {
                const iconoNormal = lugar.imagen 
                    ? crearIconoPersonalizado(lugar.imagen, tamañoNormal)
                    : iconoHistorico;
                const iconoHover = lugar.imagen 
                    ? crearIconoPersonalizado(lugar.imagen, tamañoGrande)
                    : iconoHistoricoGrande;

                const marker = new google.maps.Marker({
                    position: { lat: lugar.lat, lng: lugar.lng },
                    map: map,
                    title: lugar.nombre,
                    icon: iconoNormal,
                    animation: null,
                    cursor: 'pointer'
                });

                const infoWindow = new google.maps.InfoWindow({
                    content: crearContenidoInfo(lugar),
                    maxWidth: 400
                });
                google.maps.event.addListener(infoWindow, 'domready', function() {
                    var iw = document.querySelector('.gm-style-iw');
                    if (iw && iw.previousElementSibling) iw.previousElementSibling.style.setProperty('display', 'none', 'important');
                    var closeBtn = document.querySelector('.gm-style-iw-c .gm-ui-hover-effect');
                    if (closeBtn) closeBtn.style.setProperty('display', 'none', 'important');
                });

                // Click en marcador: cerrar anterior y abrir nuevo
                marker.addListener('click', () => {
                    // Cerrar InfoWindow anterior si existe
                    closeActiveInfoWindow();
                    
                    // Abrir el nuevo InfoWindow
                    infoWindow.open(map, marker);
                    activeInfoWindow = infoWindow;
                    activeMarker = marker;
                    
                    // Inicializar galería si existe
                    setupGaleria(lugar);
                    
                    // Hacer el icono más grande al seleccionar
                    marker.setIcon(iconoHover);
                    
                    // Pequeña animación de rebote
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(() => marker.setAnimation(null), 700);
                });

                // Hover: efecto visual - icono crece
                marker.addListener('mouseover', () => {
                    marker.setIcon(iconoHover);
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(() => {
                        if (marker !== activeMarker) {
                            marker.setAnimation(null);
                        }
                    }, 350);
                });
                
                // Mouseout: volver al tamaño normal (si no está seleccionado)
                marker.addListener('mouseout', () => {
                    if (marker !== activeMarker) {
                        marker.setIcon(iconoNormal);
                    }
                });

                allMarkers.push({ marker, infoWindow, lugar, iconoNormal, iconoHover });
            });

            // Orden oficial de los 31 anunciantes (mismo que en el sidebar)
            var ordenAnunciantesMap = [
                'GUARDIÁN CAFÉ-GALERÍA', 'TORTAS AHOGADAS Las Famosas', 'HOTEL Aló', 'HOTEL Olá', 'RESTAURANT Los Paceños',
                'TARASKA Helados y Paletas', 'TARASKA Helados y Paletas', 'EX-CONVENTO DE SANTA TERESA', 'HOTEL ONE Guadalajara Centro',
                'RAGAZZA Fashion', 'RAGAZZA Fashion', 'RESTAURANT Casa Dolores', 'RESTAURANT Casa Dolores', 'RESTAURANT Alma Jalisco',
                'CONOCE JALISCO Tours', 'CASA ANGUIANO Artículos Religiosos', 'RESTAURANT BAR El Mesón', 'BIRRIERIA El Pilón de los Arrieros',
                'CARNITAS Uruapan', 'BOTICA Toledo', 'FARMACIA Toledo', 'MERCADO de las Flores', 'CALANDRIAS eléctricas',
                'LA GLORIA Artículos Religiosos', 'CASA CARRANZA Hotel Airbnb', 'RESTAURANT Guasanga', 'CANTINA Los Famosos Equipales',
                'MARIACHI México en la Piel', 'ACADEMIA Nuevo Jalisco', 'MIMOSA Artículos Religiosos', 'TAKASAMI Clothing'
            ];
            var numeroParaEmpresa = {};
            var usedCountMap = {};
            ordenAnunciantesMap.forEach(function(nombre, listPos) {
                var occ = (usedCountMap[nombre] || 0);
                usedCountMap[nombre] = occ + 1;
                var idx = -1, n = 0;
                for (var j = 0; j < lugares.empresas.length; j++) {
                    if (lugares.empresas[j].nombre === nombre) {
                        if (n === occ) { idx = j; break; }
                        n++;
                    }
                }
                if (idx !== -1) numeroParaEmpresa[idx] = listPos + 1;
            });

            // Agregar marcadores de empresas (crema con número 1-31)
            lugares.empresas.forEach((lugar, i) => {
                var num = numeroParaEmpresa[i];
                var iconoNormal = (num >= 1 && num <= 31) ? crearIconoEmpresaNumero(num, false) : iconoGeorreferenciacion;
                var iconoHover = (num >= 1 && num <= 31) ? crearIconoEmpresaNumero(num, true) : iconoGeorreferenciacionGrande;

                const marker = new google.maps.Marker({
                    position: { lat: lugar.lat, lng: lugar.lng },
                    map: map,
                    title: lugar.nombre,
                    icon: iconoNormal,
                    animation: null,
                    cursor: 'pointer'
                });

                const infoWindow = new google.maps.InfoWindow({
                    content: crearContenidoInfo(lugar),
                    maxWidth: 400
                });
                google.maps.event.addListener(infoWindow, 'domready', function() {
                    var iw = document.querySelector('.gm-style-iw');
                    if (iw && iw.previousElementSibling) iw.previousElementSibling.style.setProperty('display', 'none', 'important');
                    var closeBtn = document.querySelector('.gm-style-iw-c .gm-ui-hover-effect');
                    if (closeBtn) closeBtn.style.setProperty('display', 'none', 'important');
                });

                // Click en marcador: cerrar anterior y abrir nuevo
                marker.addListener('click', () => {
                    // Cerrar InfoWindow anterior si existe
                    closeActiveInfoWindow();
                    
                    // Abrir el nuevo InfoWindow
                    infoWindow.open(map, marker);
                    activeInfoWindow = infoWindow;
                    activeMarker = marker;
                    
                    // Inicializar galería si existe
                    setupGaleria(lugar);
                    
                    // Hacer el icono más grande al seleccionar
                    marker.setIcon(iconoHover);
                    
                    // Pequeña animación de rebote
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(() => marker.setAnimation(null), 700);
                });

                // Hover: efecto visual - icono crece
                marker.addListener('mouseover', () => {
                    marker.setIcon(iconoHover);
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(() => {
                        if (marker !== activeMarker) {
                            marker.setAnimation(null);
                        }
                    }, 350);
                });
                
                // Mouseout: volver al tamaño normal (si no está seleccionado)
                marker.addListener('mouseout', () => {
                    if (marker !== activeMarker) {
                        marker.setIcon(iconoNormal);
                    }
                });

                allMarkers.push({ marker, infoWindow, lugar, iconoNormal, iconoHover });
            });

            // Rellenar menú lateral: lista de todos los puntos (clic = centrar mapa y abrir tooltip). Nombres traducidos según idioma.
            if (window.fillSidebarListFromLugares) {
                window.fillSidebarListFromLugares({ map: map, allMarkers: allMarkers });
            }

            // Al cambiar idioma: actualizar contenido de todos los InfoWindows y los nombres del sidebar izquierdo
            window.onMapLanguageChange = function(lang) {
                allMarkers.forEach(function(m) {
                    m.infoWindow.setContent(crearContenidoInfo(m.lugar, lang));
                });
                var list = document.getElementById('sidebarPuntosList');
                if (list) {
                    var names = (lang === 'en' && window.T && window.T.en && window.T.en.sidebarLeftNames) ? window.T.en.sidebarLeftNames : null;
                    list.querySelectorAll('.sidebar-puntos-item').forEach(function(li) {
                        var key = li.dataset.nombre || '';
                        var span = li.querySelector('.name');
                        if (span) span.textContent = (names && key && names[key]) ? names[key] : key;
                    });
                }
            };

            // Franja de anunciantes: clic en un panel centra el mapa y abre el tooltip del marcador
            document.querySelectorAll('#anunciantesStrip .anuncio-panel[data-marker-index]').forEach(panel => {
                panel.addEventListener('click', function(e) {
                    e.preventDefault();
                    const idx = parseInt(this.getAttribute('data-marker-index'), 10);
                    if (allMarkers[idx]) {
                        const m = allMarkers[idx];
                        map.panTo(m.marker.getPosition());
                        map.setZoom(17);
                        if (m.marker.getMap()) {
                            google.maps.event.trigger(m.marker, 'click');
                        }
                    }
                });
            });

            // Variables para almacenar el marcador y círculo del usuario
            let userMarker = null;
            let accuracyCircle = null;

            // Función para mostrar mensaje
            function mostrarMensaje(mensaje, tipo = 'info') {
                const messageDiv = document.getElementById('geolocationMessage');
                if (messageDiv) {
                    messageDiv.textContent = mensaje;
                    messageDiv.className = 'geolocation-message ' + tipo;
                    messageDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        messageDiv.style.display = 'none';
                    }, 5000);
                }
            }

            // Exponer mostrarMensaje globalmente para los onclick inline
            window.mostrarMensaje = mostrarMensaje;

            // Función para obtener ubicación usando Google Geolocation API
            // Nota: Desde navegadores web, solo puede usar IP (precisión similar a geolocalización por IP)
            // Para mayor precisión, se necesitan permisos de geolocalización del navegador (GPS)
            async function obtenerUbicacionGoogleGeolocation() {
                try {
                    // Google Geolocation API puede usar información de red (WiFi, torres celulares)
                    // pero desde navegadores web no tenemos acceso a esa información por seguridad
                    // Por lo tanto, solo usará la IP, dando precisión similar a geolocalización por IP
                    const requestBody = {
                        considerIp: true // Usar IP (única opción disponible desde navegador web)
                    };
                    
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 8000);
                    
                    const response = await fetch(
                        `https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyBNkRTHRBGK6YZqa34DmiZfEzc3bRynnd0`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(requestBody),
                            signal: controller.signal
                        }
                    );
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(`HTTP ${response.status}: ${errorData.error?.message || 'Error desconocido'}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.location && data.location.lat && data.location.lng) {
                        const accuracy = data.accuracy || 5000; // Precisión en metros (típicamente 1-5km con IP)
                        console.log('✅ Ubicación obtenida por Google Geolocation API - Precisión:', Math.round(accuracy), 'metros');
                        
                        // Si la precisión es muy baja (>5km), es básicamente geolocalización por IP
                        if (accuracy > 5000) {
                            console.log('⚠️ Precisión baja: usando principalmente IP. Para ubicación exacta, permite permisos de geolocalización.');
                        }
                        
                        return {
                            lat: data.location.lat,
                            lng: data.location.lng,
                            accuracy: accuracy,
                            source: 'google-geolocation'
                        };
                    }
                    
                    throw new Error('Datos inválidos de Google Geolocation API');
                } catch (error) {
                    console.log('⚠️ Google Geolocation API falló:', error.message);
                    return null;
                }
            }

            // Función para obtener ubicación por IP (respaldo si Google Geolocation falla)
            async function obtenerUbicacionPorIP() {
                const servicios = [
                    // Servicio 1: ip-api.com (HTTP, no HTTPS en versión gratuita)
                    async () => {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000);
                        
                        try {
                            // Intentar HTTP primero (según documentación)
                            let response;
                            try {
                                response = await fetch('http://ip-api.com/json/?fields=status,message,lat,lon,city,regionName,country', {
                                    signal: controller.signal,
                                    headers: {
                                        'Accept': 'application/json',
                                    },
                                });
                            } catch (mixedContentError) {
                                // Si hay error de mixed content (HTTPS bloqueando HTTP), intentar con HTTPS
                                // aunque la documentación dice que no está disponible, algunos casos funcionan
                                console.log('⚠️ HTTP bloqueado, intentando HTTPS...');
                                response = await fetch('https://ip-api.com/json/?fields=status,message,lat,lon,city,regionName,country', {
                                    signal: controller.signal,
                                    headers: {
                                        'Accept': 'application/json',
                                    },
                                });
                            }
                            
                            clearTimeout(timeoutId);
                            
                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}`);
                            }
                            
                            const data = await response.json();
                            
                            if (data.status === 'success' && data.lat && data.lon) {
                                return {
                                    lat: parseFloat(data.lat),
                                    lng: parseFloat(data.lon),
                                    accuracy: 2000,
                                    city: data.city,
                                    region: data.regionName,
                                    source: 'ip-api.com'
                                };
                            }
                            throw new Error('Datos inválidos');
                        } catch (error) {
                            clearTimeout(timeoutId);
                            throw error;
                        }
                    },
                    // Servicio 2: ipapi.co (respaldo)
                    async () => {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000);
                        
                        const response = await fetch('https://ipapi.co/json/', {
                            signal: controller.signal,
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.latitude && data.longitude && !data.error) {
                            return {
                                lat: parseFloat(data.latitude),
                                lng: parseFloat(data.longitude),
                                accuracy: 2000,
                                city: data.city,
                                region: data.region,
                                source: 'ipapi.co'
                            };
                        }
                        throw new Error('Datos inválidos');
                    },
                    // Servicio 3: ipinfo.io (respaldo)
                    async () => {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000);
                        
                        const response = await fetch('https://ipinfo.io/json', {
                            signal: controller.signal,
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.loc) {
                            const coords = data.loc.split(',');
                            if (coords.length === 2) {
                                return {
                                    lat: parseFloat(coords[0]),
                                    lng: parseFloat(coords[1]),
                                    accuracy: 3000,
                                    city: data.city,
                                    region: data.region,
                                    source: 'ipinfo.io'
                                };
                            }
                        }
                        throw new Error('Datos inválidos');
                    },
                    // Servicio 4: geojs.io (respaldo final)
                    async () => {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000);
                        
                        const response = await fetch('https://get.geojs.io/v1/ip/geo.json', {
                            signal: controller.signal,
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.latitude && data.longitude) {
                            return {
                                lat: parseFloat(data.latitude),
                                lng: parseFloat(data.longitude),
                                accuracy: 3000,
                                city: data.city,
                                region: data.region,
                                source: 'geojs.io'
                            };
                        }
                        throw new Error('Datos inválidos');
                    }
                ];

                // Intentar cada servicio en orden
                for (let i = 0; i < servicios.length; i++) {
                    try {
                        const resultado = await servicios[i]();
                        
                        if (resultado && 
                            typeof resultado.lat === 'number' && 
                            typeof resultado.lng === 'number' &&
                            !isNaN(resultado.lat) && 
                            !isNaN(resultado.lng)) {
                            
                            console.log('✅ Ubicación obtenida por IP desde:', resultado.source, '- Ciudad:', resultado.city);
                            return {
                                lat: resultado.lat,
                                lng: resultado.lng,
                                accuracy: resultado.accuracy || 2000,
                                city: resultado.city,
                                region: resultado.region,
                                source: 'ip'
                            };
                        }
                    } catch (error) {
                        console.log(`⚠️ Servicio ${i + 1} falló:`, error.message);
                        // Continuar con el siguiente servicio
                        continue;
                    }
                }

                console.error('❌ Todos los servicios de geolocalización por IP fallaron');
                return null;
            }

            // Función para mostrar la ubicación en el mapa
            function mostrarUbicacionEnMapa(userLocation, accuracy, source = 'gps') {
                // Guardar ubicación del usuario para el sistema de rutas
                currentUserLocation = userLocation;
                
                // Eliminar marcador anterior si existe
                if (userMarker) {
                    userMarker.setMap(null);
                }
                if (accuracyCircle) {
                    accuracyCircle.setMap(null);
                }

                // Crear marcador para la ubicación del usuario
                userMarker = new google.maps.Marker({
                    position: userLocation,
                    map: map,
                    title: "Tu ubicación actual",
                    icon: iconoUbicacionUsuario,
                    animation: google.maps.Animation.DROP
                });

                // Crear círculo de precisión
                accuracyCircle = new google.maps.Circle({
                    center: userLocation,
                    radius: accuracy,
                    map: map,
                    fillColor: '#4285F4',
                    fillOpacity: 0.15,
                    strokeColor: '#4285F4',
                    strokeOpacity: 0.3,
                    strokeWeight: 1
                });

                // Info window para la ubicación del usuario
                let sourceText = '';
                if (source === 'ip') {
                    sourceText = ' (aproximada por IP)';
                } else if (source === 'google-geolocation') {
                    sourceText = ' (Google Geolocation API)';
                }
                
                const userInfoWindow = new google.maps.InfoWindow({
                    content: `
                        <div class="info-window">
                            <h3 style="color: #4285F4; margin-bottom: 10px;">👤 Tu ubicación${sourceText}</h3>
                            <p style="color: #666; font-size: 13px;">Estás aquí</p>
                            <p style="color: #666; font-size: 12px; margin-top: 8px;">
                                Precisión: ${Math.round(accuracy)} metros
                            </p>
                        </div>
                    `
                });

                userMarker.addListener('click', () => {
                    userInfoWindow.open(map, userMarker);
                });

                // No mover el mapa - solo mostrar el marcador de ubicación
            }

            // Función para obtener y mostrar la ubicación del usuario (siguiendo el patrón del ejemplo)
            async function obtenerUbicacionUsuario(mostrarMensajeFlag = true) {
                // Prioridad 1: Geolocalización del navegador (GPS/Wi-Fi, más precisa)
                if (navigator.geolocation) {
                    if (mostrarMensajeFlag) {
                        mostrarMensaje('Solicitando tu ubicación...', 'info');
                    }

                    console.log('🌐 Intentando geolocalización del navegador...');
                    
                    navigator.geolocation.getCurrentPosition(
                        async function(position) {
                            try {
                                const { latitude, longitude } = position.coords;
                                console.log('📍 Coordenadas obtenidas:', latitude, longitude);
                                
                                const userLocation = {
                                    lat: latitude,
                                    lng: longitude
                                };

                                mostrarUbicacionEnMapa(userLocation, position.coords.accuracy, 'gps');
                                
                                if (mostrarMensajeFlag) {
                                    mostrarMensaje('¡Ubicación encontrada!', 'success');
                                }
                            } catch (err) {
                                console.error('❌ Error procesando geolocalización:', err);
                                // Fallback a IP
                                await intentarUbicacionPorIP(mostrarMensajeFlag);
                            }
                        },
                        async function(error) {
                            // Si el usuario rechaza o no está disponible, intentar por IP
                            console.log('⚠️ Geolocalización del navegador falló, intentando por IP...');
                            
                            // Si el permiso está denegado, mostrar instrucciones
                            if (error.code === error.PERMISSION_DENIED) {
                                const instructionsDiv = document.getElementById('geolocationInstructions');
                                if (instructionsDiv && mostrarMensajeFlag) {
                                    instructionsDiv.style.display = 'block';
                                    // Ocultar después de 15 segundos
                                    setTimeout(() => {
                                        instructionsDiv.style.display = 'none';
                                    }, 15000);
                                }
                            }
                            
                            await intentarUbicacionPorIP(mostrarMensajeFlag, error);
                        },
                        {
                            timeout: 8000,
                            enableHighAccuracy: true, // Usar GPS si está disponible
                            maximumAge: 300000 // Cache de 5 minutos
                        }
                    );
                } else {
                    // Si no hay soporte, ir directo a IP
                    console.log('⚠️ Navegador no soporta geolocalización, usando IP...');
                    await intentarUbicacionPorIP(mostrarMensajeFlag);
                }
            }

            // Función helper para intentar ubicación (Google Geolocation primero, luego IP)
            async function intentarUbicacionPorIP(mostrarMensajeFlag = true, error = null) {
                // Si el permiso está denegado y es automático, intentar silenciosamente
                if (error && error.code === error.PERMISSION_DENIED && !mostrarMensajeFlag) {
                    // Intentar Google Geolocation API primero (más precisa)
                    const googleLocation = await obtenerUbicacionGoogleGeolocation();
                    if (googleLocation) {
                        mostrarUbicacionEnMapa(
                            { lat: googleLocation.lat, lng: googleLocation.lng },
                            googleLocation.accuracy,
                            'google-geolocation'
                        );
                        return;
                    }
                    
                    // Si falla, intentar IP
                    const ipLocation = await obtenerUbicacionPorIP();
                    if (ipLocation) {
                        mostrarUbicacionEnMapa(
                            { lat: ipLocation.lat, lng: ipLocation.lng },
                            ipLocation.accuracy,
                            'ip'
                        );
                    }
                    return;
                }

                if (mostrarMensajeFlag) {
                    mostrarMensaje('Obteniendo ubicación...', 'info');
                }

                // Intentar Google Geolocation API primero (más precisa que IP)
                const googleLocation = await obtenerUbicacionGoogleGeolocation();
                
                if (googleLocation) {
                    mostrarUbicacionEnMapa(
                        { lat: googleLocation.lat, lng: googleLocation.lng },
                        googleLocation.accuracy,
                        'google-geolocation'
                    );
                    if (mostrarMensajeFlag) {
                        const precisionKm = (googleLocation.accuracy / 1000).toFixed(1);
                        if (googleLocation.accuracy > 5000) {
                            mostrarMensaje(`Ubicación aproximada (${precisionKm}km). Permite permisos para ubicación exacta.`, 'info');
                        } else {
                            mostrarMensaje(`Ubicación encontrada (precisión: ${Math.round(googleLocation.accuracy)}m)`, 'success');
                        }
                    }
                    return;
                }

                // Si Google Geolocation falla, intentar IP como respaldo
                if (mostrarMensajeFlag) {
                    mostrarMensaje('Obteniendo ubicación aproximada por IP...', 'info');
                }

                const ipLocation = await obtenerUbicacionPorIP();
                
                if (ipLocation) {
                    mostrarUbicacionEnMapa(
                        { lat: ipLocation.lat, lng: ipLocation.lng },
                        ipLocation.accuracy,
                        'ip'
                    );
                    if (mostrarMensajeFlag) {
                        mostrarMensaje('Ubicación aproximada encontrada (por IP)', 'success');
                    }
                } else {
                    if (mostrarMensajeFlag) {
                        let mensajeError = 'No se pudo obtener tu ubicación.';
                        if (error) {
                            switch(error.code) {
                                case error.PERMISSION_DENIED:
                                    mensajeError = 'Permiso denegado. Permite el acceso a ubicación para mayor precisión.';
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    mensajeError = 'Ubicación no disponible.';
                                    break;
                                case error.TIMEOUT:
                                    mensajeError = 'Tiempo de espera agotado.';
                                    break;
                            }
                        }
                        mostrarMensaje(mensajeError, 'error');
                    }
                }
            }

            // Botón para solicitar ubicación manualmente
            document.getElementById('btnGeolocation').addEventListener('click', function() {
                // Ocultar instrucciones si están visibles
                const instructionsDiv = document.getElementById('geolocationInstructions');
                if (instructionsDiv) {
                    instructionsDiv.style.display = 'none';
                }
                obtenerUbicacionUsuario(true);
            });

            // Intentar obtener la ubicación automáticamente al cargar
            obtenerUbicacionUsuario(false);
        }
    </script>

    <!-- Google Maps API -->
    <script 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNkRTHRBGK6YZqa34DmiZfEzc3bRynnd0&callback=initMap&language=es&loading=async"
        async defer>
    </script>
</body>
</html>
